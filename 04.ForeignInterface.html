
<!DOCTYPE HTML>
<html lang="" >
    <head>
        <meta charset="UTF-8">
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <title>04. 外部接口 · GitBook</title>
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta name="description" content="">
        <meta name="generator" content="GitBook 3.2.3">
        
        
        
    
    <link rel="stylesheet" href="gitbook/style.css">

    
            
                
                <link rel="stylesheet" href="gitbook/gitbook-plugin-highlight/website.css">
                
            
                
                <link rel="stylesheet" href="gitbook/gitbook-plugin-search/search.css">
                
            
                
                <link rel="stylesheet" href="gitbook/gitbook-plugin-fontsettings/website.css">
                
            
        

    

    
        
    
        
    
        
    
        
    
        
    
        
    

        
    
    
    <meta name="HandheldFriendly" content="true"/>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <link rel="apple-touch-icon-precomposed" sizes="152x152" href="gitbook/images/apple-touch-icon-precomposed-152.png">
    <link rel="shortcut icon" href="gitbook/images/favicon.ico" type="image/x-icon">

    
    <link rel="next" href="05.BindingForms.html" />
    
    
    <link rel="prev" href="03.Debugging.html" />
    

    </head>
    <body>
        
<div class="book">
    <div class="book-summary">
        
            
<div id="book-search-input" role="search">
    <input type="text" placeholder="Type to search" />
</div>

            
                <nav role="navigation">
                


<ul class="summary">
    
    

    

    
        
        
    
        <li class="chapter " data-level="1.1" data-path="./">
            
                <a href="./">
            
                    
                    首页
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2" data-path="00.Terminology.html">
            
                <a href="00.Terminology.html">
            
                    
                    00. 术语表
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3" data-path="01.Introduction.html">
            
                <a href="01.Introduction.html">
            
                    
                    01. 简介
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4" data-path="02.UsingChezScheme.html">
            
                <a href="02.UsingChezScheme.html">
            
                    
                    02. 使用Chez Scheme
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5" data-path="03.Debugging.html">
            
                <a href="03.Debugging.html">
            
                    
                    03. Debugging
            
                </a>
            

            
        </li>
    
        <li class="chapter active" data-level="1.6" data-path="04.ForeignInterface.html">
            
                <a href="04.ForeignInterface.html">
            
                    
                    04. 外部接口
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7" data-path="05.BindingForms.html">
            
                <a href="05.BindingForms.html">
            
                    
                    05. 绑定
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.8" data-path="06.ControlStructures.html">
            
                <a href="06.ControlStructures.html">
            
                    
                    06. 控制结构
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9" data-path="07.OperationsOnObjects.html">
            
                <a href="07.OperationsOnObjects.html">
            
                    
                    07. 对象操作
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.10" data-path="08.NumericOperations.html">
            
                <a href="08.NumericOperations.html">
            
                    
                    08. 数字操作
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.11" data-path="09.InputOutputOperations.html">
            
                <a href="09.InputOutputOperations.html">
            
                    
                    09. 输入输出操作
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.12" data-path="10.LibrariesAndTop-levelPrograms.html">
            
                <a href="10.LibrariesAndTop-levelPrograms.html">
            
                    
                    10. 库和顶层程序
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.13" data-path="11.SyntacticExtensionAndModules.html">
            
                <a href="11.SyntacticExtensionAndModules.html">
            
                    
                    11. 语法扩展和模块
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.14" data-path="12.SystemOperations.html">
            
                <a href="12.SystemOperations.html">
            
                    
                    12. 系统操作
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.15" data-path="13.StorageManagement.html">
            
                <a href="13.StorageManagement.html">
            
                    
                    13. 存储系统
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.16" data-path="14.ExpressionEditor.html">
            
                <a href="14.ExpressionEditor.html">
            
                    
                    14. 扩展编辑器
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.17" data-path="15.ThreadSystem.html">
            
                <a href="15.ThreadSystem.html">
            
                    
                    15. 线程系统
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.18" data-path="16.CompatibilityFeatures.html">
            
                <a href="16.CompatibilityFeatures.html">
            
                    
                    16. 兼容功能
            
                </a>
            

            
        </li>
    

    

    <li class="divider"></li>

    <li>
        <a href="https://www.gitbook.com" target="blank" class="gitbook-link">
            Published with GitBook
        </a>
    </li>
</ul>


                </nav>
            
        
    </div>

    <div class="book-body">
        
            <div class="body-inner">
                
                    

<div class="book-header" role="navigation">
    

    <!-- Title -->
    <h1>
        <i class="fa fa-circle-o-notch fa-spin"></i>
        <a href="." >04. 外部接口</a>
    </h1>
</div>




                    <div class="page-wrapper" tabindex="-1" role="main">
                        <div class="page-inner">
                            
<div id="book-search-results">
    <div class="search-noresults">
    
                                <section class="normal markdown-section">
                                
                                <h1 id="4-&#x5916;&#x90E8;&#x63A5;&#x53E3;foreign-interface">4 &#x5916;&#x90E8;&#x63A5;&#x53E3;(Foreign Interface)</h1>
<p>Chez Scheme &#x63D0;&#x4F9B;&#x4E24;&#x79CD;&#x4E0E;&#x201C;&#x5916;&#x90E8;&#x4EE3;&#x7801;&#x201D;&#xFF08;&#x5373;&#x5176;&#x4ED6;&#x8BED;&#x8A00;&#x5199;&#x7684;&#x4EE3;&#x7801;&#xFF09;&#x4EA4;&#x4E92;&#x7684;&#x65B9;&#x5F0F;&#x3002;&#x7B2C;&#x4E00;&#x79CD;&#x662F;&#x901A;&#x8FC7;&#x5B50;&#x8FDB;&#x7A0B;&#x521B;&#x5EFA;&#x548C;&#x901A;&#x4FE1;&#xFF0C;&#x5728;4.1&#x8282;&#x8FDB;&#x884C;&#x8BA8;&#x8BBA;&#x3002;&#x7B2C;&#x4E8C;&#x79CD;&#x662F;&#x901A;&#x8FC7;&#x9759;&#x6001;&#x6216;&#x8005;&#x52A8;&#x6001;&#x52A0;&#x8F7D;&#x7684;&#x65B9;&#x5F0F;&#xFF0C;&#x5728;Scheme&#x4E2D;&#x8C03;&#x7528;C&#x7F16;&#x5199;&#x7684;&#x8FC7;&#x7A0B;&#xFF0C;&#x6216;&#x8005;&#x5728;C&#x4E2D;&#x8C03;&#x7528;Scheme&#x7F16;&#x5199;&#x7684;&#x8FC7;&#x7A0B;&#x3002;&#x8FD9;&#x4E9B;&#x673A;&#x5236;&#x5728;4.2&#x8282;&#x5230;4.4&#x8282;&#x4E2D;&#x8BA8;&#x8BBA;&#x3002;</p>
<p>&#x9759;&#x6001;&#x52A0;&#x8F7D;C&#x76EE;&#x6807;&#x4EE3;&#x7801;&#x7684;&#x65B9;&#x6CD5;&#x53D6;&#x51B3;&#x4E8E;&#x4F60;&#x6240;&#x8FD0;&#x884C;&#x7684;&#x673A;&#x5668;&#x3002;&#x8BE6;&#x89C1;&#x4E0E;Chez Scheme&#x4E00;&#x8D77;&#x53D1;&#x5E03;&#x7684;&#x5B89;&#x88C5;&#x6307;&#x793A;&#x3002;</p>
<h2 id="41-&#x5B50;&#x8FDB;&#x7A0B;&#x901A;&#x4FE1;subprocess-communication">4.1 &#x5B50;&#x8FDB;&#x7A0B;&#x901A;&#x4FE1;(Subprocess Communication)</h2>
<p>system&#x548C;process&#x4E24;&#x4E2A;&#x8FC7;&#x7A0B;&#x7528;&#x6765;&#x521B;&#x5EFA;&#x5B50;&#x8FDB;&#x7A0B;&#x3002;&#x8FD9;&#x4E24;&#x4E2A;&#x8FC7;&#x7A0B;&#x90FD;&#x63A5;&#x53D7;&#x4E00;&#x4E2A;string&#x7C7B;&#x578B;&#x53C2;&#x6570;&#xFF0C;&#x521B;&#x5EFA;&#x4E00;&#x4E2A;&#x5B50;&#x8FDB;&#x7A0B;&#x6765;&#x6267;&#x884C;string&#x4E2D;&#x7684;shell&#x547D;&#x4EE4;&#x3002;system&#x8FC7;&#x7A0B;&#x5728;&#x8FD4;&#x56DE;&#x524D;&#x7B49;&#x5F85;&#x8FDB;&#x7A0B;&#x9000;&#x51FA;&#xFF0C;&#x800C;process&#x8FC7;&#x7A0B;&#x7ACB;&#x5373;&#x8FD4;&#x56DE;&#xFF0C;&#x5E76;&#x4E0D;&#x7B49;&#x5F85;&#x8FDB;&#x7A0B;&#x9000;&#x51FA;&#x3002;&#x7531;system&#x521B;&#x5EFA;&#x7684;&#x5B50;&#x8FDB;&#x7A0B;&#x7684;&#x6807;&#x51C6;&#x8F93;&#x5165;&#x548C;&#x8F93;&#x51FA;&#x6587;&#x4EF6;&#x53EF;&#x4EE5;&#x88AB;&#x7528;&#x4E8E;&#x4E0E;&#x7528;&#x6237;console&#x7684;&#x901A;&#x4FE1;&#x3002;&#x7531;process&#x521B;&#x5EFA;&#x7684;&#x5B50;&#x8FDB;&#x7A0B;&#x7684;&#x6807;&#x51C6;&#x8F93;&#x5165;&#x548C;&#x8F93;&#x51FA;&#x6587;&#x4EF6;&#x53EF;&#x4EE5;&#x88AB;&#x7528;&#x4E8E;&#x540C;scheme&#x8FDB;&#x7A0B;&#x7684;&#x901A;&#x4FE1;&#x3002;</p>
<p>&#x8FC7;&#x7A0B;: (system command)
&#x8FD4;&#x56DE;: &#x89C1;&#x4E0B;&#x6587;
&#x5E93;: (chezscheme)</p>
<p>command &#x5FC5;&#x987B;&#x662F;string&#x7C7B;&#x578B;</p>
<p>system&#x8FC7;&#x7A0B;&#x521B;&#x5EFA;&#x4E00;&#x4E2A;&#x5B50;&#x8FDB;&#x7A0B;&#x6765;&#x6267;&#x884C;&#x7531;command&#x4E2D;&#x6307;&#x5B9A;&#x7684;&#x6307;&#x4EE4;&#x3002;&#x5B50;&#x8FDB;&#x7A0B;&#x53EF;&#x901A;&#x8FC7;&#x540C;&#x4E00;console&#x7684;&#x8F93;&#x5165;&#x8F93;&#x51FA;&#x6587;&#x4EF6;&#xFF08;&#x7531;Scheme procss&#x4F7F;&#x7528;&#xFF09;&#x4E0E;&#x7528;&#x6237;&#x901A;&#x4FE1;&#x3002;&#x5728;&#x521B;&#x5EFA;&#x5B8C;&#x5B50;&#x8FDB;&#x7A0B;&#x540E;&#xFF0C;system&#x5728;&#x5176;&#x8FD4;&#x56DE;&#x524D;&#x4E00;&#x76F4;&#x7B49;&#x5F85;&#x5B50;&#x8FDB;&#x7A0B;&#x9000;&#x51FA;&#x3002;</p>
<p>&#x5F53;&#x5B50;&#x8FDB;&#x7A0B;&#x9000;&#x51FA;&#x65F6;&#xFF0C;system&#x8FD4;&#x56DE;&#x5B50;&#x8FDB;&#x7A0B;&#x7684;&#x9000;&#x51FA;&#x7801;,&#x9664;&#x975E;signal&#x5BFC;&#x81F4;&#x5B50;&#x8FDB;&#x7A0B;&#x7EC8;&#x6B62;(&#x5982;&#x5728;&#x7C7B;Unix&#x7CFB;&#x7EDF;&#x4E2D;)&#x3002;&#x5728;&#x8BE5;&#x60C5;&#x51B5;&#x4E0B;&#xFF0C;system&#x8FD4;&#x56DE;&#x5F15;&#x8D77;&#x8FDB;&#x7A0B;&#x7EC8;&#x6B62;&#x7684;&#x4FE1;&#x53F7;&#x7684;&#x8D1F;&#x6570;&#xFF0C;&#x5982;SIGHUP&#x4E3A;-1&#x3002;</p>
<p>&#x8FC7;&#x7A0B;: (open-process-ports command)
&#x8FC7;&#x7A0B;: (open-process-ports command b-mode)
&#x8FC7;&#x7A0B;: (open-process-ports command b-mode ?transcoder)
&#x8FD4;&#x56DE;: &#x89C1;&#x4E0B;&#x6587;
&#x5E93;: (chezscheme)</p>
<p>command &#x5FC5;&#x987B;&#x662F;string&#x7C7B;&#x578B;&#x3002;&#x5982;&#x679C;?transcoder&#x5B58;&#x5728;&#x4E14;&#x4E0D;&#x662F;#f&#xFF0C;&#x4E14;&#x5176;&#x5FC5;&#x987B;&#x662F;transcoder&#xFF0C;&#x8BE5;&#x8FC7;&#x7A0B;&#x521B;&#x5EFA;&#x4E86;&#x6587;&#x672C;&#x7AEF;&#x53E3;&#xFF0C;&#x6BCF;&#x4E2A;&#x7AEF;&#x53E3;&#x7684;transcoder&#x4E3A;?transcoder&#x3002;&#x5426;&#x5219;&#xFF0C;&#x8BE5;&#x8FC7;&#x7A0B;&#x8FD4;&#x56DE;&#x4E8C;&#x8FDB;&#x5236;&#x7AEF;&#x53E3;&#x3002;b-mode&#x6307;&#x5B9A;&#x8BE5;&#x8FC7;&#x7A0B;&#x8FD4;&#x56DE;&#x7684;&#x6BCF;&#x4E2A;&#x7AEF;&#x53E3;&#x7684;buffer&#x6A21;&#x5F0F;&#xFF0C;&#x9ED8;&#x8BA4;&#x4E3A;block&#x3002;buffer&#x6A21;&#x5F0F;&#x5728;&#x300A;The Scheme Programming Language, 4th Edition&#x300B;&#x7684;7.2&#x8282;&#x4ECB;&#x7ECD;&#x3002;</p>
<p>open-process-ports&#x521B;&#x5EFA;&#x5B50;&#x8FDB;&#x7A0B;&#x6267;&#x884C;&#x7531;command&#x6307;&#x5B9A;&#x7684;&#x6307;&#x4EE4;&#x3002;&#x4E0E;system&#x548C;process&#x4E0D;&#x540C;&#x5904;&#x662F;&#x5176;&#x5728;&#x521B;&#x5EFA;&#x5B50;&#x8FDB;&#x7A0B;&#x540E;&#x7ACB;&#x5373;&#x8FD4;&#x56DE;,&#x5373;&#x4E0D;&#x7B49;&#x5F85;&#x5B50;&#x8FDB;&#x7A0B;&#x7ED3;&#x675F;&#x3002;&#x5176;&#x8FD4;&#x56DE;&#x56DB;&#x4E2A;&#x503C;&#xFF1A;</p>
<ol>
<li>to-stdin &#x662F;&#x8F93;&#x51FA;&#x7AEF;&#x53E3;&#xFF0C;Scheme&#x80FD;&#x591F;&#x4F7F;&#x7528;&#x8BE5;&#x7AEF;&#x53E3;&#x901A;&#x8FC7;&#x5B50;&#x8FDB;&#x7A0B;&#x7684;&#x6807;&#x51C6;&#x8F93;&#x5165;&#x6587;&#x4EF6;&#x53D1;&#x9001;&#x8F93;&#x51FA;&#x5185;&#x5BB9;&#x5230;&#x5B50;&#x8FDB;&#x7A0B;&#x3002;</li>
<li>from-stdout &#x662F;&#x8F93;&#x5165;&#x7AEF;&#x53E3;&#xFF0C;Scheme&#x80FD;&#x591F;&#x4F7F;&#x7528;&#x8BE5;&#x7AEF;&#x53E3;&#x901A;&#x8FC7;&#x5B50;&#x8FDB;&#x7A0B;&#x7684;&#x6807;&#x51C6;&#x8F93;&#x51FA;&#x6587;&#x4EF6;&#x8BFB;&#x53D6;&#x5B50;&#x8FDB;&#x7A0B;&#x7684;&#x8F93;&#x51FA;&#x5185;&#x5BB9;&#x3002;</li>
<li>from-stderr &#x662F;&#x8F93;&#x5165;&#x7AEF;&#x53E3;&#xFF0C;Scheme&#x80FD;&#x591F;&#x4F7F;&#x7528;&#x8BE5;&#x7AEF;&#x53E3;&#x901A;&#x8FC7;&#x5B50;&#x8FDB;&#x7A0B;&#x7684;&#x6807;&#x51C6;&#x9519;&#x8BEF;&#x6587;&#x4EF6;&#x8BFB;&#x53D6;&#x5B50;&#x8FDB;&#x7A0B;&#x7684;&#x8F93;&#x51FA;&#x5185;&#x5BB9;&#x3002;</li>
<li>process-id &#x662F;&#x4E2A;&#x6574;&#x6570;&#xFF0C;&#x7531;&#x64CD;&#x4F5C;&#x7CFB;&#x7EDF;&#x5206;&#x914D;&#xFF0C;&#x7528;&#x4E8E;&#x8BC6;&#x522B;&#x521B;&#x5EFA;&#x7684;&#x5B50;&#x8FDB;&#x7A0B;&#x3002;</li>
</ol>
<p>&#x5982;&#x679C;&#x5B50;&#x8FDB;&#x7A0B;&#x9000;&#x51FA;&#x6216;&#x8005;&#x5173;&#x95ED;&#x6807;&#x51C6;&#x8F93;&#x51FA;&#x6587;&#x4EF6;&#x63CF;&#x8FF0;&#x7B26;,&#x4EFB;&#x4F55;&#x4ECE;from-stdout&#x8BFB;&#x53D6;&#x5185;&#x5BB9;&#x7684;&#x8FC7;&#x7A0B;&#x5C06;&#x4F1A;&#x8FD4;&#x56DE;end-of-file&#x5BF9;&#x8C61;&#x3002;&#x7C7B;&#x4F3C;&#x7684;&#xFF0C;&#x5982;&#x679C;&#x5B50;&#x8FDB;&#x7A0B;&#x9000;&#x51FA;&#x6216;&#x8005;&#x5173;&#x95ED;&#x6807;&#x51C6;&#x9519;&#x8BEF;&#x6587;&#x4EF6;&#x63CF;&#x8FF0;&#x7B26;&#xFF0C;&#x4EFB;&#x4F55;&#x4ECE;from-stderr&#x8BFB;&#x53D6;&#x5185;&#x5BB9;&#x7684;&#x8FC7;&#x7A0B;&#x4F1A;&#x8FD4;&#x56DE;end-of-file&#x5BF9;&#x8C61;&#x3002;(&#x8BD1;&#x8005;&#x6CE8;&#xFF1A;&#x539F;&#x6587;&#x4E3A;process&#x8FDB;&#x7A0B;&#xFF0C;&#x800C;&#x975E;&#x5B50;&#x8FDB;&#x7A0B;)</p>
<p>&#x5224;&#x65AD;input-port-ready?&#x53EF;&#x88AB;&#x7528;&#x4E8E;&#x68C0;&#x6D4B;&#x662F;&#x5426;&#x6709;&#x6765;&#x81EA;&#x5B50;&#x8FDB;&#x7A0B;&#x7684;&#x8F93;&#x51FA;&#x5185;&#x5BB9;&#x5230;&#x8FBE;Scheme&#x3002;</p>
<p>&#x6709;&#x65F6;&#x9700;&#x8981;&#x7ACB;&#x5373;&#x5F3A;&#x5236;&#x8F93;&#x51FA;&#x5185;&#x5BB9;&#x5230;&#x5B50;&#x8FDB;&#x7A0B;&#x53EF;&#x5728;to-stdin&#x4E0A;&#x8C03;&#x7528;flush-output-port&#xFF0C;Chez Scheme&#x7531;&#x4E8E;&#x6548;&#x7387;&#x539F;&#x56E0;&#x7F13;&#x51B2;&#x8F93;&#x51FA;&#x3002;</p>
<p>&#x5728;Unix&#x7CFB;&#x7EDF;&#x4E2D;&#xFF0C;process-id&#x662F;&#x6267;&#x884C;command&#x7684;shell&#x7684;&#x8FDB;&#x7A0B;&#x63CF;&#x8FF0;&#x7B26;&#x3002;&#x5982;&#x679C;command&#x7528;&#x4E8E;&#x8C03;&#x7528;&#x53EF;&#x6267;&#x884C;&#x6587;&#x4EF6;&#x800C;&#x975E;shell&#x547D;&#x4EE4;&#xFF0C;&#x9700;&#x8981;&#x5728;command&#x4E4B;&#x524D;&#x52A0;&#x4E0A;&quot;exec&quot;&#xFF0C;&#x8FD9;&#x6837;shell&#x4F1A;&#x76F4;&#x63A5;&#x52A0;&#x8F7D;&#x548C;&#x6267;&#x884C;&#x53EF;&#x6267;&#x884C;&#x6587;&#x4EF6;&#xFF0C;&#x800C;&#x4E0D;&#x4F1A;fork&#x4E00;&#x4E2A;&#x65B0;&#x8FDB;&#x7A0B;--&#x5C3E;&#x9012;&#x5F52;&#x7684;shell&#x7B49;&#x6548;&#x3002;&#x8FD9;&#x4F1A;&#x51CF;&#x5C11;&#x4E00;&#x4E2A;&#x521B;&#x5EFA;&#x7684;&#x5B50;&#x8FDB;&#x7A0B;&#x7684;&#x6570;&#x91CF;&#xFF0C;&#x4ECE;&#x800C;&#x4F7F;&#x5F97;process-id&#x53CD;&#x5E94;&#x6267;&#x884C;&#x6587;&#x4EF6;&#x7684;&#x8FDB;&#x7A0B;&#x63CF;&#x8FF0;&#x7B26;&#xFF0C;&#x4E00;&#x65E6;shell&#x5B8C;&#x6210;&#x8F6C;&#x79FB;&#x63A7;&#x5236;&#x3002;</p>
<p>&#x8FC7;&#x7A0B;: (process command)
&#x8FD4;&#x56DE;: &#x89C1;&#x89E3;&#x91CA;
&#x5E93;: (chezscheme)</p>
<p>command &#x5FC5;&#x987B;&#x662F;string&#x7C7B;&#x578B;&#x3002;</p>
<p>process&#x4E0E;open-process-ports&#x7C7B;&#x4F3C;&#xFF0C;&#x4F46;&#x4E0D;&#x90A3;&#x4E48;&#x4E00;&#x822C;&#x5316;&#x3002;&#x5B83;&#x4E0D;&#x8FD4;&#x56DE;&#x80FD;&#x591F;&#x8BFB;&#x53D6;&#x5B50;&#x8FDB;&#x7A0B;&#x6807;&#x51C6;&#x9519;&#x8BEF;&#x8F93;&#x51FA;&#x7684;&#x7AEF;&#x53E3;&#xFF0C;&#x800C;&#x4E14;&#x5B83;&#x603B;&#x662F;&#x521B;&#x5EFA;&#x6587;&#x672C;&#x7AEF;&#x53E3;&#x3002;&#x5B83;&#x8FD4;&#x56DE;&#x4E09;&#x4E2A;&#x503C;&#x7684;list&#xFF0C;&#x800C;&#x4E0D;&#x662F;&#x50CF;open-process-ports&#x90A3;&#x6837;&#x56DB;&#x4E2A;&#x72EC;&#x7ACB;&#x7684;&#x503C;&#x3002;&#x8FD4;&#x56DE;&#x7684;list&#x4F9D;&#x6B21;&#x5305;&#x542B;&#xFF1A;from-stdout, to-stdin, process-id&#x3002;&#x5206;&#x522B;&#x5BF9;&#x5E94;open-process-ports&#x8FD4;&#x56DE;&#x503C;&#x5F97;&#x7B2C;&#x4E8C;&#xFF0C;&#x7B2C;&#x4E00;&#xFF0C;&#x7B2C;&#x56DB;&#x4E2A;&#x8FD4;&#x56DE;&#x503C;&#x3002;</p>
<h2 id="42-&#x5BFC;&#x5165;scheme-calling-out-of-scheme">4.2 &#x5BFC;&#x5165;Scheme (Calling out of Scheme)</h2>
<p>Chez Scheme&#x7684;foreign-procedure&#x63A5;&#x53E3;&#x5141;&#x8BB8;Scheme&#x7A0B;&#x5E8F;&#x8C03;&#x7528;&#x7531;C&#x6216;&#x8005;&#x7531;&#x9075;&#x5FAA;C&#x8C03;&#x7528;&#x89C4;&#x5219;&#x7684;&#x8BED;&#x8A00;&#x7F16;&#x5199;&#x7684;&#x8FC7;&#x7A0B;&#x3002;&#x5728;&#x5916;&#x90E8;&#x8FC7;&#x7A0B;&#x80FD;&#x591F;&#x88AB;Scheme&#x8C03;&#x7528;&#x4E4B;&#x524D;&#x9700;&#x8981;&#x5B8C;&#x6210;&#x4E24;&#x4E2A;&#x6B65;&#x9AA4;&#x3002;&#x7B2C;&#x4E00;&#xFF0C;&#x5916;&#x90E8;&#x8FC7;&#x7A0B;&#x5FC5;&#x987B;&#x88AB;&#x7F16;&#x8BD1;&#x548C;&#x52A0;&#x8F7D;&#xFF0C;&#x52A8;&#x6001;&#x6216;&#x8005;&#x9759;&#x6001;&#x7684;&#x52A0;&#x8F7D;&#x5F62;&#x5F0F;&#xFF0C;&#x5982;&#x5728;4.6&#x8282;&#x6240;&#x8FF0;&#x3002;&#x7136;&#x540E;&#xFF0C;&#x5916;&#x90E8;&#x8FC7;&#x7A0B;&#x7684;&#x5165;&#x53E3;&#x5FC5;&#x987B;&#x5728;Scheme&#x4E2D;&#x5EFA;&#x7ACB;&#xFF0C;&#x5982;&#x672C;&#x8282;&#x6240;&#x8FF0;&#x3002;&#x4E00;&#x65E6;&#x5916;&#x90E8;&#x8FC7;&#x7A0B;&#x7684;&#x5165;&#x53E3;&#x5EFA;&#x7ACB;&#xFF0C;&#x5C31;&#x80FD;&#x591F;&#x50CF;&#x666E;&#x901A;Scheme&#x8FC7;&#x7A0B;&#x90A3;&#x6837;&#x88AB;&#x8C03;&#x7528;&#x3002;</p>
<p>&#x7531;&#x4E8E;&#x5916;&#x90E8;&#x8FC7;&#x7A0B;&#x7684;&#x64CD;&#x4F5C;&#x72EC;&#x7ACB;&#x4E8E;Scheme&#x7684;&#x5185;&#x5B58;&#x7BA1;&#x7406;&#x548C;&#x5F02;&#x5E38;&#x5904;&#x7406;&#x7CFB;&#x7EDF;&#xFF0C;&#x5728;&#x4F7F;&#x7528;&#x5B83;&#x4EEC;&#x7684;&#x65F6;&#x5019;&#x9700;&#x8981;&#x591A;&#x52A0;&#x5C0F;&#x5FC3;&#x3002;&#x5C3D;&#x7BA1;&#xFF0C;foreign-procedure&#x63A5;&#x53E3;&#x63D0;&#x4F9B;&#x7C7B;&#x578B;&#x68C0;&#x67E5;&#xFF08;&#x5728;&#x5C0F;&#x4E8E;&#x4E09;&#x7EA7;&#x4F18;&#x5316;&#x4E0B;&#xFF09;&#x548C;&#x7C7B;&#x578B;&#x8F6C;&#x6362;&#xFF0C;&#x7A0B;&#x5E8F;&#x5458;&#x5FC5;&#x987B;&#x786E;&#x4FDD;Scheme&#x4E0E;&#x5916;&#x90E8;&#x8FC7;&#x7A0B;&#x4E4B;&#x95F4;&#x7684;&#x5171;&#x4EAB;&#x6570;&#x636E;&#x88AB;&#x5B89;&#x5168;&#x5730;&#x6307;&#x5B9A;&#x4E86;&#x5408;&#x9002;&#x7684;&#x53C2;&#x6570;&#x548C;&#x7ED3;&#x679C;&#x7C7B;&#x578B;&#x3002;</p>
<p>&#x5916;&#x90E8;&#x8FC7;&#x7A0B;&#x7684;Scheme&#x53EF;&#x8C03;&#x7528;&#x5C01;&#x88C5;&#xFF08;Scheme-callable wrappers&#xFF09;&#x80FD;&#x591F;&#x901A;&#x8FC7;ftype-ref&#x548C;function ftypes&#x521B;&#x5EFA;&#xFF08;&#x89C1;4.5&#x8282;&#xFF09;&#x3002;</p>
<p>&#x8BED;&#x6CD5;: (foreign-procedure conv ... entry-exp (param-type ...) res-type)
&#x8FD4;&#x56DE;: &#x4E00;&#x4E2A;&#x8FC7;&#x7A0B;
&#x5E93;: (chezscheme)</p>
<p>entry-exp&#x5FC5;&#x987B;&#x662F;&#x4EE3;&#x8868;&#x6709;&#x6548;&#x5916;&#x90E8;&#x8FC7;&#x7A0B;&#x5165;&#x53E3;&#x7684;string&#x7C7B;&#x578B;&#xFF0C;&#x6216;&#x4EE3;&#x8868;&#x5916;&#x90E8;&#x8FC7;&#x7A0B;&#x5730;&#x5740;&#x7684;integer&#x7C7B;&#x578B;&#x3002;param-types&#x548C;res-type&#x5FC5;&#x987B;&#x662F;symbols&#x6216;&#x5982;&#x4E0B;&#x6240;&#x8FF0;&#x7684;&#x7ED3;&#x6784;&#x5316;&#x5F62;&#x5F0F;&#x3002;&#x5F53;foreign-procedure&#x8868;&#x8FBE;&#x5F0F;&#x88AB;&#x6C42;&#x503C;&#xFF0C;&#x4E00;&#x4E2A;&#x80FD;&#x8C03;&#x7528;&#x4EE5;entry-exp&#x6307;&#x5B9A;&#x7684;&#x5916;&#x90E8;&#x8FC7;&#x7A0B;&#x7684;Scheme&#x8FC7;&#x7A0B;&#x88AB;&#x521B;&#x5EFA;&#x3002;&#x5916;&#x90E8;&#x8FC7;&#x7A0B;&#x7684;&#x8C03;&#x7528;&#x7ED3;&#x679C;&#x901A;&#x8FC7;&#x8F6C;&#x6362;&#x540E;&#x88AB;&#x6307;&#x5B9A;&#x4E3A;res-type&#x7C7B;&#x578B;&#x3002;&#x53EF;&#x4EE5;&#x5BF9;&#x540C;&#x4E00;&#x4E2A;&#x5916;&#x90E8;&#x5165;&#x53E3;&#x521B;&#x5EFA;&#x591A;&#x4E2A;Scheme&#x8FC7;&#x7A0B;&#x3002;</p>
<p>&#x6BCF;&#x4E2A;conv&#x7528;&#x6765;&#x6307;&#x5B9A;&#x8C03;&#x7528;&#x89C4;&#x5219;&#x3002;conv&#x53EF;&#x4EE5;&#x662F;#f&#xFF0C;&#x4EE3;&#x8868;&#x76EE;&#x6807;&#x673A;&#x5668;&#x4E0A;&#x7684;&#x9ED8;&#x8BA4;&#x8C03;&#x7528;&#x89C4;&#x5219;&#xFF08;&#x6240;&#x4EE5;#f&#x6CA1;&#x6709;&#x6548;&#x679C;&#xFF09;&#x3002;&#x5728;Windows&#x4E0B;&#xFF0C;&#x53E6;&#x5916;&#x4E09;&#x4E2A;&#x76EE;&#x524D;&#x652F;&#x6301;&#x7684;&#x8C03;&#x7528;&#x89C4;&#x5219;&#x662F;<strong>stdcall, </strong>cdecl&#xFF0C;&#x548C;<strong>com (&#x53EA;&#x652F;&#x6301;32&#x4F4D;)&#x3002;&#x56E0;&#x4E3A;</strong>cdecl&#x662F;&#x9ED8;&#x8BA4;&#x7684;&#xFF0C;&#x6307;&#x5B9A;<strong>cdecl&#x4E0E;&#x6307;&#x5B9A;#f&#x6216;&#x8005;&#x4E0D;&#x6307;&#x5B9A;&#x662F;&#x4E00;&#x6837;&#x7684;&#x3002;&#x6700;&#x540E;&#xFF0C;conv&#x4E5F;&#x53EF;&#x4EE5;&#x662F;</strong>collect_safe&#xFF0C;&#x7528;&#x6765;&#x6307;&#x5B9A;&#x5728;&#x5916;&#x90E8;&#x8FC7;&#x7A0B;&#x8FD0;&#x884C;&#x65F6;&#xFF0C;&#x5E76;&#x53D1;&#x5141;&#x8BB8;&#x5783;&#x573E;&#x56DE;&#x6536;&#x3002;</p>
<p>&#x4F7F;&#x7528;<strong>stdcall&#x80FD;&#x591F;&#x4F7F;&#x7528;&#x5927;&#x591A;&#x6570;Windows API&#x8FC7;&#x7A0B;&#x3002;&#x5BF9;&#x4E8E;Windows API&#x53D8;&#x53C2;&#x6570;&#x8FC7;&#x7A0B;&#xFF0C;C&#x8BED;&#x8A00;&#x5E93;&#x8FC7;&#x7A0B;&#xFF0C;&#x548C;&#x5927;&#x591A;&#x6570;&#x5176;&#x4ED6;&#x8FC7;&#x7A0B;&#xFF0C;&#x53EF;&#x4EE5;&#x4F7F;&#x7528;</strong>cdecl&#x3002;&#x4F7F;&#x7528;<strong>com&#x53EF;&#x8C03;&#x7528;COM&#x63A5;&#x53E3;&#x65B9;&#x6CD5;&#xFF1B;COM&#x4F7F;&#x7528;</strong>stdcall&#x89C4;&#x5219;&#xFF0C;&#x4F46;&#x662F;&#x989D;&#x5916;&#x589E;&#x52A0;&#x4E86;&#x5FC5;&#x987B;&#x7684;&#x95F4;&#x63A5;&#x64CD;&#x4F5C;&#x6765;&#x83B7;&#x53D6;COM&#x5B9E;&#x4F8B;&#x7684;&#x6B63;&#x786E;&#x65B9;&#x6CD5;&#x3002;COM&#x5B9E;&#x4F8B;&#x7684;&#x5730;&#x5740;&#x5FC5;&#x987B;&#x4EE5;&#x7B2C;&#x4E00;&#x4E2A;&#x53C2;&#x6570;&#x4F20;&#x9012;&#xFF0C;&#x5FC5;&#x987B;&#x88AB;&#x58F0;&#x660E;&#x4E3A;iptr&#x3002;&#x53EA;&#x6709;__com&#x63A5;&#x53E3;&#xFF0C;entry-exp&#x5FC5;&#x987B;&#x88AB;&#x6307;&#x5B9A;&#x4E3A;COM vtable&#xFF08;COM&#x865A;&#x8868;&#xFF09;&#x4E2D;&#x7684;&#x5B57;&#x8282;&#x504F;&#x79FB;&#x3002;&#x4F8B;&#x5982;&#xFF0C;</p>
<p><code>(foreign-procedure __com 12 (iptr double-float) integer-32)</code></p>
<p>&#x521B;&#x5EFA;&#x4E00;&#x4E2A;&#x5728;COM&#x5B9E;&#x4F8B;&#x7684;vtable&#x4E2D;&#x504F;&#x79FB;12&#x5B57;&#x8282;&#x7684;COM&#x65B9;&#x6CD5;&#x7684;&#x63A5;&#x53E3;&#xFF0C;COM&#x5B9E;&#x4F8B;&#x5728;&#x7B2C;&#x4E00;&#x4E2A;&#x53C2;&#x6570;&#x4E2D;&#x4F20;&#x9012;&#xFF0C;&#x7B2C;&#x4E8C;&#x4E2A;&#x53C2;&#x6570;&#x662F;double float&#xFF0C;&#x8FD4;&#x56DE;&#x503C;&#x7C7B;&#x578B;&#x662F;integer&#x3002;</p>
<p>&#x4F7F;&#x7528;<strong>collect_safe&#x58F0;&#x660E;&#x5141;&#x8BB8;&#x5728;&#x5916;&#x90E8;&#x51FD;&#x6570;&#x8C03;&#x7528;&#x65F6;&#xFF0C;&#x5E76;&#x53D1;&#x5141;&#x8BB8;&#x5783;&#x573E;&#x56DE;&#x6536;&#x3002;</strong>collect_safe&#x58F0;&#x660E;&#x5141;&#x8BB8;&#x5E76;&#x53D1;&#x56DE;&#x6536;&#x3002;&#x901A;&#x8FC7;&#x5728;&#x5916;&#x90E8;&#x8FC7;&#x7A0B;&#x8C03;&#x7528;&#x65F6;&#x6291;&#x5236;&#x5F53;&#x524D;&#x7EBF;&#x7A0B;&#xFF08;&#x89C1;fork-thread&#xFF09;&#xFF0C;&#x5F53;&#x5916;&#x90E8;&#x51FD;&#x6570;&#x8FD4;&#x56DE;&#x65F6;&#x7EBF;&#x7A0B;&#x518D;&#x6B21;&#x6FC0;&#x6D3B;&#x3002;<strong>collect_safe&#x58F0;&#x660E;&#x662F;&#x6709;&#x7528;&#x7684;&#xFF0C;&#x4F8B;&#x5982;&#xFF0C;&#x5F53;&#x8C03;&#x7528;&#x5305;&#x542B;I/O&#x963B;&#x585E;&#x7684;&#x8C03;&#x7528;&#x65F6;&#xFF0C;&#x5141;&#x8BB8;&#x5176;&#x4ED6;Scheme&#x7EBF;&#x7A0B;&#x6B63;&#x5E38;&#x8FD0;&#x884C;&#x3002;&#x907F;&#x514D;&#x4F20;&#x9012;&#x53EF;&#x56DE;&#x6536;&#x7684;&#x5185;&#x5B58;&#x5230;</strong>collect_safe&#x7684;&#x5916;&#x90E8;&#x8FC7;&#x7A0B;&#xFF0C;&#x6216;&#x8005;&#x4F7F;&#x7528;lock-object&#x6765;&#x9501;&#x5B9A;&#x5185;&#x5B58;&#xFF1B;&#xFF08;&#x53C2;&#x8003;Sdeactivate_thread&#xFF09;&#x3002;__collect_safe&#x58F0;&#x660E;&#x5BF9;&#x4E8E;&#x975E;&#x7EBF;&#x7A0B;&#x7248;&#x672C;&#x7684;&#x7CFB;&#x7EDF;&#x662F;&#x6CA1;&#x6709;&#x6548;&#x679C;&#x7684;&#x3002;</p>
<p>&#x4F8B;&#x5982;&#xFF0C;&#x4EE5;&#x9ED8;&#x8BA4;&#x89C4;&#x5219;&#x8C03;&#x7528;C sleep&#x51FD;&#x6570;&#x4F1A;&#x963B;&#x585E;&#x5176;&#x4ED6;Scheme&#x7EBF;&#x7A0B;&#x6267;&#x884C;&#x5783;&#x573E;&#x56DE;&#x6536;&#xFF0C;&#x4F46;&#x662F;&#x52A0;&#x5165;__collect_safe&#x58F0;&#x660E;&#x540E;&#x53EF;&#x4EE5;&#x907F;&#x514D;&#x8BE5;&#x95EE;&#x9898;&#xFF1A;</p>
<pre><code>(define c-sleep
  (foreign-procedure __collect_safe &quot;sleep&quot; (unsigned) unsigned))
(c-sleep 10) ; &#x7761;&#x7720;10&#x79D2;&#x949F;&#x800C;&#x4E0D;&#x963B;&#x585E;&#x5176;&#x4ED6;&#x7EBF;&#x7A0B;
</code></pre><p>&#x5982;&#x679C;&#x4EE5;<strong>collect_safe&#x65B9;&#x5F0F;&#x8C03;&#x7528;&#x7684;&#x5916;&#x90E8;&#x8FC7;&#x7A0B;&#x80FD;&#x591F;&#x8C03;&#x7528;&#x8FC7;&#x7A0B;&#xFF0C;&#x90A3;&#x4E48;&#x88AB;&#x8C03;&#x7528;&#x7684;&#x8FC7;&#x7A0B;&#x4E5F;&#x5FC5;&#x987B;&#x662F;</strong>collect_safe&#x65B9;&#x5F0F;&#xFF0C;&#x8FD9;&#x6837;&#x88AB;&#x8C03;&#x7528;&#x7684;&#x8FC7;&#x7A0B;&#x624D;&#x80FD;&#x91CD;&#x65B0;&#x6FC0;&#x6D3B;&#x7EBF;&#x7A0B;&#x3002;</p>
<p>&#x5BF9;&#x5916;&#x90E8;&#x8FC7;&#x7A0B;&#x7684;&#x53C2;&#x6570;&#x8FDB;&#x884C;&#x5B8C;&#x6574;&#x7684;&#x7C7B;&#x578B;&#x68C0;&#x67E5;&#x548C;&#x8F6C;&#x6362;&#x3002;&#x5728;&#x4F7F;&#x7528;scheme-object, string, wstring, u8<em>, u16</em>, u32*, utf-8, utf-16le, utf-16be, utf-32le, and utf-32be&#x8FD9;&#x4E9B;&#x7C7B;&#x578B;&#x65F6;&#x9700;&#x8981;&#x7279;&#x522B;&#x5C0F;&#x5FC3;&#xFF0C;&#x56E0;&#x4E3A;&#x8FD9;&#x4E9B;&#x5206;&#x914D;&#x51FA;&#x6765;&#x7684;Scheme&#x5BF9;&#x8C61;&#x5141;&#x8BB8;&#x5728;Scheme&#x5185;&#x5B58;&#x7BA1;&#x7406;&#x7CFB;&#x7EDF;&#x63A7;&#x5236;&#x4E0D;&#x80FD;&#x63A7;&#x5236;&#x7684;&#x5730;&#x65B9;&#x88AB;&#x4F7F;&#x7528;&#x3002;&#x53EA;&#x8981;&#x8FD9;&#x4E9B;&#x5BF9;&#x8C61;&#x6216;&#x8005;&#x6570;&#x636E;&#x7ED3;&#x6784;&#x4E0D;&#x5728;Scheme&#x4EE3;&#x7801;&#x8FD0;&#x884C;&#x65F6;&#x4FDD;&#x5B58;&#x5728;&#x5916;&#x90E8;&#x53D8;&#x91CF;&#x4E2D;&#xFF0C;&#x4E14;&#x53EA;&#x8981;&#x4ED6;&#x4EEC;&#x4E0D;&#x662F;&#x88AB;&#x4F20;&#x9012;&#x5230;__collect_safe&#x8FC7;&#x7A0B;&#x4E2D;&#xFF0C;&#x5C31;&#x4E0D;&#x4F1A;&#x53D1;&#x751F;&#x95EE;&#x9898;&#xFF0C;&#x56E0;&#x4E3A;&#x5783;&#x573E;&#x56DE;&#x6536;&#x53EA;&#x6709;&#x5728;Scheme&#x4EE3;&#x7801;&#x8FD0;&#x884C;&#x65F6;&#x6216;&#x8005;&#x5F53;&#x5E76;&#x53D1;&#x5783;&#x573E;&#x56DE;&#x6536;&#x88AB;&#x5F00;&#x542F;&#x7684;&#x60C5;&#x51B5;&#x4E0B;&#x624D;&#x6267;&#x884C;&#x3002;&#x5176;&#x4ED6;&#x53C2;&#x6570;&#x7C7B;&#x578B;&#x88AB;&#x7B49;&#x4EF7;&#x8F6C;&#x6362;&#x6210;&#x5916;&#x90E8;&#x8868;&#x793A;&#x65B9;&#x5F0F;&#xFF0C;&#x4ED6;&#x4EEC;&#x80FD;&#x591F;&#x65E0;&#x671F;&#x9650;&#x5730;&#x88AB;&#x4FDD;&#x5B58;&#x5728;&#x5916;&#x90E8;&#x53D8;&#x91CF;&#x548C;&#x6570;&#x636E;&#x7ED3;&#x6784;&#x4E2D;&#x3002;</p>
<p>&#x5BF9;&#x4E8E;string, wstring, utf-8, utf-16le, utf-16be, utf-32le, and utf-32be&#x53C2;&#x6570;&#x7C7B;&#x578B;&#xFF0C;&#x4E00;&#x4E2A;&#x53C2;&#x6570;&#x4F1A;&#x88AB;&#x8F6C;&#x6362;&#x6210;&#x4E00;&#x4E2A;&#x65B0;&#x7684;&#x5BF9;&#x8C61;&#x540E;&#x518D;&#x4F20;&#x7ED9;&#x5916;&#x90E8;&#x8FC7;&#x7A0B;&#x3002;&#x56E0;&#x4E3A;&#x65B0;&#x7684;&#x5BF9;&#x8C61;&#x5728;&#x8C03;&#x7528;&#x524D;&#x4E0D;&#x80FD;&#x88AB;&#x9501;&#x5B9A;&#xFF0C;&#x5B83;&#x4E0D;&#x4F1A;&#x88AB;<strong>collect_safe&#x5916;&#x90E8;&#x8FC7;&#x7A0B;&#x6B63;&#x786E;&#x5904;&#x7406;&#xFF0C;&#x6240;&#x4EE5;&#x8FD9;&#x4E9B;&#x7C7B;&#x578B;&#x4E0D;&#x5141;&#x8BB8;&#x4F5C;&#x4E3A;</strong>collect_safe&#x5916;&#x90E8;&#x8FC7;&#x7A0B;&#x7684;&#x53C2;&#x6570;&#x7C7B;&#x578B;&#x3002;&#x57FA;&#x4E8E;&#x7C7B;&#x4F3C;&#x7684;&#x7406;&#x7531;&#xFF0C;&#x8FD9;&#x4E9B;&#x7C7B;&#x578B;&#x4E5F;&#x4E0D;&#x5141;&#x8BB8;&#x4F5C;&#x4E3A;__collect_safe&#x5916;&#x90E8;&#x8C03;&#x7528;&#x7684;&#x8FD4;&#x56DE;&#x503C;&#x7C7B;&#x578B;&#x3002;</p>
<p>&#x4EE5;&#x4E0B;&#x662F;&#x5408;&#x6CD5;&#x7684;&#x53C2;&#x6570;&#x7C7B;&#x578B;&#xFF1A;</p>
<p>integer-8: &#x4ECE;-2<sup>7</sup> &#x5230; 2<sup>8</sup> - 1 &#x7684;&#x6574;&#x6570;&#x6709;&#x6548;&#x3002; 2<sup>7</sup>  &#x5230; 2<sup>8</sup> - 1 &#x8303;&#x56F4;&#x5185;&#x7684;&#x6574;&#x6570;&#x88AB;&#x8BA4;&#x4E3A;&#x662F;&#x8D1F;&#x6570;&#x7684;&#x8865;&#x5145;&#x8868;&#x793A;&#xFF0C;&#x5982; #xff &#x662F; -1&#x3002;&#x53C2;&#x6570;&#x4F5C;&#x4E3A;&#x4E00;&#x4E2A;&#x5408;&#x9002;&#x5927;&#x5C0F;&#x7684;&#x6574;&#x6570;&#x7C7B;&#x578B;&#x4F20;&#x9012;&#x7ED9;C&#xFF08;&#x901A;&#x5E38;&#x662F;signed char&#xFF09;&#x3002;</p>
<p>unsigned-8: &#x4ECE; -2<sup>7</sup> &#x5230; 2<sup>8</sup> - 1 &#x7684;&#x6574;&#x6570;&#x6709;&#x6548;&#x3002; -2<sup>7</sup> &#x5230; -1&#x8303;&#x56F4;&#x5185;&#x7684;&#x6574;&#x6570;&#x88AB;&#x8BA4;&#x4E3A;&#x662F;&#x6574;&#x6570;&#x7684;&#x8865;&#x5145;&#x8868;&#x793A;&#xFF0C;&#x5982; -1 &#x662F; #xff&#x3002;&#x53C2;&#x6570;&#x4F5C;&#x4E3A;&#x4E00;&#x4E2A;&#x5408;&#x9002;&#x5927;&#x5C0F;&#x7684;&#x6574;&#x6570;&#x7C7B;&#x578B;&#x4F20;&#x9012;&#x7ED9;C&#xFF08;&#x901A;&#x5E38;&#x662F;unsigned char&#xFF09;&#x3002;</p>
<p>integer-16: &#x4ECE; -2<sup>15</sup> &#x5230; 2<sup>16</sup> - 1 &#x7684;&#x6574;&#x6570;&#x6709;&#x6548;&#x3002;2<sup>15</sup>  &#x5230; 2<sup>16</sup> - 1 &#x8303;&#x56F4;&#x5185;&#x7684;&#x6574;&#x6570;&#x88AB;&#x8BA4;&#x4E3A;&#x662F;&#x8D1F;&#x6570;&#x7684;&#x8865;&#x5145;&#x8868;&#x793A;&#xFF0C;&#x5982; #xffff &#x662F; -1&#x3002;&#x53C2;&#x6570;&#x4F5C;&#x4E3A;&#x4E00;&#x4E2A;&#x5408;&#x9002;&#x5927;&#x5C0F;&#x7684;&#x6574;&#x6570;&#x7C7B;&#x578B;&#x4F20;&#x9012;&#x7ED9;C (&#x901A;&#x5E38;&#x662F;short)&#x3002;</p>
<p>unsigned-16: &#x4ECE; -2<sup>15</sup> &#x5230; 2<sup>16</sup> - 1 &#x7684;&#x6574;&#x6570;&#x6709;&#x6548;&#x3002;-2<sup>15</sup> &#x5230; -1&#x8303;&#x56F4;&#x5185;&#x7684;&#x6574;&#x6570;&#x88AB;&#x8BA4;&#x4E3A;&#x662F;&#x6574;&#x6570;&#x7684;&#x8865;&#x5145;&#x8868;&#x793A;&#xFF0C;&#x5982; -1 &#x662F; #xffff&#x3002;&#x53C2;&#x6570;&#x4F5C;&#x4E3A;&#x4E00;&#x4E2A;&#x5408;&#x9002;&#x5927;&#x5C0F;&#x7684;&#x6574;&#x6570;&#x7C7B;&#x578B;&#x4F20;&#x9012;&#x7ED9;C (&#x901A;&#x5E38;&#x662F; unsigned short)&#x3002;</p>
<p>integer-32: &#x4ECE; -2<sup>31</sup> &#x5230; 2<sup>32</sup> - 1 &#x7684;&#x6574;&#x6570;&#x6709;&#x6548;&#x3002;2<sup>31</sup>  &#x5230; 2<sup>32</sup> - 1 &#x8303;&#x56F4;&#x5185;&#x7684;&#x6574;&#x6570;&#x88AB;&#x8BA4;&#x4E3A;&#x662F;&#x8D1F;&#x6570;&#x7684;&#x8865;&#x5145;&#x8868;&#x793A;&#xFF0C;&#x5982; #xffffffff &#x662F; -1&#x3002;&#x53C2;&#x6570;&#x4F5C;&#x4E3A;&#x4E00;&#x4E2A;&#x5408;&#x9002;&#x5927;&#x5C0F;&#x7684;&#x6574;&#x6570;&#x7C7B;&#x578B;&#x4F20;&#x9012;&#x7ED9;C&#xFF08;&#x901A;&#x5E38;&#x662F;int&#xFF09;&#x3002;</p>
<p>unsigned-32: &#x4ECE; -2<sup>31</sup> &#x5230; 2<sup>32</sup> - 1 &#x7684;&#x6574;&#x6570;&#x6709;&#x6548;&#x3002;-2<sup>31</sup> &#x5230; -1&#x8303;&#x56F4;&#x5185;&#x7684;&#x6574;&#x6570;&#x88AB;&#x8BA4;&#x4E3A;&#x662F;&#x6574;&#x6570;&#x7684;&#x8865;&#x5145;&#x8868;&#x793A;&#xFF0C;&#x5982; -1 &#x662F; #xffffffff. &#x53C2;&#x6570;&#x4F5C;&#x4E3A;&#x4E00;&#x4E2A;&#x5408;&#x9002;&#x5927;&#x5C0F;&#x7684;&#x6574;&#x6570;&#x7C7B;&#x578B;&#x4F20;&#x9012;&#x7ED9;C&#xFF08;&#x901A;&#x5E38;&#x662F;unsigned int&#xFF09;&#x3002;</p>
<p>integer-64: &#x4ECE; -2<sup>63</sup> &#x5230; 2<sup>64</sup> - 1 &#x7684;&#x6574;&#x6570;&#x6709;&#x6548;&#x3002;2<sup>63</sup>  &#x5230; 2<sup>64</sup> - 1 &#x8303;&#x56F4;&#x5185;&#x7684;&#x6574;&#x6570;&#x88AB;&#x8BA4;&#x4E3A;&#x662F;&#x8D1F;&#x6570;&#x7684;&#x8865;&#x5145;&#x8868;&#x793A;&#x3002;&#x53C2;&#x6570;&#x4F5C;&#x4E3A;&#x4E00;&#x4E2A;&#x5408;&#x9002;&#x5927;&#x5C0F;&#x7684;&#x6574;&#x6570;&#x7C7B;&#x578B;&#x4F20;&#x9012;&#x7ED9;C&#xFF08;&#x901A;&#x5E38;&#x662F;long long&#xFF0C;&#x6216;&#x8005;&#x5728;&#x8BB8;&#x591A;64&#x4F4D;&#x673A;&#x5668;&#x4E0A;long&#xFF09;&#x3002;</p>
<p>unsigned-64: &#x4ECE; -2<sup>63</sup> &#x5230; 2<sup>64</sup> - 1 &#x7684;&#x6574;&#x6570;&#x6709;&#x6548;&#x3002;-2<sup>63</sup> &#x5230; -1&#x8303;&#x56F4;&#x5185;&#x7684;&#x6574;&#x6570;&#x88AB;&#x8BA4;&#x4E3A;&#x662F;&#x6574;&#x6570;&#x7684;&#x8865;&#x5145;&#x8868;&#x793A;&#x3002;&#x53C2;&#x6570;&#x4F5C;&#x4E3A;&#x4E00;&#x4E2A;&#x5408;&#x9002;&#x5927;&#x5C0F;&#x7684;&#x6574;&#x6570;&#x7C7B;&#x578B;&#x4F20;&#x9012;&#x7ED9;C&#xFF08;&#x901A;&#x5E38;&#x662F;unsigned long long&#xFF0C;&#x6216;&#x8005;&#x5728;&#x8BB8;&#x591A;64&#x4F4D;&#x673A;&#x5668;&#x4E0A;unsigned long&#xFF09;(&#x8BD1;&#x8005;&#x6CE8;&#xFF1A;&#x539F;&#x6587;&#x4E3A;long&#xFF09;&#x3002;</p>
<p>double-float: &#x53EA;&#x6709;Scheme flonums&#x6709;&#x6548;--&#x5176;&#x4ED6;Scheme&#x6570;&#x503C;&#x7C7B;&#x578B;&#x4E0D;&#x4F1A;&#x81EA;&#x52A8;&#x8F6C;&#x6362;&#x3002;&#x53C2;&#x6570;&#x4F5C;&#x4E3A;&#x53CC;&#x7CBE;&#x5EA6;double&#x7C7B;&#x578B;&#x4F20;&#x9012;&#x7ED9;C&#x3002;</p>
<p>single-float: &#x53EA;&#x6709;Scheme flonums&#x6709;&#x6548;--&#x5176;&#x4ED6;Scheme&#x6570;&#x503C;&#x7C7B;&#x578B;&#x4E0D;&#x4F1A;&#x81EA;&#x52A8;&#x8F6C;&#x6362;&#x3002;&#x53C2;&#x6570;&#x4F5C;&#x4E3A;&#x5355;&#x7CBE;&#x5EA6;float&#x7C7B;&#x578B;&#x4F20;&#x9012;&#x7ED9;C&#x3002;&#x7531;&#x4E8E;Chez Scheme&#x4EE5;double-float&#x7C7B;&#x578B;&#x8868;&#x793A;flonums&#xFF0C;&#x53C2;&#x6570;&#x9996;&#x5148;&#x4F1A;&#x8F6C;&#x6362;&#x5230;single-float&#x683C;&#x5F0F;&#x3002;</p>
<p>short: &#x8BE5;&#x7C7B;&#x578B;&#x662F;&#x4EE5;&#x4E0A;&#x5408;&#x9002;&#x56FA;&#x5B9A;&#x5927;&#x5C0F;&#x7C7B;&#x578B;&#x7684;&#x522B;&#x540D;&#xFF0C;&#x53D6;&#x51B3;&#x4E8E;C&#x4E2D;short&#x7684;&#x5927;&#x5C0F;&#x3002;</p>
<p>unsigned-short: &#x8BE5;&#x7C7B;&#x578B;&#x662F;&#x4EE5;&#x4E0A;&#x5408;&#x9002;&#x56FA;&#x5B9A;&#x5927;&#x5C0F;&#x7C7B;&#x578B;&#x7684;&#x522B;&#x540D;&#xFF0C;&#x53D6;&#x51B3;&#x4E8E;C&#x4E2D;unsigned short&#x7684;&#x5927;&#x5C0F;&#x3002;</p>
<p>int: &#x8BE5;&#x7C7B;&#x578B;&#x662F;&#x4EE5;&#x4E0A;&#x5408;&#x9002;&#x56FA;&#x5B9A;&#x5927;&#x5C0F;&#x7C7B;&#x578B;&#x7684;&#x522B;&#x540D;&#xFF0C;&#x53D6;&#x51B3;&#x4E8E;C&#x4E2D;int&#x7684;&#x5927;&#x5C0F;&#x3002;</p>
<p>unsigned: &#x8BE5;&#x7C7B;&#x578B;&#x662F;&#x4EE5;&#x4E0A;&#x5408;&#x9002;&#x56FA;&#x5B9A;&#x5927;&#x5C0F;&#x7C7B;&#x578B;&#x7684;&#x522B;&#x540D;&#xFF0C;&#x53D6;&#x51B3;&#x4E8E;C&#x4E2D;unsigned&#x7684;&#x5927;&#x5C0F;&#x3002;</p>
<p>unsigned-int: &#x8BE5;&#x7C7B;&#x578B;&#x662F;unsinged&#x7C7B;&#x578B;&#x7684;&#x522B;&#x540D;&#x3002;&#x56FA;&#x5B9A;&#x5927;&#x5C0F;&#x7C7B;&#x578B;&#xFF0C;&#x53D6;&#x51B3;&#x4E8E;C&#x4E2D;unsigned&#x7684;&#x5927;&#x5C0F;&#x3002;</p>
<p>long: &#x8BE5;&#x7C7B;&#x578B;&#x662F;&#x4EE5;&#x4E0A;&#x5408;&#x9002;&#x56FA;&#x5B9A;&#x5927;&#x5C0F;&#x7C7B;&#x578B;&#x7684;&#x522B;&#x540D;&#xFF0C;&#x53D6;&#x51B3;&#x4E8E;C&#x4E2D;long&#x7684;&#x5927;&#x5C0F;&#x3002;</p>
<p>unsigned-long: &#x8BE5;&#x7C7B;&#x578B;&#x662F;&#x4EE5;&#x4E0A;&#x5408;&#x9002;&#x56FA;&#x5B9A;&#x5927;&#x5C0F;&#x7C7B;&#x578B;&#x7684;&#x522B;&#x540D;&#xFF0C;&#x53D6;&#x51B3;&#x4E8E;C&#x4E2D;unsigned long&#x7684;&#x5927;&#x5C0F;&#x3002;</p>
<p>long-long: &#x8BE5;&#x7C7B;&#x578B;&#x662F;&#x4EE5;&#x4E0A;&#x5408;&#x9002;&#x56FA;&#x5B9A;&#x5927;&#x5C0F;&#x7C7B;&#x578B;&#x7684;&#x522B;&#x540D;&#xFF0C;&#x53D6;&#x51B3;&#x4E8E;&#x975E;&#x6807;&#x51C6;C&#x4E2D;long long&#x7684;&#x5927;&#x5C0F;&#x3002;</p>
<p>unsigned-long-long: &#x8BE5;&#x7C7B;&#x578B;&#x662F;&#x4EE5;&#x4E0A;&#x5408;&#x9002;&#x56FA;&#x5B9A;&#x5927;&#x5C0F;&#x7C7B;&#x578B;&#x7684;&#x522B;&#x540D;&#xFF0C;&#x53D6;&#x51B3;&#x4E8E;&#x975E;&#x6807;&#x51C6;C&#x4E2D;unsigned long long&#x7684;&#x5927;&#x5C0F;&#x3002;</p>
<p>ptrdiff_t: &#x8BE5;&#x7C7B;&#x578B;&#x662F;&#x4EE5;&#x4E0A;&#x5408;&#x9002;&#x56FA;&#x5B9A;&#x5927;&#x5C0F;&#x7C7B;&#x578B;&#x7684;&#x522B;&#x540D;&#xFF0C;&#x53D6;&#x51B3;&#x4E8E;&#x5728;&#x5BBF;&#x4E3B;&#x673A;&#x5668;stddef.h&#x5934;&#x6587;&#x4EF6;&#x4E2D;&#x7684;&#x5B9A;&#x4E49;&#x3002;</p>
<p>size_t: &#x8BE5;&#x7C7B;&#x578B;&#x662F;&#x4EE5;&#x4E0A;&#x5408;&#x9002;&#x56FA;&#x5B9A;&#x5927;&#x5C0F;&#x65E0;&#x7B26;&#x53F7;&#x7C7B;&#x578B;&#x7684;&#x522B;&#x540D;&#xFF0C;&#x53D6;&#x51B3;&#x4E8E;&#x5728;&#x5BBF;&#x4E3B;&#x673A;&#x5668;stddef.h&#x5934;&#x6587;&#x4EF6;&#x4E2D;&#x7684;&#x5B9A;&#x4E49;&#x3002;</p>
<p>ssize_t: &#x8BE5;&#x7C7B;&#x578B;&#x662F;&#x4EE5;&#x4E0A;&#x5408;&#x9002;&#x56FA;&#x5B9A;&#x5927;&#x5C0F;&#x6709;&#x7B26;&#x53F7;&#x7C7B;&#x578B;&#x7684;&#x522B;&#x540D;&#xFF0C;&#x53D6;&#x51B3;&#x4E8E;&#x5728;&#x5BBF;&#x4E3B;&#x673A;&#x5668;stddef.h&#x5934;&#x6587;&#x4EF6;&#x4E2D;&#x7684;&#x5B9A;&#x4E49;&#x3002;</p>
<p>iptr: &#x8BE5;&#x7C7B;&#x578B;&#x662F;&#x4EE5;&#x4E0A;&#x5408;&#x9002;&#x56FA;&#x5B9A;&#x5927;&#x5C0F;&#x7C7B;&#x578B;&#x7684;&#x522B;&#x540D;&#xFF0C;&#x53D6;&#x51B3;&#x4E8E;C&#x4E2D;&#x6307;&#x9488;&#x7C7B;&#x578B;&#x7684;&#x5927;&#x5C0F;&#x3002;</p>
<p>uptr: &#x8BE5;&#x7C7B;&#x578B;&#x662F;&#x4EE5;&#x4E0A;&#x5408;&#x9002;&#x56FA;&#x5B9A;&#x5927;&#x5C0F;&#xFF08;&#x65E0;&#x7B26;&#x53F7;&#xFF09;&#x7C7B;&#x578B;&#x7684;&#x522B;&#x540D;&#xFF0C;&#x53D6;&#x51B3;&#x4E8E;C&#x4E2D;&#x6307;&#x9488;&#x7C7B;&#x578B;&#x7684;&#x5927;&#x5C0F;&#x3002;</p>
<p>void*: &#x8BE5;&#x7C7B;&#x578B;&#x662F;uptr&#x7684;&#x522B;&#x540D;&#x3002;</p>
<p>fixnum: &#x8BE5;&#x7C7B;&#x578B;&#x7B49;&#x6548;&#x4E8E;iptr&#xFF0C;&#x9664;&#x4E86;&#x5728;fixnum&#x8303;&#x56F4;&#x5185;&#x7684;&#x6570;&#x503C;&#x6709;&#x6548;&#x3002;&#x4F20;&#x8F93;fixnums&#x6BD4;&#x4F20;&#x8F93;iptr&#x503C;&#x7A0D;&#x5FAE;&#x5FEB;&#x4E00;&#x70B9;&#xFF0C;&#x4F46;&#x662F;fixnum&#x7684;&#x8303;&#x56F4;&#x66F4;&#x5C0F;&#xFF0C;&#x6240;&#x4EE5;&#x6709;&#x6548;iptr&#x503C;&#x6CA1;&#x6709;fixnum&#x7684;&#x8868;&#x793A;&#x3002;</p>
<p>boolean: &#x4EFB;&#x4F55;Scheme&#x5BF9;&#x8C61;&#x53EF;&#x4EE5;&#x88AB;&#x5F53;&#x505A;boolean&#x4F20;&#x9012;&#x3002;#f&#x4F1A;&#x88AB;&#x8F6C;&#x6362;&#x4E3A;0&#x3002;&#x6240;&#x6709;&#x5176;&#x4ED6;&#x5BF9;&#x8C61;&#x88AB;&#x8F6C;&#x6362;&#x4E3A;1&#x3002;&#x53C2;&#x6570;&#x4EE5;int&#x7C7B;&#x578B;&#x4F20;&#x9012;&#x7ED9;C&#x3002;</p>
<p>char: &#x53EA;&#x6709;Scheme&#x5B57;&#x7B26;&#x548C;&#x5728;0~255&#x8303;&#x56F4;&#x7684;Unicode&#x6807;&#x91CF;&#x503C;&#x662F;&#x6709;&#x6548;char&#x53C2;&#x6570;&#x3002;&#x5B57;&#x7B26;&#x901A;&#x8FC7;char-&gt;integer&#x88AB;&#x8F6C;&#x6362;&#x4E3A;Unicode&#x6807;&#x91CF;&#x503C;&#xFF0C;&#x4EE5;unsigned char&#x7C7B;&#x578B;&#x4F20;&#x9012;&#x7ED9;C&#x3002;</p>
<p>wchar_t: &#x53EA;&#x6709;Scheme&#x7684;&#x5B57;&#x7B26;&#x662F;&#x6709;&#x6548;wchar_t&#x53C2;&#x6570;&#x3002;&#x5728;Windows&#x548C;&#x5176;&#x4ED6;&#x4EFB;&#x4F55;wchar_t&#x53EA;&#x6709;16bit&#x503C;&#x800C;&#x4E0D;&#x662F;&#x6240;&#x6709;Unicode&#x6807;&#x91CF;&#x503C;&#x7684;&#x7CFB;&#x7EDF;&#x4E2D;&#xFF0C;&#x53EA;&#x6709;16bit Unicode&#x6807;&#x91CF;&#x503C;&#x7684;&#x5B57;&#x7B26;&#x6709;&#x6548;&#x3002;&#x5728;wchar_t&#x65F6;32bit&#x503C;&#x5F97;&#x7CFB;&#x7EDF;&#x4E2D;&#xFF0C;&#x4EFB;&#x4F55;Scheme&#x5B57;&#x7B26;&#x662F;&#x6709;&#x6548;&#x7684;&#x3002;&#x5B57;&#x7B26;&#x901A;&#x8FC7;char-&gt;integer&#x88AB;&#x8F6C;&#x6362;&#x6210;Unicode&#x6807;&#x91CF;&#x503C;&#xFF0C;&#x4EE5;wchar_t&#x7C7B;&#x578B;&#x4F20;&#x9012;&#x7ED9;C&#x3002;</p>
<p>wchar: &#x8BE5;&#x7C7B;&#x578B;&#x662F;wchar_t&#x7684;&#x522B;&#x540D;&#x3002;</p>
<p>double: &#x8BE5;&#x7C7B;&#x578B;&#x662F;double-float&#x7684;&#x522B;&#x540D;&#x3002;</p>
<p>float: &#x8BE5;&#x7C7B;&#x578B;&#x662F;single-float&#x7684;&#x522B;&#x540D;&#x3002;</p>
<p>scheme-object: &#x8BE5;&#x53C2;&#x6570;&#x76F4;&#x63A5;&#x4F20;&#x9012;&#x7ED9;&#x5916;&#x90E8;&#x8FC7;&#x7A0B;&#xFF1B;&#x6CA1;&#x6709;&#x8F6C;&#x6362;&#xFF0C;&#x6CA1;&#x6709;&#x7C7B;&#x578B;&#x68C0;&#x67E5;&#x3002;&#x8FD9;&#x79CD;&#x5F62;&#x5F0F;&#x7684;&#x53C2;&#x6570;&#x4F20;&#x9012;&#x5E94;&#x8BE5;&#x88AB;&#x8C28;&#x614E;&#x4F7F;&#x7528;&#x3002;Scheme objects&#x4E0D;&#x8BE5;&#x88AB;&#x4FDD;&#x5B58;&#x5728;&#x5916;&#x90E8;&#x53D8;&#x91CF;&#x6216;&#x6570;&#x636E;&#x7ED3;&#x6784;&#x4E2D;&#xFF0C;&#x56E0;&#x4E3A;&#x5185;&#x5B58;&#x7BA1;&#x7406;&#x7CFB;&#x7EDF;&#x4F1A;&#x5728;&#x5916;&#x90E8;&#x51FD;&#x6570;&#x8C03;&#x7528;&#x7684;&#x95F4;&#x9699;&#x91CD;&#x5B9A;&#x4F4D;&#x5B83;&#x4EEC;&#x3002;</p>
<p>ptr: &#x8BE5;&#x7C7B;&#x578B;&#x662F;scheme-object&#x7684;&#x522B;&#x540D;&#x3002;</p>
<p>u8*: &#x8BE5;&#x53C2;&#x6570;&#x5FC5;&#x987B;&#x662F;Scheme bytevector&#x6216;&#x8005;#f&#x7C7B;&#x578B;&#x3002;&#x5BF9;&#x4E8E;#f&#xFF0C;null pointer (0)&#x88AB;&#x4F20;&#x9012;&#x7ED9;&#x5916;&#x90E8;&#x8FC7;&#x7A0B;&#x3002;&#x5BF9;&#x4E8E;bytevector&#xFF0C;&#x6307;&#x5411;bytevector&#x6570;&#x636E;&#x7684;&#x7B2C;&#x4E00;&#x4E2A;&#x5B57;&#x8282;&#x7684;&#x6307;&#x9488;&#x88AB;&#x4F20;&#x9012;&#x7ED9;&#x5916;&#x90E8;&#x8FC7;&#x7A0B;&#x3002;&#x5982;&#x679C;&#x88AB;&#x4F20;&#x9012;&#x6570;&#x636E;&#x7684;C&#x7A0B;&#x5E8F;&#x8981;&#x6C42;&#x8F93;&#x5165;&#x4EE5;&apos;\0&apos;&#x7ED3;&#x5C3E;&#xFF0C;&#x90A3;&#x4E48; null (0)&#x5B57;&#x8282;&#x5FC5;&#x987B;&#x88AB;&#x663E;&#x793A;&#x5305;&#x542B;&#x5728;bytevector&#x4E2D;&#x3002;bytevector&#x4E0D;&#x5E94;&#x8BE5;&#x88AB;&#x4FDD;&#x5B58;&#x5728;&#x5916;&#x90E8;&#x53D8;&#x91CF;&#x6216;&#x6570;&#x636E;&#x7ED3;&#x6784;&#x4E2D;&#xFF0C;&#x56E0;&#x4E3A;&#x5185;&#x5B58;&#x7BA1;&#x7406;&#x7CFB;&#x7EDF;&#x4F1A;&#x5728;&#x5916;&#x90E8;&#x51FD;&#x6570;&#x8C03;&#x7528;&#x95F4;&#x9699;&#x91CD;&#x5B9A;&#x4F4D;&#x6216;&#x4E22;&#x53BB;&#x5B83;&#x4EEC;&#xFF0C;&#x628A;&#x5B83;&#x4EEC;&#x7684;&#x50A8;&#x5B58;&#x7A7A;&#x95F4;&#x53E6;&#x505A;&#x4ED6;&#x7528;&#x3002;</p>
<p>u16<em>: &#x53EF;&#x628A;&#x8BE5;&#x7C7B;&#x578B;&#x7684;&#x53C2;&#x6570;&#x4E0E;u8</em>&#x7C7B;&#x578B;&#x7684;&#x53C2;&#x6570;&#x540C;&#x6837;&#x770B;&#x5F85;&#x3002;&#x5982;&#x679C;&#x88AB;&#x4F20;&#x9012;&#x6570;&#x636E;&#x7684;C&#x7A0B;&#x5E8F;&#x8981;&#x6C42;&#x8F93;&#x5165;&#x4EE5;&apos;\0&apos;&#x7ED3;&#x5C3E;&#xFF0C;&#x90A3;&#x4E48;&#x4E24;&#x4E2A;null (0)&#x5B57;&#x8282;&#x5FC5;&#x987B;&#x88AB;&#x663E;&#x793A;&#x5305;&#x542B;&#x5728;bytevector&#x4E2D;&#xFF0C;&#x4EE5;16bit&#x8FB9;&#x754C;&#x5BF9;&#x9F50;&#x3002;</p>
<p>u32<em>: &#x53EF;&#x628A;&#x8BE5;&#x7C7B;&#x578B;&#x7684;&#x53C2;&#x6570;&#x4E0E;u8</em>&#x7C7B;&#x578B;&#x7684;&#x53C2;&#x6570;&#x540C;&#x6837;&#x770B;&#x5F85;&#x3002;&#x5982;&#x679C;&#x88AB;&#x4F20;&#x9012;&#x6570;&#x636E;&#x7684;C&#x7A0B;&#x5E8F;&#x8981;&#x6C42;&#x8F93;&#x5165;&#x4EE5;&apos;\0&apos;&#x7ED3;&#x5C3E;&#xFF0C;&#x90A3;&#x4E48;&#x56DB;&#x4E2A;null (0)&#x5B57;&#x8282;&#x5FC5;&#x987B;&#x88AB;&#x663E;&#x793A;&#x5305;&#x542B;&#x5728;bytevector&#x4E2D;&#xFF0C;&#x4EE5;32bit&#x8FB9;&#x754C;&#x5BF9;&#x9F50;&#x3002;</p>
<p>utf-8: &#x8BE5;&#x53C2;&#x6570;&#x5FC5;&#x987B;&#x662F;Scheme string&#x7C7B;&#x578B;&#x6216;&#x8005;#f&#x3002;&#x5BF9;&#x4E8E;#f&#xFF0C;null pointer (0)&#x88AB;&#x4F20;&#x9012;&#x7ED9;&#x5916;&#x90E8;&#x8FC7;&#x7A0B;&#x3002;string&#x88AB;&#x8F6C;&#x6362;&#x6210;bytevector&#xFF0C;&#x597D;&#x50CF;&#x901A;&#x8FC7;string-utf8&#x4E00;&#x6837;&#xFF0C;&#x589E;&#x52A0;&#x4E86;null&#x5B57;&#x8282;&#xFF0C;&#x7B2C;&#x4E00;&#x4E2A;bytevector&#x7B2C;&#x4E00;&#x4E2A;&#x5B57;&#x8282;&#x7684;&#x5730;&#x5740;&#x88AB;&#x4F20;&#x9012;&#x7ED9;C&#x3002;bytevector&#x4E0D;&#x5E94;&#x8BE5;&#x88AB;&#x4FDD;&#x5B58;&#x5728;&#x5916;&#x90E8;&#x53D8;&#x91CF;&#x6216;&#x6570;&#x636E;&#x7ED3;&#x6784;&#x4E2D;&#xFF0C;&#x56E0;&#x4E3A;&#x5185;&#x5B58;&#x7BA1;&#x7406;&#x7CFB;&#x7EDF;&#x4F1A;&#x5728;&#x5916;&#x90E8;&#x51FD;&#x6570;&#x8C03;&#x7528;&#x95F4;&#x9699;&#x91CD;&#x5B9A;&#x4F4D;&#x6216;&#x4E22;&#x53BB;&#x5B83;&#x4EEC;&#xFF0C;&#x628A;&#x5B83;&#x4EEC;&#x7684;&#x50A8;&#x5B58;&#x7A7A;&#x95F4;&#x53E6;&#x505A;&#x4ED6;&#x7528;&#x3002;__collect_safe&#x6307;&#x5B9A;&#x7684;&#x5916;&#x90E8;&#x8FC7;&#x7A0B;&#x4E0D;&#x5141;&#x8BB8;utf-8&#x53C2;&#x6570;&#x7C7B;&#x578B;&#x3002;</p>
<p>utf-16le: &#x53EF;&#x628A;&#x8BE5;&#x7C7B;&#x578B;&#x7684;&#x53C2;&#x6570;&#x4E0E;utf-8&#x7C7B;&#x578B;&#x7684;&#x53C2;&#x6570;&#x540C;&#x6837;&#x770B;&#x5F85;&#xFF0C;&#x9664;&#x4E86;&#x4ED6;&#x4EEC;&#x597D;&#x50CF;&#x901A;&#x8FC7;string-&gt;utf16&#x8F6C;&#x6362;&#x4E00;&#x6837;&#xFF0C;&#x4EE5;endianness little&#x65B9;&#x5F0F;&#xFF0C;&#x540E;&#x9762;&#x8FFD;&#x52A0;&#x4E86;&#x4E24;&#x4E2A;null&#x5B57;&#x8282;&#x800C;&#x4E0D;&#x662F;&#x4E00;&#x4E2A;&#x3002;</p>
<p>utf-16be: &#x53EF;&#x628A;&#x8BE5;&#x7C7B;&#x578B;&#x7684;&#x53C2;&#x6570;&#x4E0E;utf-8&#x7C7B;&#x578B;&#x7684;&#x53C2;&#x6570;&#x540C;&#x6837;&#x770B;&#x5F85;&#xFF0C;&#x9664;&#x4E86;&#x4ED6;&#x4EEC;&#x597D;&#x50CF;&#x901A;&#x8FC7;string-&gt;utf16&#x8F6C;&#x6362;&#x4E00;&#x6837;&#xFF0C;&#x4EE5;endianness big&#x65B9;&#x5F0F;&#xFF0C;&#x540E;&#x9762;&#x8FFD;&#x52A0;&#x4E86;&#x4E24;&#x4E2A;null&#x5B57;&#x8282;&#x800C;&#x4E0D;&#x662F;&#x4E00;&#x4E2A;&#x3002;</p>
<p>utf-32le: &#x53EF;&#x628A;&#x8BE5;&#x7C7B;&#x578B;&#x7684;&#x53C2;&#x6570;&#x4E0E;utf-8&#x7C7B;&#x578B;&#x7684;&#x53C2;&#x6570;&#x540C;&#x6837;&#x770B;&#x5F85;&#xFF0C;&#x9664;&#x4E86;&#x4ED6;&#x4EEC;&#x597D;&#x50CF;&#x901A;&#x8FC7;string-&gt;utf32&#x8F6C;&#x6362;&#x4E00;&#x6837;&#xFF0C;&#x4EE5;endianness little&#x65B9;&#x5F0F;&#xFF0C;&#x540E;&#x9762;&#x8FFD;&#x52A0;&#x4E86;&#x56DB;&#x4E2A;null&#x5B57;&#x8282;&#x800C;&#x4E0D;&#x662F;&#x4E00;&#x4E2A;&#x3002;</p>
<p>utf-32be: &#x53EF;&#x628A;&#x8BE5;&#x7C7B;&#x578B;&#x7684;&#x53C2;&#x6570;&#x4E0E;utf-8&#x7C7B;&#x578B;&#x7684;&#x53C2;&#x6570;&#x540C;&#x6837;&#x770B;&#x5F85;&#xFF0C;&#x9664;&#x4E86;&#x4ED6;&#x4EEC;&#x597D;&#x50CF;&#x901A;&#x8FC7;string-&gt;utf32&#x8F6C;&#x6362;&#x4E00;&#x6837;&#xFF0C;&#x4EE5;endianness big&#x65B9;&#x5F0F;&#xFF0C;&#x540E;&#x9762;&#x8FFD;&#x52A0;&#x4E86;&#x56DB;&#x4E2A;null&#x5B57;&#x8282;&#x800C;&#x4E0D;&#x662F;&#x4E00;&#x4E2A;&#x3002;</p>
<p>string: &#x8BE5;&#x7C7B;&#x578B;&#x662F;utf-8&#x7684;&#x522B;&#x540D;&#x3002;</p>
<p>wstring: &#x8BE5;&#x7C7B;&#x578B;&#x662F;utf-16le&#xFF0C;utf-16be&#xFF0C;utf-32le&#xFF0C;&#x6216;utf-32be&#x7684;&#x522B;&#x540D;&#xFF0C;&#x53D6;&#x51B3;&#x4E8E;C&#x4E2D;wchar_t&#x7684;&#x5927;&#x5C0F;&#x548C;&#x76EE;&#x6807;&#x673A;&#x5668;&#x7684;endianness&#x3002;&#x4F8B;&#x5982;&#xFF0C;&#x5728;Intel&#x5904;&#x7406;&#x5668;&#x7684;Windows&#x7CFB;&#x7EDF;&#x4E2D;wstring&#x7B49;&#x6548;&#x4E8E;utf-16le&#x3002;</p>
<p>(* ftype): &#x8BE5;&#x7C7B;&#x578B;&#x5141;&#x8BB8;&#x5916;&#x90E8;&#x7C7B;&#x578B;ftype&#x7684;&#x6307;&#x9488;&#x88AB;&#x4F20;&#x9012;&#x3002;&#x53C2;&#x6570;&#x5FC5;&#x987B;&#x662F;&#x7C7B;&#x578B;ftype&#x7684;ftype&#x6307;&#x9488;&#xFF0C;&#x771F;&#x5B9E;&#x7684;&#x53C2;&#x6570;&#x662F;ftype&#x6307;&#x9488;&#x6240;&#x5C01;&#x88C5;&#x7684;&#x5730;&#x5740;&#x3002;&#x89C1;4.5&#x8282;&#x5916;&#x90E8;&#x7C7B;&#x578B;&#x63CF;&#x8FF0;&#x3002;</p>
<p>(&amp; ftype): &#x8BE5;&#x7C7B;&#x578B;&#x5141;&#x8BB8;&#x5916;&#x90E8;&#x7C7B;&#x578B;ftype&#x4EE5;&#x503C;&#x5F97;&#x5F62;&#x5F0F;&#x4F20;&#x9012;&#xFF0C;&#x4F46;&#x662F;&#x5728;Scheme&#x65B9;&#x9762;&#x662F;&#x4EE5;&#x5916;&#x90E8;&#x7C7B;&#x578B;&#x6570;&#x636E;&#x7684;&#x6307;&#x9488;&#x65B9;&#x5F0F;&#x3002;&#x4E5F;&#x5C31;&#x662F;&#x8BF4;&#xFF0C; (&amp; ftype) &#x53C2;&#x6570;&#x5728;Scheme&#x65B9;&#x9762;&#x4E0E; (* ftype) &#x53C2;&#x6570;&#x4E00;&#x6837;&#xFF0C;&#x4F46;&#x662F; (&amp; ftype) &#x53C2;&#x6570;&#x662F;&#x4EE5;&#x5916;&#x90E8;&#x6307;&#x9488;&#x5730;&#x5740;&#x4E2D;&#x7684;&#x5185;&#x5BB9;&#x800C;&#x975E;&#x5730;&#x5740;&#x4F20;&#x9012;&#x7ED9;&#x5916;&#x90E8;&#x8FC7;&#x7A0B;&#x3002;&#x4F8B;&#x5982;&#xFF0C;&#x5982;&#x679C;ftype&#x662F;struct&#x7C7B;&#x578B;&#xFF0C;&#x90A3;&#x4E48;(&amp; ftype)&#x4F20;&#x9012;struct&#x53C2;&#x6570;&#x800C;&#x4E0D;&#x662F;struct-pointer&#x53C2;&#x6570;&#x3002;ftype&#x4E0D;&#x80FD;&#x5F15;&#x7528;array&#x7C7B;&#x578B;&#x3002;</p>
<p>&#x8FD4;&#x56DE;&#x503C;&#x7C7B;&#x578B;&#x548C;&#x53C2;&#x6570;&#x7C7B;&#x578B;&#x60C5;&#x51B5;&#x7C7B;&#x4F3C;&#xFF0C;&#x589E;&#x52A0;&#x4E86;&#x4E00;&#x4E2A;void&#x7C7B;&#x578B;&#x3002;&#x4E00;&#x822C;&#x6765;&#x8BF4;&#xFF0C;&#x7C7B;&#x578B;&#x8F6C;&#x6362;&#x662F;&#x53C2;&#x6570;&#x7C7B;&#x578B;&#x8F6C;&#x6362;&#x7684;&#x9006;&#x8FC7;&#x7A0B;&#x3002;&#x5728;&#x8FD4;&#x56DE;&#x65F6;&#x706D;&#x6709;&#x9519;&#x8BEF;&#x68C0;&#x67E5;&#xFF0C;&#x5E94;&#x4E3A;&#x7CFB;&#x7EDF;&#x4E0D;&#x80FD;&#x51B3;&#x5B9A;&#x4E00;&#x4E2A;&#x5916;&#x90E8;&#x7ED3;&#x679C;&#x662F;&#x5426;&#x771F;&#x7684;&#x662F;&#x5176;&#x6240;&#x6307;&#x793A;&#x7684;&#x7C7B;&#x578B;&#x3002;&#x5728;&#x4F7F;&#x7528;&#x8FC7;&#x7A0B;&#x4E2D;&#x9700;&#x8981;&#x7279;&#x522B;&#x6CE8;&#x610F;scheme-object, double-float, double, single-float, float&#x548C;&#x4F1A;&#x521B;&#x5EFA;bytevectors&#x6216;strings&#x7684;&#x7C7B;&#x578B;&#xFF0C;&#x56E0;&#x4E3A;&#x65E0;&#x6548;&#x7684;&#x8FD4;&#x56DE;&#x503C;&#x53EF;&#x80FD;&#x4F1A;&#x5BFC;&#x81F4;&#x4E0D;&#x6B63;&#x786E;&#x7684;&#x5185;&#x5B58;&#x5F15;&#x7528;&#x548C;&#x4E0D;&#x6B63;&#x786E;&#x7684;&#x8BA1;&#x7B97;&#x3002;&#x4EE5;&#x4E0B;&#x662F;&#x6709;&#x6548;&#x7684;&#x8FD4;&#x56DE;&#x503C;&#x7C7B;&#x578B;&#xFF1A;</p>
<p>void: &#x5916;&#x90E8;&#x51FD;&#x6570;&#x8FC7;&#x7A0B;&#x7684;&#x8FD4;&#x56DE;&#x503C;&#x88AB;&#x5FFD;&#x7565;&#xFF0C;&#x672A;&#x6307;&#x5B9A;&#x7684;Scheme&#x5BF9;&#x8C61;&#x88AB;&#x8FD4;&#x56DE;&#x3002;void &#x7528;&#x4E8E;&#x53EA;&#x662F;&#x4EA7;&#x751F;&#x6548;&#x679C;&#x7684;&#x5916;&#x90E8;&#x8FC7;&#x7A0B;&#x7684;&#x8C03;&#x7528;&#x3002;</p>
<p>integer-8: &#x7ED3;&#x679C;&#x88AB;&#x89E3;&#x8BD1;&#x4E3A;signed 8-bit integer&#xFF0C;&#x5E76;&#x8F6C;&#x6362;&#x4E3A;Scheme exact integer&#x3002;</p>
<p>unsigned-8: &#x7ED3;&#x679C;&#x88AB;&#x89E3;&#x8BD1;&#x4E3A;unsigned 8-bit integer&#xFF0C;&#x5E76;&#x8F6C;&#x6362;&#x4E3A;Scheme&#x975E;&#x8D1F;exact integer&#x3002;</p>
<p>integer-16: &#x7ED3;&#x679C;&#x88AB;&#x89E3;&#x8BD1;&#x4E3A;signed 16-bit integer&#xFF0C;&#x5E76;&#x8F6C;&#x6362;&#x4E3A;Scheme exact integer&#x3002;</p>
<p>unsigned-16: &#x7ED3;&#x679C;&#x88AB;&#x89E3;&#x8BD1;&#x4E3A;unsigned 16-bit integer&#xFF0C;&#x5E76;&#x8F6C;&#x6362;&#x4E3A;Scheme&#x975E;&#x8D1F;exact integer&#x3002;</p>
<p>integer-32: &#x7ED3;&#x679C;&#x88AB;&#x89E3;&#x8BD1;&#x4E3A;signed 32-bit integer&#xFF0C;&#x5E76;&#x8F6C;&#x6362;&#x4E3A;Scheme exact integer&#x3002;</p>
<p>unsigned-32: &#x7ED3;&#x679C;&#x88AB;&#x89E3;&#x8BD1;&#x4E3A;unsigned 32-bit integer&#xFF0C;&#x5E76;&#x8F6C;&#x6362;&#x4E3A;Scheme&#x975E;&#x8D1F;exact integer&#x3002;</p>
<p>integer-64: &#x7ED3;&#x679C;&#x88AB;&#x89E3;&#x8BD1;&#x4E3A;signed 64-bit integer&#xFF0C;&#x5E76;&#x8F6C;&#x6362;&#x4E3A;Scheme exact integer&#x3002;</p>
<p>unsigned-64: &#x7ED3;&#x679C;&#x88AB;&#x89E3;&#x8BD1;&#x4E3A;unsigned 64-bit integer&#xFF0C;&#x5E76;&#x8F6C;&#x6362;&#x4E3A;Scheme&#x975E;&#x8D1F;exact integer&#x3002;</p>
<p>double-float: &#x7ED3;&#x679C;&#x88AB;&#x89E3;&#x8BD1;&#x4E3A;&#x53CC;&#x7CBE;&#x5EA6;&#x6D6E;&#x70B9;&#x578B;double float&#xFF0C;&#x5E76;&#x88AB;&#x8F6C;&#x6362;&#x4E3A;Chez Scheme flonum&#x3002;</p>
<p>single-float: &#x7ED3;&#x679C;&#x88AB;&#x89E3;&#x8BD1;&#x4E3A;&#x53CC;&#x7CBE;&#x5EA6;&#x6D6E;&#x70B9;&#x578B;single float&#xFF0C;&#x5E76;&#x88AB;&#x8F6C;&#x6362;&#x4E3A;Chez Scheme flonum&#x3002;&#x56E0;&#x4E3A;Chez Scheme&#x7528;double-float&#x683C;&#x5F0F;&#x8868;&#x793A;flonums&#xFF0C;&#x7ED3;&#x679C;&#x9996;&#x5148;&#x88AB;&#x8F6C;&#x6362;&#x6210;double-float&#x683C;&#x5F0F;&#x3002;</p>
<p>short: &#x8BE5;&#x7C7B;&#x578B;&#x662F;&#x4EE5;&#x4E0A;&#x5408;&#x9002;&#x56FA;&#x5B9A;&#x5927;&#x5C0F;&#x7C7B;&#x578B;&#x7684;&#x522B;&#x540D;&#xFF0C;&#x53D6;&#x51B3;&#x4E8E;C short&#x7684;&#x5927;&#x5C0F;&#x3002;</p>
<p>unsigned-short: &#x8BE5;&#x7C7B;&#x578B;&#x662F;&#x4EE5;&#x4E0A;&#x5408;&#x9002;&#x56FA;&#x5B9A;&#x5927;&#x5C0F;&#x7C7B;&#x578B;&#x7684;&#x522B;&#x540D;,&#x53D6;&#x51B3;&#x4E8E;C unsigned short&#x5927;&#x5C0F;&#x3002;</p>
<p>int: &#x8BE5;&#x7C7B;&#x578B;&#x662F;&#x4EE5;&#x4E0A;&#x5408;&#x9002;&#x56FA;&#x5B9A;&#x5927;&#x5C0F;&#x7C7B;&#x578B;&#x7684;&#x522B;&#x540D;&#xFF0C;&#x53D6;&#x51B3;&#x4E8E;C int&#x7684;&#x5927;&#x5C0F;&#x3002;</p>
<p>unsigned: &#x8BE5;&#x7C7B;&#x578B;&#x662F;&#x4EE5;&#x4E0A;&#x5408;&#x9002;&#x56FA;&#x5B9A;&#x5927;&#x5C0F;&#x7C7B;&#x578B;&#x7684;&#x522B;&#x540D;&#xFF0C;&#x53D6;&#x51B3;&#x4E8E;C unsigned&#x7684;&#x5927;&#x5C0F;&#x3002;</p>
<p>unsigned-int: &#x8BE5;&#x7C7B;&#x578B;&#x662F;&#x4EE5;&#x4E0A;&#x5408;&#x9002;&#x56FA;&#x5B9A;&#x5927;&#x5C0F;&#x7C7B;&#x578B;unsigned&#x7684;&#x522B;&#x540D;&#xFF0C;&#x53D6;&#x51B3;&#x4E8E;C unsigned&#x7684;&#x5927;&#x5C0F;&#x3002;</p>
<p>long: &#x8BE5;&#x7C7B;&#x578B;&#x662F;&#x4EE5;&#x4E0A;&#x5408;&#x9002;&#x56FA;&#x5B9A;&#x5927;&#x5C0F;&#x7C7B;&#x578B;&#x7684;&#x522B;&#x540D;&#xFF0C;&#x53D6;&#x51B3;&#x4E8E;C long&#x7684;&#x5927;&#x5C0F;&#x3002;</p>
<p>unsigned-long: &#x8BE5;&#x7C7B;&#x578B;&#x662F;&#x4EE5;&#x4E0A;&#x5408;&#x9002;&#x56FA;&#x5B9A;&#x5927;&#x5C0F;&#x7C7B;&#x578B;&#x7684;&#x522B;&#x540D;&#xFF0C;&#x53D6;&#x51B3;&#x4E8E;C unsigned long&#x7684;&#x5927;&#x5C0F;&#x3002;</p>
<p>long-long: &#x8BE5;&#x7C7B;&#x578B;&#x662F;&#x4EE5;&#x4E0A;&#x5408;&#x9002;&#x56FA;&#x5B9A;&#x5927;&#x5C0F;&#x7C7B;&#x578B;&#x7684;&#x522B;&#x540D;&#xFF0C;&#x53D6;&#x51B3;&#x4E8E;&#x975E;&#x6807;&#x51C6;C long long&#x7684;&#x5927;&#x5C0F;&#x3002;</p>
<p>unsigned-long-long: &#x8BE5;&#x7C7B;&#x578B;&#x662F;&#x4EE5;&#x4E0A;&#x5408;&#x9002;&#x56FA;&#x5B9A;&#x5927;&#x5C0F;&#x7C7B;&#x578B;&#x7684;&#x522B;&#x540D;&#xFF0C;&#x53D6;&#x51B3;&#x4E8E;&#x975E;&#x6807;&#x51C6;C unsigned long long&#x7684;&#x5927;&#x5C0F;&#x3002;</p>
<p>ptrdiff_t: &#x8BE5;&#x7C7B;&#x578B;&#x662F;&#x4EE5;&#x4E0A;&#x5408;&#x9002;&#x56FA;&#x5B9A;&#x5927;&#x5C0F;&#x7C7B;&#x578B;&#x7684;&#x522B;&#x540D;&#xFF0C;&#x53D6;&#x51B3;&#x4E8E;&#x5BBF;&#x4E3B;&#x673A;&#x5668;stddef.h&#x5934;&#x6587;&#x4EF6;&#x4E2D;&#x7684;&#x5B9A;&#x4E49;&#x3002;</p>
<p>size_t: &#x8BE5;&#x7C7B;&#x578B;&#x662F;&#x4EE5;&#x4E0A;&#x5408;&#x9002;&#x56FA;&#x5B9A;&#x5927;&#x5C0F;unsigned&#x7C7B;&#x578B;&#x7684;&#x522B;&#x540D;&#xFF0C;&#x53D6;&#x51B3;&#x4E8E;&#x5BBF;&#x4E3B;&#x673A;&#x5668;stddef.h&#x5934;&#x6587;&#x4EF6;&#x4E2D;&#x7684;&#x5B9A;&#x4E49;&#x3002;</p>
<p>ssize_t: &#x8BE5;&#x7C7B;&#x578B;&#x662F;&#x4EE5;&#x4E0A;&#x5408;&#x9002;&#x56FA;&#x5B9A;&#x5927;&#x5C0F;signed&#x7C7B;&#x578B;&#x7684;&#x522B;&#x540D;&#xFF0C;&#x53D6;&#x51B3;&#x4E8E;&#x5BBF;&#x4E3B;&#x673A;&#x5668;stddef.h&#x5934;&#x6587;&#x4EF6;&#x4E2D;&#x7684;&#x5B9A;&#x4E49;&#x3002;</p>
<p>iptr: &#x8BE5;&#x7C7B;&#x578B;&#x662F;&#x4EE5;&#x4E0A;&#x5408;&#x9002;&#x56FA;&#x5B9A;&#x5927;&#x5C0F;&#x7C7B;&#x578B;&#x7684;&#x522B;&#x540D;&#xFF0C;&#x53D6;&#x51B3;&#x4E8E;C&#x4E2D;&#x6307;&#x9488;&#x7684;&#x5927;&#x5C0F;&#x3002;</p>
<p>uptr: &#x8BE5;&#x7C7B;&#x578B;&#x662F;&#x4EE5;&#x4E0A;&#x5408;&#x9002;&#x56FA;&#x5B9A;&#x5927;&#x5C0F;(unsigned)&#x7C7B;&#x578B;&#x7684;&#x522B;&#x540D;&#xFF0C;&#x53D6;&#x51B3;&#x4E8E;C&#x4E2D;&#x6307;&#x9488;&#x7684;&#x5927;&#x5C0F;&#x3002;</p>
<p>void*: &#x8BE5;&#x7C7B;&#x578B;&#x662F;uptr&#x7684;&#x522B;&#x540D;&#x3002;</p>
<p>boolean: &#x8BE5;&#x7C7B;&#x578B;&#x628A;C int&#x8FD4;&#x56DE;&#x503C;&#x8F6C;&#x6362;&#x4E3A;Scheme boolean&#x3002;0&#x4E3A;#f&#xFF0C;&#x5176;&#x4ED6;&#x503C;&#x4E3A;#t&#x3002;</p>
<p>char: &#x8BE5;&#x7C7B;&#x578B;&#x628A;C unsigned char&#x7C7B;&#x578B;&#x8F6C;&#x6362;&#x4E3A;Scheme character&#xFF0C;&#x5C31;&#x50CF;&#x901A;&#x8FC7;integer-&gt;char&#x3002;</p>
<p>wchar_t: &#x8BE5;&#x7C7B;&#x578B;&#x628A;C wchar_t&#x8FD4;&#x56DE;&#x503C;&#x8F6C;&#x5316;&#x4E3A;Scheme character&#xFF0C;&#x5C31;&#x50CF;&#x901A;&#x8FC7;integer-&gt;char&#x3002;wchar_t&#x503C;&#x5FC5;&#x987B;&#x662F;&#x4E00;&#x4E2A;&#x6709;&#x6548;&#x7684;Unicode&#x6807;&#x91CF;&#x503C;&#x3002;</p>
<p>wchar: &#x8BE5;&#x7C7B;&#x578B;&#x662F;wchar_t&#x7684;&#x522B;&#x540D;&#x3002;</p>
<p>double: &#x8BE5;&#x7C7B;&#x578B;&#x662F;double-float&#x7684;&#x522B;&#x540D;&#x3002;</p>
<p>float: &#x8BE5;&#x7C7B;&#x578B;&#x662F;single-float&#x7684;&#x522B;&#x540D;&#x3002;</p>
<p>scheme-object: &#x7ED3;&#x679C;&#x88AB;&#x5047;&#x8BBE;&#x4E3A;&#x4E00;&#x4E2A;&#x6709;&#x6548;&#x7684;Scheme object&#xFF0C;&#x4E0D;&#x8FDB;&#x884C;&#x8F6C;&#x6362;&#x3002;&#x8BE5;&#x7C7B;&#x578B;&#x5177;&#x6709;&#x5371;&#x9669;&#x6027;&#xFF0C;&#x56E0;&#x4E3A;&#x65E0;&#x6548;&#x7684;Scheme object&#x4F1A;&#x5BFC;&#x81F4;&#x5185;&#x5B58;&#x7BA1;&#x7406;&#x7CFB;&#x7EDF;&#x4E0D;&#x786E;&#x5B9A;&#x7684;&#x9519;&#x8BEF;&#x7ED3;&#x679C;&#xFF08;&#x901A;&#x5E38;&#x662F;&#x4E0D;&#x4E0D;&#x597D;&#x7684;&#xFF09;&#x3002;&#x7531;&#x4E8E;Scheme object&#x5B9E;&#x9645;&#x4E0A;&#x662F;typed&#x6307;&#x9488;&#xFF0C;&#x751A;&#x81F3;integers&#x4E5F;&#x4E0D;&#x80FD;&#x5B89;&#x5168;&#x5730;&#x88AB;&#x8FD4;&#x56DE;&#x4E3A;scheme-object&#xFF0C;&#x9664;&#x975E;&#x4ED6;&#x4EEC;&#x662F;&#x7531;Scheme&#x7CFB;&#x7EDF;&#x521B;&#x5EFA;&#x7684;&#x3002;</p>
<p>ptr: &#x8BE5;&#x7C7B;&#x578B;&#x662F;scheme-object&#x7684;&#x522B;&#x540D;&#x3002;</p>
<p>u8*: &#x7ED3;&#x679C;&#x88AB;&#x89E3;&#x8BD1;&#x4E3A;&#x4E00;&#x4E2A;&apos;\0&apos;&#x7ED3;&#x5C3E;&#x7684;8-bit unsigned integers&#x5E8F;&#x5217;&#x7684;&#x6307;&#x9488;&#x3002;&#x5982;&#x679C;&#x7ED3;&#x679C;&#x662F;&#x7A7A;&#x6307;&#x9488;&#xFF0C;&#x8FD4;&#x56DE;&#x4E3A;#f&#x3002;&#x5426;&#x5219;&#xFF0C;&#x5B57;&#x8282;&#x5E8F;&#x5217;&#x88AB;&#x50A8;&#x5B58;&#x5728;&#x65B0;&#x5206;&#x914D;&#x7684;&#x5408;&#x9002;&#x957F;&#x5EA6;&#x7684;bytevector&#x4E2D;&#xFF0C;bytevector&#x88AB;&#x8FD4;&#x56DE;&#x7ED9;Scheme&#x3002;</p>
<p>u16*: &#x7ED3;&#x679C;&#x88AB;&#x89E3;&#x8BD1;&#x4E3A;&#x4E00;&#x4E2A;&apos;\0&apos;&#x7ED3;&#x5C3E;&#x7684;16-bit unsigned integers&#x5E8F;&#x5217;&#x7684;&#x6307;&#x9488;&#x3002;&#x5982;&#x679C;&#x7ED3;&#x679C;&#x662F;&#x7A7A;&#x6307;&#x9488;&#xFF0C;&#x8FD4;&#x56DE;&#x4E3A;#f&#x3002;&#x5426;&#x5219;&#xFF0C;16-bit integers&#x5E8F;&#x5217;&#x88AB;&#x50A8;&#x5B58;&#x5728;&#x65B0;&#x5206;&#x914D;&#x7684;&#x5408;&#x9002;&#x957F;&#x5EA6;&#x7684;bytevector&#x4E2D;&#xFF0C;bytevector&#x88AB;&#x8FD4;&#x56DE;&#x7ED9;Scheme&#x3002;null &#x7ED3;&#x5C3E;&#x7B26;&#x4E3A;16 bit&#x5BF9;&#x9F50;&#xFF0C;&#x5373;&#x4E24;&#x4E2A;&#x5B57;&#x8282;&#x7684;16-bit&#x5BF9;&#x9F50;&#x8FB9;&#x754C;&#x3002;</p>
<p>u32*: &#x7ED3;&#x679C;&#x88AB;&#x89E3;&#x8BD1;&#x4E3A;&#x4E00;&#x4E2A;&apos;\0&apos;&#x7ED3;&#x5C3E;&#x7684;32-bit unsigned integers&#x5E8F;&#x5217;&#x7684;&#x6307;&#x9488;&#x3002;&#x5982;&#x679C;&#x7ED3;&#x679C;&#x662F;&#x7A7A;&#x6307;&#x9488;&#xFF0C;&#x8FD4;&#x56DE;&#x4E3A;#f&#x3002;&#x5426;&#x5219;&#xFF0C;32-bit integers&#x5E8F;&#x5217;&#x88AB;&#x50A8;&#x5B58;&#x5728;&#x65B0;&#x5206;&#x914D;&#x7684;&#x5408;&#x9002;&#x957F;&#x5EA6;&#x7684;bytevector&#x4E2D;&#xFF0C;bytevector&#x88AB;&#x8FD4;&#x56DE;&#x7ED9;Scheme&#x3002;null &#x7ED3;&#x5C3E;&#x7B26;&#x4E3A;32-bit&#x5BF9;&#x9F50;&#xFF0C;&#x5373;&#x56DB;&#x4E2A;&#x5B57;&#x8282;&#x7684;32-bit&#x5BF9;&#x9F50;&#x8FB9;&#x754C;&#x3002;(&#x8BD1;&#x8005;&#x6CE8;&#xFF1A;&#x539F;&#x6587;&#x4E3A;the sequence of 16-bit integers)</p>
<p>utf-8: &#x7ED3;&#x679C;&#x88AB;&#x89E3;&#x8BD1;&#x4E3A;&#x4E00;&#x4E2A;&apos;\0&apos;&#x7ED3;&#x5C3E;&#x7684;8-bit unsigned character&#x5E8F;&#x5217;&#x7684;&#x6307;&#x9488;&#x3002;&#x5982;&#x679C;&#x7ED3;&#x679C;&#x662F;&#x7A7A;&#x6307;&#x9488;&#xFF0C;&#x8FD4;&#x56DE;&#x4E3A;#f&#x3002;&#x5426;&#x5219;&#xFF0C;&#x5B57;&#x8282;&#x5E8F;&#x5217;&#x88AB;&#x8F6C;&#x6362;&#x4E3A;Scheme string&#x7C7B;&#x578B;&#xFF0C;&#x5C31;&#x50CF;&#x901A;&#x8FC7;utf8-&gt;string&#xFF0C;string&#x8FD4;&#x56DE;&#x7ED9;Scheme&#x3002;</p>
<p>utf-16le: &#x7ED3;&#x679C;&#x88AB;&#x89E3;&#x8BD1;&#x4E3A;&#x4E00;&#x4E2A;&apos;\0&apos;&#x7ED3;&#x5C3E;&#x7684;16-bit unsigned integers&#x5E8F;&#x5217;&#x7684;&#x6307;&#x9488;&#x3002;&#x5982;&#x679C;&#x7ED3;&#x679C;&#x662F;&#x7A7A;&#x6307;&#x9488;&#xFF0C;&#x8FD4;&#x56DE;&#x4E3A;#f&#x3002;&#x5426;&#x5219;&#xFF0C;&#x5B57;&#x8282;&#x5E8F;&#x5217;&#x88AB;&#x8F6C;&#x6362;&#x4E3A;Scheme string,&#x5C31;&#x50CF;&#x901A;&#x8FC7;utf16-&gt;string&#xFF0C;&#x4EE5;endianness little&#x65B9;&#x5F0F;&#xFF0C;string&#x8FD4;&#x56DE;&#x7ED9;Scheme&#x3002;&#x5728;integers&#x5E8F;&#x5217;&#x4E2D;&#x7684;&#x5B57;&#x8282;&#x5E8F;&#x6807;&#x8BB0;&#x88AB;&#x8BA4;&#x4E3A;&#x662F;&#x666E;&#x901A;&#x5B57;&#x7B26;&#x503C;&#xFF0C;&#x4E0D;&#x5F71;&#x54CD;&#x5B57;&#x8282;&#x5E8F;&#x3002;</p>
<p>utf-16be: &#x7ED3;&#x679C;&#x88AB;&#x89E3;&#x8BD1;&#x4E3A;&#x4E00;&#x4E2A;&apos;\0&apos;&#x7ED3;&#x5C3E;&#x7684;16-bit unsigned integers&#x5E8F;&#x5217;&#x7684;&#x6307;&#x9488;&#x3002;&#x5982;&#x679C;&#x7ED3;&#x679C;&#x662F;&#x7A7A;&#x6307;&#x9488;&#xFF0C;&#x8FD4;&#x56DE;&#x4E3A;#f&#x3002;&#x5426;&#x5219;&#xFF0C;&#x5B57;&#x8282;&#x5E8F;&#x5217;&#x88AB;&#x8F6C;&#x6362;&#x4E3A;Scheme string,&#x5C31;&#x50CF;&#x901A;&#x8FC7;utf16-&gt;string&#xFF0C;&#x4EE5;endianness big&#x65B9;&#x5F0F;&#xFF0C;string&#x8FD4;&#x56DE;&#x7ED9;Scheme&#x3002;&#x5728;integers&#x5E8F;&#x5217;&#x4E2D;&#x7684;&#x5B57;&#x8282;&#x5E8F;&#x6807;&#x8BB0;&#x88AB;&#x8BA4;&#x4E3A;&#x662F;&#x666E;&#x901A;&#x5B57;&#x7B26;&#x503C;&#xFF0C;&#x4E0D;&#x5F71;&#x54CD;&#x5B57;&#x8282;&#x5E8F;&#x3002;</p>
<p>utf-32le: &#x7ED3;&#x679C;&#x88AB;&#x89E3;&#x8BD1;&#x4E3A;&#x4E00;&#x4E2A;&apos;\0&apos;&#x7ED3;&#x5C3E;&#x7684;32-bit unsigned integers&#x5E8F;&#x5217;&#x7684;&#x6307;&#x9488;&#x3002;&#x5982;&#x679C;&#x7ED3;&#x679C;&#x662F;&#x7A7A;&#x6307;&#x9488;&#xFF0C;&#x8FD4;&#x56DE;&#x4E3A;#f&#x3002;&#x5426;&#x5219;&#xFF0C;&#x5B57;&#x8282;&#x5E8F;&#x5217;&#x88AB;&#x8F6C;&#x6362;&#x4E3A;Scheme string,&#x5C31;&#x50CF;&#x901A;&#x8FC7;utf32-&gt;string&#xFF0C;&#x4EE5;endianness little&#x65B9;&#x5F0F;&#xFF0C;string&#x8FD4;&#x56DE;&#x7ED9;Scheme&#x3002;&#x5728;integers&#x5E8F;&#x5217;&#x4E2D;&#x7684;&#x5B57;&#x8282;&#x5E8F;&#x6807;&#x8BB0;&#x88AB;&#x8BA4;&#x4E3A;&#x662F;&#x666E;&#x901A;&#x5B57;&#x7B26;&#x503C;&#xFF0C;&#x4E0D;&#x5F71;&#x54CD;&#x5B57;&#x8282;&#x5E8F;&#x3002;</p>
<p>utf-32be: &#x7ED3;&#x679C;&#x88AB;&#x89E3;&#x8BD1;&#x4E3A;&#x4E00;&#x4E2A;&apos;\0&apos;&#x7ED3;&#x5C3E;&#x7684;32-bit unsigned integers&#x5E8F;&#x5217;&#x7684;&#x6307;&#x9488;&#x3002;&#x5982;&#x679C;&#x7ED3;&#x679C;&#x662F;&#x7A7A;&#x6307;&#x9488;&#xFF0C;&#x8FD4;&#x56DE;&#x4E3A;#f&#x3002;&#x5426;&#x5219;&#xFF0C;&#x5B57;&#x8282;&#x5E8F;&#x5217;&#x88AB;&#x8F6C;&#x6362;&#x4E3A;Scheme string,&#x5C31;&#x50CF;&#x901A;&#x8FC7;utf32-&gt;string&#xFF0C;&#x4EE5;endianness big&#x65B9;&#x5F0F;&#xFF0C;string&#x8FD4;&#x56DE;&#x7ED9;Scheme&#x3002;&#x5728;integers&#x5E8F;&#x5217;&#x4E2D;&#x7684;&#x5B57;&#x8282;&#x5E8F;&#x6807;&#x8BB0;&#x88AB;&#x8BA4;&#x4E3A;&#x662F;&#x666E;&#x901A;&#x5B57;&#x7B26;&#x503C;&#xFF0C;&#x4E0D;&#x5F71;&#x54CD;&#x5B57;&#x8282;&#x5E8F;&#x3002;</p>
<p>string: &#x8BE5;&#x7C7B;&#x578B;&#x662F;utf-8&#x7684;&#x522B;&#x540D;&#x3002;</p>
<p>wstring: &#x8BE5;&#x7C7B;&#x578B;&#x662F;utf-16le, utf-16be, utf-32le, utf-32be&#x4E2D;&#x5408;&#x9002;&#x7C7B;&#x578B;&#x7684;&#x522B;&#x540D;&#xFF0C;&#x53D6;&#x51B3;&#x4E8E;C&#x4E2D;wchar_t&#x7684;&#x5927;&#x5C0F;&#x548C;&#x76EE;&#x6807;&#x673A;&#x5668;&#x7684;endianness&#x3002;&#x4F8B;&#x5982;&#xFF0C;wstring&#x5728;Intel&#x786C;&#x4EF6;&#x7684;Windows&#x7CFB;&#x7EDF;&#x4E0A;&#x7B49;&#x6548;&#x4E8E;utf-16le&#x3002;</p>
<p>(* ftype): &#x7ED3;&#x679C;&#x88AB;&#x89E3;&#x8BD1;&#x4E3A;&#x5916;&#x90E8;&#x5BF9;&#x8C61;&#x7684;&#x5730;&#x5740;&#xFF0C;&#x5176;&#x7531;ftype&#x63CF;&#x8FF0;&#xFF0C;&#x65B0;&#x5206;&#x914D;&#x7684;&#x5C01;&#x88C5;&#x8BE5;&#x5730;&#x5740;&#x7684;ftype&#x6307;&#x9488;&#x88AB;&#x8FD4;&#x56DE;&#x3002;&#x89C1;4.5&#x8282;&#x5BF9;&#x5916;&#x90E8;&#x7C7B;&#x578B;&#x7684;&#x63CF;&#x8FF0;&#x3002;</p>
<p>(&amp; ftype): &#x7ED3;&#x679C;&#x88AB;&#x89E3;&#x8BD1;&#x4E3A;&#x5916;&#x90E8;&#x5BF9;&#x8C61;&#xFF0C;&#x5176;&#x7531;ftype&#x63CF;&#x8FF0;&#xFF0C;&#x5916;&#x90E8;&#x51FD;&#x6570;&#x8FD4;&#x56DE;&#x4E00;&#x4E2A;ftype&#x7ED3;&#x679C;&#xFF0C;&#x4F46;&#x662F;&#xFF0C;&#x8C03;&#x7528;&#x8005;&#x5FC5;&#x987B;&#x5728;&#x5176;&#x4ED6;&#x8C03;&#x7528;&#x53C2;&#x6570;&#x524D;&#x63D0;&#x4F9B;&#x4E00;&#x4E2A;&#x989D;&#x5916;&#x7684;(* ftype)&#x53C2;&#x6570;&#x6765;&#x63A5;&#x6536;&#x7ED3;&#x679C;&#x3002;&#x5916;&#x90E8;&#x8FC7;&#x7A0B;&#x8C03;&#x7528;&#x540E;&#x4E00;&#x4E2A;&#x672A;&#x6307;&#x5B9A;&#x7684;Scheme&#x5BF9;&#x8C61;&#x88AB;&#x8FD4;&#x56DE;&#xFF0C;&#x56E0;&#x4E3A;&#x7ED3;&#x679C;&#x88AB;&#x5199;&#x5165;&#x7531;&#x989D;&#x5916;&#x53C2;&#x6570;&#x5F15;&#x7528;&#x7684;&#x50A8;&#x5B58;&#x7A7A;&#x95F4;&#x4E2D;&#x3002;ftype&#x4E0D;&#x80FD;&#x5F15;&#x7528;array&#x7C7B;&#x578B;&#x3002;</p>
<p>&#x6211;&#x4EEC;&#x770B;&#x4E0B;C identity&#x8FC7;&#x7A0B;&#xFF1A;</p>
<p><code>int id(x) int x; { return x; }</code></p>
<p>&#x5F53;&#x5305;&#x542B;&#x8BE5;&#x8FC7;&#x7A0B;&#x7684;&#x6587;&#x4EF6;&#x88AB;&#x7F16;&#x8BD1;&#x52A0;&#x8F7D;&#xFF08;&#x89C1;4.6&#xFF09;&#xFF0C;&#x5B83;&#x80FD;&#x591F;&#x7531;&#x4EE5;&#x4E0B;&#x65B9;&#x5F0F;&#x8BBF;&#x95EE;&#xFF1A;</p>
<pre><code>(foreign-procedure &quot;id&quot;
  (int) int)
=&gt; #&lt;procedure&gt;
((foreign-procedure &quot;id&quot;
   (int) int)
 1)
=&gt; 1
(define int-id
  (foreign-procedure &quot;id&quot;
    (int) int))
(int-id 1)
=&gt; 1
</code></pre><p>&#x201C;id&#x201D;&#x5165;&#x53E3;&#x80FD;&#x591F;&#x88AB;&#x89E3;&#x8BD1;&#x4E3A;&#x63A5;&#x6536;&#x548C;&#x8FD4;&#x56DE;boolean&#x7C7B;&#x578B;&#xFF1A;</p>
<pre><code>(define bool-id
  (foreign-procedure &quot;id&quot;
    (boolean) boolean))
(bool-id #f)
=&gt; #f
(bool-id #t)
=&gt; #t
(bool-id 1)
=&gt; #t
</code></pre><p>&#x5982;&#x4E0A;&#x4F8B;&#x6240;&#x63ED;&#x793A;&#x7684;&#xFF0C;bool-id&#x5B9E;&#x9645;&#x4E0A;&#x662F;&#x8F6C;&#x6362;&#x8FC7;&#x7A0B;&#x3002;&#x5F53;Scheme&#x5BF9;&#x8C61;&#x4EE5;&#x7C7B;&#x578B;boolean&#x4F20;&#x9012;&#x65F6;&#xFF0C;&#x5176;&#x88AB;&#x8F6C;&#x6362;&#x4E3A;0&#x6216;1&#xFF0C;&#x5F53;&#x5176;&#x8FD4;&#x56DE;&#x65F6;&#x88AB;&#x8F6C;&#x6362;&#x4E3A;#f&#x6216;#t&#x3002;&#x7ED3;&#x679C;&#x88AB;&#x8F6C;&#x6362;&#x6210;&#x89C4;&#x8303;&#x5316;&#x7684;boolean&#x503C;&#x3002;&#x901A;&#x8FC7;&#x53D8;&#x6362;&#x7C7B;&#x578B;&#x6307;&#x5B9A;&#xFF0C;&#x201C;id&#x201D;&#x5165;&#x53E3;&#x80FD;&#x591F;&#x88AB;&#x7528;&#x6765;&#x521B;&#x5EFA;&#x5176;&#x4ED6;&#x8F6C;&#x6362;&#x8FC7;&#x7A0B;&#x3002;</p>
<pre><code>(define int-&gt;bool
  (foreign-procedure &quot;id&quot;
    (int) boolean))
(int-&gt;bool 0)
=&gt; #f
(int-&gt;bool 5)
=&gt; #t
(map (foreign-procedure &quot;id&quot;
       (boolean) int)
     &apos;(#t #f))
=&gt; (1 0)

(define void
  (foreign-procedure &quot;id&quot;
    (int) void))
(void 10)
=&gt; unspecified
</code></pre><p>&#x5F53;&#x7136;&#x5728;Scheme&#x4E2D;&#x6709;&#x66F4;&#x52A0;&#x7B80;&#x5355;&#x3001;&#x9AD8;&#x6548;&#x7684;&#x76F4;&#x63A5;&#x5B8C;&#x6210;&#x8F6C;&#x6362;&#x7684;&#x65B9;&#x5F0F;&#x3002;</p>
<p>&#x5F53;foreign-procedure&#x8868;&#x8FBE;&#x5F0F;&#x88AB;&#x6C42;&#x503C;&#x65F6;&#x5916;&#x90E8;&#x5165;&#x53E3;&#x88AB;&#x89E3;&#x6790;&#xFF0C;&#x800C;&#x4E0D;&#x662F;&#x4EE3;&#x7801;&#x88AB;&#x52A0;&#x8F7D;&#x6216;&#x8005;&#x6BCF;&#x6B21;&#x8C03;&#x7528;&#x65F6;&#x3002;&#x56E0;&#x6B64;&#xFF0C;&#x4EE5;&#x4E0B;&#x5B9A;&#x4E49;&#x603B;&#x662F;&#x6709;&#x6548;&#x5730;&#xFF0C;&#x56E0;&#x4E3A;foreign-procedure&#x8868;&#x8FBE;&#x5F0F;&#x4E0D;&#x662F;&#x7ACB;&#x5373;&#x88AB;&#x6C42;&#x503C;&#xFF1A;</p>
<pre><code>(define doit
  (lambda ()
    ((foreign-procedure &quot;doit&quot; () void))))
</code></pre><p>&#x5728;&#x201C;doit&#x201D;&#x7684;&#x5165;&#x53E3;&#x672A;&#x88AB;&#x63D0;&#x4F9B;&#x524D;&#xFF0C;doit&#x4E0D;&#x5E94;&#x8BE5;&#x88AB;&#x8C03;&#x7528;&#x3002;&#x7C7B;&#x4F3C;&#x5730;&#xFF0C;&#x201C;doit&#x201D;&#x7684;&#x5165;&#x53E3;&#x5FC5;&#x987B;&#x5728;&#x4EE5;&#x4E0B;&#x4EE3;&#x7801;&#x6C42;&#x503C;&#x524D;&#x5B58;&#x5728;&#x3002;</p>
<pre><code>(define doit
  (foreign-procedure &quot;doit&quot; () void))
</code></pre><p>&#x5C3D;&#x7BA1;&#x7B2C;&#x4E8C;&#x79CD;&#x5B9A;&#x4E49;&#x66F4;&#x52A0;&#x9650;&#x5236;&#x5916;&#x90E8;&#x6587;&#x4EF6;&#x7684;&#x52A0;&#x8F7D;&#x987A;&#x5E8F;&#xFF0C;&#x4F46;&#x662F;&#x66F4;&#x52A0;&#x6709;&#x6548;&#x7387;&#xFF0C;&#x56E0;&#x4E3A;&#x5165;&#x53E3;&#x89E3;&#x6790;&#x53EA;&#x9700;&#x8981;&#x505A;&#x4E00;&#x6B21;&#x3002;</p>
<p>&#x5B9A;&#x4E49;&#x4E00;&#x4E2A;&#x6A21;&#x677F;&#x7528;&#x4E8E;&#x521B;&#x5EFA;&#x51E0;&#x4E2A;&#x5177;&#x6709;&#x7C7B;&#x4F3C;&#x53C2;&#x6570;&#x7C7B;&#x578B;&#x548C;&#x8FD4;&#x56DE;&#x503C;&#x7684;&#x5916;&#x90E8;&#x8FC7;&#x7A0B;&#xFF0C;&#x8FD9;&#x901A;&#x5E38;&#x5F88;&#x6709;&#x7528;&#x3002;&#x4F8B;&#x5982;&#xFF0C;&#x4EE5;&#x4E0B;&#x4EE3;&#x7801;&#x4ECE;&#x4E00;&#x4E2A;&#x5916;&#x90E8;&#x8FC7;&#x7A0B;&#x8868;&#x8FBE;&#x5F0F;&#x521B;&#x5EFA;&#x4E24;&#x4E2A;&#x5916;&#x90E8;&#x8FC7;&#x7A0B;&#xFF0C;&#x901A;&#x8FC7;&#x62BD;&#x8C61;&#x51FA;&#x5916;&#x90E8;&#x8FC7;&#x7A0B;&#x540D;&#x5B57;&#xFF1A;</p>
<pre><code>(define double-&gt;double
  (lambda (proc-name)
    (foreign-procedure proc-name
      (double)
      double)))

(define log10 (double-&gt;double &quot;log10&quot;))
(define gamma (double-&gt;double &quot;gamma&quot;))
</code></pre><p>&#x5728;&#x5BF9;&#x5E94;&#x7684;&#x5B9A;&#x4E49;&#x4E4B;&#x524D;&#xFF0C;&#x201C;log10&#x201D;&#x548C;&#x201C;gamma&#x201D;&#x90FD;&#x5FC5;&#x987B;&#x5B58;&#x5728;&#x5916;&#x90E8;&#x5165;&#x53E3;&#xFF08;&#x89C1;4.6&#x8282;&#xFF09;&#x3002;&#x4F7F;&#x7528;&#x5916;&#x90E8;&#x8FC7;&#x7A0B;&#x6A21;&#x677F;&#x80FD;&#x591F;&#x7B80;&#x5316;&#x7F16;&#x7801;&#x8FC7;&#x7A0B;&#xFF0C;&#x51CF;&#x5C11;&#x9700;&#x8981;&#x751F;&#x6210;&#x5927;&#x91CF;&#x5916;&#x90E8;&#x8FC7;&#x7A0B;&#x6240;&#x4F7F;&#x7528;&#x7684;&#x4EE3;&#x7801;&#x91CF;&#xFF0C;&#x4F8B;&#x5982;&#xFF0C;&#x5F53;&#x6574;&#x4E2A;&#x5E93;&#x7684;&#x5916;&#x90E8;&#x8FC7;&#x7A0B;&#x88AB;&#x5BFC;&#x5165;&#x5230;Scheme&#x4E2D;&#x3002;</p>
<h2 id="43-&#x4ECE;scheme&#x5BFC;&#x51FA;&#xFF08;calling-into-scheme&#xFF09;">4.3 &#x4ECE;Scheme&#x5BFC;&#x51FA;&#xFF08;Calling into Scheme&#xFF09;</h2>
<p>4.2&#x8282;&#x63CF;&#x8FF0;&#x4E86;foreign-procedure&#x5F62;&#x5F0F;&#xFF0C;&#x5176;&#x5141;&#x8BB8;Scheme&#x4EE3;&#x7801;&#x8C03;&#x7528;C&#x6216;C&#x517C;&#x5BB9;&#x5916;&#x90E8;&#x8FC7;&#x7A0B;&#x3002;&#x8BE5;&#x8282;&#x63CF;&#x8FF0;foreign-callable&#x5F62;&#x5F0F;&#xFF0C;&#x5176;&#x5141;&#x8BB8;C&#x6216;C&#x517C;&#x5BB9;&#x4EE3;&#x7801;&#x8C03;&#x7528;Scheme&#x8FC7;&#x7A0B;&#x3002;&#x5728;C&#x4E2D;&#x8C03;&#x7528;Scheme&#x8FC7;&#x7A0B;&#x7684;&#x66F4;&#x539F;&#x59CB;&#x7684;&#x673A;&#x7406;&#x5728;4.8&#x8282;&#x63CF;&#x8FF0;&#x3002;</p>
<p>&#x5F53;&#x5728;&#x5916;&#x90E8;&#x8C03;&#x7528;Scheme&#x8FC7;&#x7A0B;&#x65F6;&#xFF0C;Scheme&#x548C;&#x8C03;&#x7528;Scheme&#x7684;&#x5916;&#x90E8;&#x4EE3;&#x7801;&#x4E4B;&#x95F4;&#x5171;&#x4EAB;&#x6570;&#x636E;&#x8981;&#x5C0F;&#x5FC3;&#xFF0C;&#x9632;&#x6B62;&#x7834;&#x574F;Scheme&#x7684;&#x5185;&#x5B58;&#x7BA1;&#x7406;&#x7CFB;&#x7EDF;&#x3002;&#xFF08;&#x8BD1;&#x8005;&#x6CE8;&#xFF1A;&#x539F;&#x6587;&#x4E3A;As when calling foreign procedures from Scheme&#xFF09;&#x3002;</p>
<p>&#x901A;&#x8FC7;&#x4F20;&#x9012;&#x8FC7;&#x7A0B;&#x7ED9;make-ftype-pointer&#xFF0C;&#x5E76;&#x4F7F;&#x7528;&#x5408;&#x9002;&#x7684;&#x51FD;&#x6570;ftype&#xFF08;&#x89C1;4.5&#x8282;&#xFF09;&#xFF0C;&#x80FD;&#x591F;&#x521B;&#x5EFA;Scheme&#x8FC7;&#x7A0B;&#x7684;foreign-callable&#x5C01;&#x88C5;&#x3002;</p>
<p>&#x8BED;&#x6CD5;: (foreign-callable conv ... proc-exp (param-type ...) res-type)
&#x8FD4;&#x56DE;: &#x4EE3;&#x7801;&#x5BF9;&#x8C61;
libraries: (chezscheme)</p>
<p>proc-exp&#x5FC5;&#x987B;&#x662F;&#x8FC7;&#x7A0B;&#xFF0C;&#x662F;&#x4E00;&#x4E2A;&#x88AB;&#x7528;&#x4E8E;&#x5916;&#x90E8;&#x4EE3;&#x7801;&#x8C03;&#x7528;&#x7684;Scheme&#x8FC7;&#x7A0B;&#x3002;&#x53C2;&#x6570;&#x7C7B;&#x578B;&#x548C;&#x8FD4;&#x56DE;&#x503C;&#x7C7B;&#x578B;&#x5982;4.2&#x8282;&#x7684;foreign-procedure&#x4E2D;&#x4ECB;&#x7ECD;&#x7684;&#xFF0C;&#x9664;&#x4E86;&#x8981;&#x6C42;&#x548C;&#x8F6C;&#x6362;&#x662F;&#x76F8;&#x53CD;&#x7684;&#xFF0C;&#x5373;&#x5BF9;&#x4E8E;foreign-procedure&#x53C2;&#x6570;&#x7684;&#x63CF;&#x8FF0;&#x9002;&#x7528;&#x4E8E;foreign-callable&#x7684;&#x8FD4;&#x56DE;&#x503C;&#x63CF;&#x8FF0;&#x3002;callable&#x7684;(&amp; ftype)&#x53C2;&#x6570;&#x5F15;&#x7528;&#x4E86;&#x4E00;&#x4E2A;&#x53EA;&#x6709;&#x5728;callback&#x8C03;&#x7528;&#x7684;&#x52A8;&#x6001;&#x8303;&#x56F4;&#x4E2D;&#x6709;&#x6548;&#x7684;&#x5730;&#x5740;&#x3002;callable&#x7684;(&amp; ftype)&#x8FD4;&#x56DE;&#x503C;&#x7C7B;&#x578B;&#x9700;&#x8981;Scheme&#x8FC7;&#x7A0B;&#x5728;&#x6240;&#x6709;&#x5176;&#x4ED6;&#x53C2;&#x6570;&#x524D;&#x9762;&#x989D;&#x5916;&#x63A5;&#x6536;&#x4E00;&#x4E2A;(&amp; ftype)&#x53C2;&#x6570;&#x3002;Scheme&#x8FC7;&#x7A0B;&#x5E94;&#x8BE5;&#x5C06;&#x7ED3;&#x679C;&#x5199;&#x5165;&#x8FD9;&#x4E2A;&#x989D;&#x5916;&#x7684;&#x53C2;&#x6570;&#xFF0C;Scheme&#x8FC7;&#x7A0B;&#x7684;&#x76F4;&#x63A5;&#x7ED3;&#x679C;&#x88AB;&#x629B;&#x5F03;&#x3002;&#x7C7B;&#x578B;&#x68C0;&#x67E5;&#x9488;&#x5BF9;&#x8FD4;&#x56DE;&#x503C;&#x800C;&#x4E0D;&#x662F;&#x53C2;&#x6570;&#x7C7B;&#x578B;&#xFF0C;&#x56E0;&#x4E3A;&#x53C2;&#x6570;&#x503C;&#x7531;&#x5916;&#x90E8;&#x4EE3;&#x7801;&#x63D0;&#x4F9B;&#xFF0C;&#x5FC5;&#x987B;&#x5047;&#x8BBE;&#x5176;&#x662F;&#x6B63;&#x786E;&#x7684;&#x3002;</p>
<p>&#x6BCF;&#x4E00;&#x4E2A;conv&#x8C03;&#x6574;&#x5176;&#x4F7F;&#x7528;&#x7684;&#x8C03;&#x7528;&#x89C4;&#x5219;&#x3002;foreign-callable&#x652F;&#x6301;&#x4E0E;foreign-procedure&#x4E00;&#x6837;&#x7684;&#x8C03;&#x7528;&#x89C4;&#x5219;&#xFF0C;&#x9664;&#x4E86;<strong>com&#x3002;callable&#x7684;</strong>collect_safe&#x8C03;&#x7528;&#x89C4;&#x5219;&#x4F1A;&#x5C06;&#x6CA1;&#x6709;&#x6FC0;&#x6D3B;&#x7684;&#x8C03;&#x7528;&#x7EBF;&#x7A0B;&#x6FC0;&#x6D3B;&#xFF0C;&#x5F53;callable&#x8FD4;&#x56DE;&#x65F6;&#xFF0C;&#x7EBF;&#x7A0B;&#x7684;&#x6FC0;&#x6D3B;&#x72B6;&#x6001;&#x5C06;&#x6062;&#x590D;&#x3002;&#x5982;&#x679C;&#x8C03;&#x7528;&#x7EBF;&#x7A0B;&#x5F53;&#x524D;&#x6CA1;&#x6709;&#x5728;Scheme&#x7CFB;&#x7EDF;&#x4E2D;&#x6CE8;&#x518C;&#xFF0C;&#x90A3;&#x4E48;&#x6062;&#x590D;&#x7EBF;&#x7A0B;&#x6FC0;&#x6D3B;&#x72B6;&#x6001;&#x6307;&#x7684;&#x662F;&#x9500;&#x6BC1;&#x8BE5;&#x7EBF;&#x7A0B;&#x7684;&#x6CE8;&#x518C;&#xFF08;&#x89C1;Sdestroy_thrread&#xFF09;&#x3002;</p>
<p>&#x7531;foreign-callable&#x4EA7;&#x751F;&#x7684;&#x503C;&#x662F;&#x4E00;&#x4E2A;Scheme code&#x5BF9;&#x8C61;&#xFF0C;&#x5176;&#x5305;&#x542B;&#x4E00;&#x4E9B;&#x5934;&#x4FE1;&#x606F;&#x548C;&#x4E2D;&#x5305;&#x88C5;&#x7684;Scheme&#x53EF;&#x6267;&#x884C;&#x8FC7;&#x7A0B;&#x3002;code&#x5BF9;&#x8C61;&#x53EF;&#x901A;&#x8FC7;foreign-callable-entry-point&#x8F6C;&#x6362;&#x4E3A;foreign-callable&#x7684;&#x5730;&#x5740;&#xFF0C;&#x8FD4;&#x56DE;&#x4E00;&#x4E2A;&#x4EE3;&#x8868;code&#x5BF9;&#x8C61;&#x5165;&#x53E3;&#x5730;&#x5740;&#x7684;&#x6574;&#x6570;&#x3002;&#xFF08;C-callcalbe&#x5E93;&#x51FD;&#x6570;Sforeign_callable_entry_point&#xFF0C;&#x5728;4.8&#x8282;&#x4ECB;&#x7ECD;&#xFF0C;&#x4E5F;&#x80FD;&#x591F;&#x88AB;&#x7528;&#x6765;&#x83B7;&#x53D6;&#x5165;&#x53E3;&#x3002;&#xFF09;&#x8FD9;&#x662F;&#x4E00;&#x4E2A;Scheme&#x5BF9;&#x8C61;&#x7684;&#x9690;&#x5F0F;&#x6307;&#x9488;&#xFF0C;&#x5728;&#x8BB8;&#x591A;&#x60C5;&#x51B5;&#x4E0B;&#xFF0C;&#x5728;&#x8F6C;&#x6362;&#x6210;&#x5165;&#x53E3;&#x4E4B;&#x524D;&#x5FC5;&#x987B;&#x9501;&#x4F4F;code&#x5BF9;&#x8C61;&#xFF08;&#x4F7F;&#x7528;lock-object&#xFF09;&#x4EE5;&#x9632;&#x6B62;Scheme&#x5185;&#x5B58;&#x7BA1;&#x7406;&#x7CFB;&#x7EDF;&#x91CD;&#x65B0;&#x5B9A;&#x4F4D;&#x6216;&#x8005;&#x9500;&#x6BC1;code&#x5BF9;&#x8C61;&#xFF0C;&#x5373;&#x5F53;&#x5165;&#x53E3;&#x88AB;&#x6CE8;&#x518C;&#x4E3A;callback&#xFF0C;&#x53EF;&#x4EE5;&#x5728;C&#x4E2D;&#x4FDD;&#x6301;&#x6C38;&#x4E45;&#x4F7F;&#x7528;&#x3002;</p>
<p>&#x4EE5;&#x4E0B;&#x4EE3;&#x7801;&#x521B;&#x5EFA;&#x5F97;&#x4E86;foreign-callable code&#x5BF9;&#x8C61;&#xFF0C;&#x9501;&#x4F4F;code&#x5BF9;&#x8C61;&#xFF0C;&#x8FD4;&#x56DE;&#x5165;&#x53E3;&#x3002;</p>
<pre><code>(let ([x (foreign-callable
           (lambda (x y) (pretty-print (cons x (* y 2))))
           (string integer-32)
           void)])
  (lock-object x)
  (foreign-callable-entry-point x))
</code></pre><p>&#x7531;foreign-callable&#x8FD4;&#x56DE;&#x7684;code&#x5BF9;&#x8C61;&#x7684;&#x6307;&#x9488;&#x53EF;&#x4EE5;&#x518D;&#x4E0D;&#x9700;&#x8981;&#x7684;&#x65F6;&#x5019;&#x89E3;&#x9501;&#xFF0C;&#x9664;&#x975E;&#x5165;&#x53E3;&#x9700;&#x8981;&#x6C38;&#x4E45;&#x4FDD;&#x7559;&#x3002;</p>
<p>foreign-callable&#x548C;foreign-procedure&#x7684;&#x6DF7;&#x5408;&#x4F7F;&#x7528;&#x4F1A;&#x5BFC;&#x81F4;&#x5916;&#x90E8;&#x4EE3;&#x7801;&#x548C;Scheme&#x8C03;&#x7528;&#x7684;&#x5D4C;&#x5957;&#xFF0C;&#x5F53;&#x6D89;&#x53CA;&#x5230;&#x5EF6;&#x7EED;(continuations)&#x65F6;&#x4F1A;&#x4EA7;&#x751F;&#x6709;&#x610F;&#x601D;&#x7684;&#x601D;&#x8003;&#xFF0C;&#x65E0;&#x8BBA;&#x8FD9;&#x662F;&#x76F4;&#x63A5;&#x8FD8;&#x662F;&#x95F4;&#x63A5;&#x7684;(&#x7531;&#x4E8E;&#x901A;&#x8FC7;&#x9ED8;&#x8BA4;&#x5F02;&#x5E38;&#x5904;&#x7406;)&#x3002;&#x89C1;4.4&#x8282;&#x4E2D;&#x5173;&#x4E8E;&#x5916;&#x90E8;&#x8C03;&#x7528;&#x548C;&#x5EF6;&#x7EED;(continuations)&#x7684;&#x4EA4;&#x4E92;&#x3002;</p>
<p>&#x4EE5;&#x4E0B;&#x4F8B;&#x5B50;&#x5C55;&#x793A;&#x4E86;&#x5728;Scheme&#x4E2D;&#x4F7F;&#x7528;foreign-callable&#x5B9A;&#x4E49;&#x8BB8;&#x591A;&#x7A97;&#x53E3;&#x7CFB;&#x7EDF;&#x9700;&#x8981;&#x7684;&#x56DE;&#x8C03;&#x51FD;&#x6570;&#x3002;&#x5047;&#x8BBE;&#x4EE5;&#x4E0B;C&#x4EE3;&#x7801;&#x5DF2;&#x7ECF;&#x88AB;&#x7F16;&#x8BD1;&#x548C;&#x52A0;&#x8F7D;&#xFF08;&#x89C1;4.6&#x8282;&#xFF09;&#x3002;</p>
<pre><code>#include &lt;stdio.h&gt;

typedef void (*CB)(char);

CB callbacks[256];

void cb_init(void) {
   int i;

   for (i = 0; i &lt; 256; i += 1)
       callbacks[i] = (CB)0;
}

void register_callback(char c, CB cb) {
    callbacks[c] = cb;
}

void event_loop(void) {
    CB f; char c;

    for (;;) {
        c = getchar();
        if (c == EOF) break;
        f = callbacks[c];
        if (f != (CB)0) f(c);
    }
}
</code></pre><p>&#x8FD9;&#x4E9B;&#x51FD;&#x6570;&#x7684;&#x63A5;&#x53E3;&#x53EF;&#x4EE5;&#x5728;Scheme&#x4E2D;&#x5982;&#x4E0B;&#x5B9A;&#x4E49;&#x3002;</p>
<pre><code>(define cb-init
  (foreign-procedure &quot;cb_init&quot; () void))
(define register-callback
  (foreign-procedure &quot;register_callback&quot; (char void*) void))
(define event-loop
  (foreign-procedure __collect_safe &quot;event_loop&quot; () void))
</code></pre><p>&#x9009;&#x62E9;&#x5B57;&#x7B26;&#x7684;&#x56DE;&#x8C03;&#x51FD;&#x6570;&#x80FD;&#x5728;&#x540E;&#x9762;&#x5B9A;&#x4E49;&#x3002;</p>
<pre><code>(define callback
  (lambda (p)
    (let ([code (foreign-callable __collect_safe p (char) void)])
      (lock-object code)
      (foreign-callable-entry-point code))))
(define ouch
  (callback
    (lambda (c)
      (printf &quot;Ouch! Hit by &apos;~c&apos;~%&quot; c))))
(define rats
  (callback
    (lambda (c)
      (printf &quot;Rats! Received &apos;~c&apos;~%&quot; c))))

(cb-init)
(register-callback #\a ouch)
(register-callback #\c rats)
(register-callback #\e ouch)
</code></pre><p>&#x8FD9;&#x6837;&#x5C31;&#x5EFA;&#x7ACB;&#x4E86;&#x5982;&#x4E0B;&#x7684;&#x4EA4;&#x4E92;&#x3002;</p>
<pre><code>&gt; (event-loop)
a
Ouch! Hit by &apos;a&apos;
b
c
Rats! Received &apos;c&apos;
d
e
Ouch! Hit by &apos;e&apos;
</code></pre><p>&#x8BE5;&#x4F8B;&#x5B50;&#x4E2D;&#x7684;__collect_saft&#x58F0;&#x660E;&#x786E;&#x4FDD;&#x5F53;event-loop&#x7B49;&#x5F85;&#x8F93;&#x5165;&#x963B;&#x585E;&#x65F6;&#x5176;&#x4ED6;&#x7EBF;&#x7A0B;&#x80FD;&#x591F;&#x7EE7;&#x7EED;&#x5DE5;&#x4F5C;&#x3002;&#x4E00;&#x4E2A;&#x66F4;&#x597D;&#x7684;&#x8BE5;&#x4F8B;&#x5B50;&#x7684;&#x7248;&#x672C;&#x5E94;&#x8BE5;&#x4FDD;&#x5B58;&#x6BCF;&#x4E2A;&#x7531;foreign-callable&#x8FD4;&#x56DE;&#x7684;code&#x5BF9;&#x8C61;&#xFF0C;&#x5F53;&#x56DE;&#x8C03;&#x51FD;&#x6570;&#x4E0D;&#x518D;&#x6CE8;&#x518C;&#x65F6;&#x5BF9;&#x5B83;&#x4EEC;&#x89E3;&#x9664;&#x9501;&#x5B9A;&#x3002;</p>
<p>&#x8FC7;&#x7A0B;: (foreign-callable-entry-point code)
&#x8FD4;&#x56DE;: code&#x5BF9;&#x8C61;&#x4E2D;foreign-callable&#x7684;&#x5730;&#x5740;
&#x5E93;: (chezscheme)</p>
<p>code&#x662F;foreign-callable&#x4EA7;&#x751F;&#x7684;code&#x5BF9;&#x8C61;&#x3002;</p>
<p>&#x8FC7;&#x7A0B;: (foreign-callable-code-object address)
&#x8FD4;&#x56DE;: foreign-callable&#x7684;&#x5165;&#x53E3;&#x5730;&#x5740;&#x5BF9;&#x5E94;&#x7684;code&#x5BF9;&#x8C61;
&#x5E93;: (chezscheme)</p>
<p>&#x5730;&#x5740;&#x5FC5;&#x987B;&#x662F;exact integer&#x4E14;&#x5FC5;&#x987B;&#x662F;&#x7531;foreign-callable&#x4EA7;&#x751F;&#x7684;code&#x5BF9;&#x8C61;&#x7684;&#x5165;&#x53E3;&#x7684;&#x5730;&#x5740;&#x3002;</p>
<h2 id="44-&#x5EF6;&#x7EED;&#x548C;&#x5916;&#x90E8;&#x8C03;&#x7528;&#xFF08;continuations-and-foreign-calls&#xFF09;">4.4 &#x5EF6;&#x7EED;&#x548C;&#x5916;&#x90E8;&#x8C03;&#x7528;&#xFF08;Continuations and Foreign Calls&#xFF09;</h2>
<p>foreign-callable&#x548C;foreign-procedure &#x5141;&#x8BB8;&#x4EFB;&#x610F;&#x5730;&#x5D4C;&#x5957;&#x5916;&#x90E8;&#x548C;Scheme&#x8C03;&#x7528;&#x3002;&#x56E0;&#x4E3A;&#x5176;&#x4ED6;&#x8BED;&#x8A00;&#x4E0D;&#x5B8C;&#x5168;&#x652F;&#x6301;Scheme&#x7684;&#x901A;&#x7528;&#x5934;&#x7B49;&#x5EF6;&#x7EED;&#xFF08;general first-class continuations&#xFF09;&#xFF0C;&#x5EF6;&#x7EED;(continuations)&#x95F4;&#x7684;&#x4EA4;&#x4E92;&#x548C;Scheme&#x4E0E;&#x5916;&#x90E8;&#x8FC7;&#x7A0B;&#x7684;&#x5D4C;&#x5957;&#x8C03;&#x7528;&#x662F;&#x6613;&#x53D1;&#x751F;&#x95EE;&#x9898;&#x7684;&#x3002;Chez Scheme&#x4F7F;&#x7528;&#x901A;&#x7528;&#x7684;&#x9677;&#x5165;&#x65B9;&#x5F0F;(trapping)&#x5C1D;&#x8BD5;&#x8FD4;&#x56DE;&#x5230;&#x65E7;&#x5916;&#x90E8;&#x4E0A;&#x4E0B;&#x6587;&#xFF08;stale foreign context&#xFF09;&#x6765;&#x5904;&#x7406;&#x4EA4;&#x4E92;&#xFF0C;&#x800C;&#x4E0D;&#x662F;&#x76F4;&#x63A5;&#x9650;&#x5236;&#x5EF6;&#x7EED;&#xFF08;continuations&#xFF09;&#x7684;&#x4F7F;&#x7528;&#x3002;&#x5916;&#x90E8;&#x4E0A;&#x4E0B;&#x6587;&#x662F;&#x4E00;&#x4E2A;&#x5916;&#x90E8;&#x5E27;&#xFF08;foreign frame&#xFF09;&#x548C;&#x6765;&#x81EA;&#x5916;&#x90E8;&#x51FD;&#x6570;&#x7279;&#x5B9A;&#x8C03;&#x7528;&#x7684;&#x8FD4;&#x56DE;&#x70B9;&#xFF0C;&#x4F8B;&#x5982;&#xFF0C;&#x4ECE;C&#x8FDB;&#x5165;Scheme&#x3002;&#x5728;&#x4E00;&#x4E2A;&#x5E73;&#x5E38;&#x7684;&#x8FD4;&#x56DE;&#x5230;&#x4E0A;&#x4E0B;&#x6587;&#x6216;&#x8005;&#x8FD4;&#x56DE;&#x5230;&#x63A7;&#x5236;&#x6808;&#x4E0A;&#x7684;&#x5728;&#x5176;&#x4E0B;&#x9762;&#x7684;&#x5176;&#x4ED6;&#x5916;&#x90E8;&#x4E0A;&#x4E0B;&#x6587;&#x540E;&#xFF0C;&#x5916;&#x90E8;&#x4E0A;&#x4E0B;&#x6587;&#x5C06;&#x53D8;&#x65E7;&#x3002;</p>
<p>&#x8FD9;&#x6837;&#x5904;&#x7406;&#x7684;&#x7ED3;&#x679C;&#x662F;&#xFF0C;Scheme&#x5EF6;&#x7EED;&#x903B;&#x8F91;&#x4E0A;&#x80FD;&#x88AB;&#x7528;&#x6765;&#x91CA;&#x653E;&#x63A7;&#x5236;&#x6743;&#xFF0C;&#x65E0;&#x8BBA;&#x662F;&#x5411;&#x4E0A;&#x6216;&#x8005;&#x5411;&#x4E0B;&#xFF0C;&#x901A;&#x8FC7;&#x4EFB;&#x610F;&#x6DF7;&#x5408;Scheme&#x548C;&#x5916;&#x90E8;&#x5E27;&#x7684;&#x65B9;&#x5F0F;&#x3002;&#x66F4;&#x8FDB;&#x4E00;&#x6B65;&#x8BB2;&#xFF0C;&#x76F4;&#x5230;&#x8FD4;&#x56DE;&#x5916;&#x90E8;&#x4E0A;&#x4E0B;&#x6587;&#x88AB;&#x771F;&#x6B63;&#x6267;&#x884C;&#xFF0C;&#x6240;&#x6709;&#x7684;&#x8FD4;&#x56DE;&#x70B9;&#x90FD;&#x662F;&#x6709;&#x6548;&#x5730;&#x3002;&#x7279;&#x522B;&#x7684;&#xFF0C;&#x8FD9;&#x8868;&#x793A;&#x4F7F;&#x7528;&#x5EF6;&#x7EED;&#x7684;&#x7A0B;&#x5E8F;&#xFF0C;&#x9664;&#x4E86;&#x975E;&#x5C40;&#x90E8;&#x9000;&#x51FA;&#x7684;&#x60C5;&#x51B5;&#xFF0C;&#x7EDD;&#x4E0D;&#x4F1A;&#x5C1D;&#x8BD5;&#x8FD4;&#x56DE;&#x5230;&#x4E00;&#x4E2A;&#x65E7;&#x5916;&#x90E8;&#x4E0A;&#x4E0B;&#x6587;&#x3002;&#xFF08;&#x975E;&#x5C40;&#x90E8;&#x9000;&#x51FA;&#x672C;&#x8EAB;&#x5E76;&#x6CA1;&#x6709;&#x95EE;&#x9898;&#xFF0C;&#x662F;&#x7531;C&#x51FD;&#x6570;&#x5E93;longjmp&#x53CA;&#x5176;&#x7B49;&#x6548;&#x65B9;&#x5F0F;&#x5B9E;&#x73B0;&#x7684;&#xFF09;&#x3002;&#x4F7F;&#x7528;&#x5EF6;&#x7EED;&#x7684;&#x7A0B;&#x5E8F;&#x53EA;&#x8981;&#x5B83;&#x4EEC;&#x7EDD;&#x4E0D;&#x771F;&#x6B63;&#x8FD4;&#x56DE;&#x5230;&#x4E00;&#x4E2A;&#x65E7;&#x5916;&#x90E8;&#x4E0A;&#x4E0B;&#x6587;&#x4E00;&#x822C;&#x90FD;&#x80FD;&#x591F;&#x6B63;&#x5E38;&#x5730;&#x5DE5;&#x4F5C;&#xFF0C;&#x5373;&#x4F7F;&#x901A;&#x8FC7;&#x5EF6;&#x7EED;&#x7684;&#x8C03;&#x7528;&#xFF0C;&#x5728;&#x903B;&#x8F91;&#x4E0A;&#x63A7;&#x5236;&#x8D8A;&#x8FC7;&#x4E86;&#x65E7;&#x4E0A;&#x4E0B;&#x6587;&#x3002;</p>
<p>&#x4E00;&#x79CD;&#x8BE5;&#x673A;&#x5236;&#x7684;&#x7ED3;&#x679C;&#x4F1A;&#x662F;&#xFF1A;&#x5F53;Scheme&#x7AEF;&#x4F7F;&#x7528;&#x4E86;&#x5EF6;&#x7EED;&#x65F6;&#xFF0C;&#x975E;&#x5C40;&#x90E8;&#x9000;&#x51FA;&#x60C5;&#x51B5;&#x4E0B;&#xFF0C;C&#x6808;&#x6307;&#x9488;&#x4E0D;&#x4F1A;&#x81EA;&#x52A8;&#x6062;&#x590D;&#x5176;&#x57FA;&#x503C;&#xFF08;base value&#xFF09;&#x3002;&#x5982;&#x679C;&#x7A0B;&#x5E8F;&#x5728;&#x975E;&#x5C40;&#x90E8;&#x9000;&#x51FA;&#x540E;&#x7EE7;&#x7EED;&#x8FD0;&#x884C;&#x7684;&#x8BDD;&#xFF0C;&#x540E;&#x9762;&#x5EFA;&#x7ACB;&#x7684;C&#x6808;&#x4F1A;&#x88AB;&#x589E;&#x52A0;&#x5230;&#x5DF2;&#x7ECF;&#x5B58;&#x5728;&#x7684;&#x6808;&#x4E0A;&#xFF0C;&#x53EF;&#x80FD;&#x4F1A;&#x5BFC;&#x81F4;C&#x6808;&#x6EA2;&#x51FA;&#x3002;&#x4E3A;&#x4E86;&#x907F;&#x514D;&#x8BE5;&#x60C5;&#x51B5;&#x7684;&#x53D1;&#x751F;&#xFF0C;&#x7A0B;&#x5E8F;&#x53EF;&#x4EE5;&#x5728;&#x83B7;&#x53D6;&#x5EF6;&#x7EED;&#x4E4B;&#x524D;&#x5B89;&#x6392;&#x5EFA;&#x7ACB;&#x4E00;&#x4E2A;&#x5355;&#x72EC;&#x7684;C&#x8C03;&#x7528;&#x5E27;&#xFF0C;&#x5728;&#x975E;&#x5C40;&#x90E8;&#x9000;&#x51FA;&#x540E;&#x8FD4;&#x56DE;&#x5230;&#x8BE5;C&#x5E27;&#x3002;&#x4E0B;&#x9762;&#x7684;with-exit_-proc&#x8FC7;&#x7A0B;&#x5C31;&#x662F;&#x5B89;&#x6392;&#x505A;&#x8FD9;&#x4E2A;&#xFF0C;&#x5E76;&#x4E14;&#x4E0D;&#x6D89;&#x53CA;&#x5230;C&#x4EE3;&#x7801;&#x3002;</p>
<pre><code>(define with-exit-proc
  (lambda (p)
    (define th (lambda () (call/cc p)))
    (define-ftype -&gt;ptr (function () ptr))
    (let ([fptr (make-ftype-pointer -&gt;ptr th)])
      (let ([v ((ftype-ref -&gt;ptr () fptr))])
        (unlock-object
          (foreign-callable-code-object
            (ftype-pointer-address fptr)))
        v))))
</code></pre><p>&#x9664;&#x4E86;&#x5F53;&#x5EF6;&#x7EED;&#x88AB;&#x8C03;&#x7528;&#x65F6;&#x4F1A;&#x91CD;&#x7F6E;C&#x7684;&#x6808;&#xFF0C;with-exit-proc&#x7C7B;&#x4F3C;call/cc&#x3002;&#x4E3A;&#x4E86;&#x5B9E;&#x73B0;&#x8FD9;&#x4E2A;&#xFF0C;&#x5176;&#x521B;&#x5EFA;&#x4E86;th&#x7684;&#x4E00;&#x4E2A;ftype-pointer&#x6765;&#x8868;&#x793A;foreign-callable&#x5165;&#x53E3;&#xFF0C;&#x5E76;&#x521B;&#x5EFA;&#x4E86;&#x4E00;&#x4E2A;Scheme&#x53EF;&#x8C03;&#x7528;&#x8FC7;&#x7A0B;&#x7684;&#x5165;&#x53E3;&#x3002;&#x8FD9;&#x4E3A;th&#x5EFA;&#x7ACB;&#x4E86;&#x4E00;&#x4E2A;&#x6D89;&#x53CA;C&#x8C03;&#x7528;&#x7684;&#x5C01;&#x88C5;&#x3002;&#x5F53;&#x8BE5;&#x5C01;&#x88C5;&#x8FD4;&#x56DE;&#x65F6;&#xFF0C;&#x65E0;&#x8BBA;&#x662F;&#x901A;&#x8FC7;&#x663E;&#x793A;&#x7684;&#x5EF6;&#x7EED;&#x8C03;&#x7528;&#x4F20;&#x9012;p&#xFF0C;&#x8FD8;&#x662F;&#x4E00;&#x822C;&#x5730;&#x4ECE;p&#x8FD4;&#x56DE;&#xFF0C;C&#x6808;&#x90FD;&#x4F1A;&#x88AB;&#x91CD;&#x7F6E;&#x4E3A;&#x539F;&#x59CB;&#x503C;&#x3002;</p>
<h2 id="45-&#x5916;&#x90E8;&#x6570;&#x636E;&#xFF08;foreign-data&#xFF09;">4.5 &#x5916;&#x90E8;&#x6570;&#x636E;&#xFF08;Foreign Data&#xFF09;</h2>
<p>&#x672C;&#x8282;&#x4ECB;&#x7ECD;&#x76F4;&#x63A5;&#x521B;&#x5EFA;&#x548C;&#x64CD;&#x4F5C;&#x5916;&#x90E8;&#x6570;&#x636E;&#x7684;&#x8FC7;&#x7A0B;&#xFF0C;&#x5373;&#x5728;&#x5B58;&#x5728;&#x4E8E;Scheme&#x5806;&#x5916;&#x7684;&#x6570;&#x636E;&#x3002;&#x7531;&#x4E8E;foreign-alloc&#x548C;foreign-sizeof&#x7684;&#x5F02;&#x5E38;&#xFF0C;&#x5C31;&#x5B83;&#x4EEC;&#x4E0D;&#xFF08;&#x4E0D;&#x80FD;&#xFF09;&#x68C0;&#x67E5;&#x4F20;&#x7ED9;&#x5B83;&#x4EEC;&#x7684;&#x5730;&#x5740;&#x7684;&#x6709;&#x6548;&#x6027;&#x800C;&#x8A00;&#xFF0C;&#x8FD9;&#x4E9B;&#x8FC7;&#x7A0B;&#x672C;&#x8D28;&#x4E0A;&#x662F;&#x4E0D;&#x5B89;&#x5168;&#x7684;&#x3002;&#x4E0D;&#x6070;&#x5F53;&#x7684;&#x4F7F;&#x7528;&#x8FD9;&#x4E9B;&#x8FC7;&#x7A0B;&#x4F1A;&#x5BFC;&#x81F4;&#x65E0;&#x6548;&#x7684;&#x5185;&#x5B58;&#x5F15;&#x7528;&#xFF0C;&#x6BC1;&#x574F;&#x6570;&#x636E;&#xFF0C;&#x6216;&#x7CFB;&#x7EDF;&#x5D29;&#x6E83;&#x3002;</p>
<p>&#x8BE5;&#x8282;&#x4E5F;&#x4ECB;&#x7ECD;&#x4E00;&#x4E2A;&#x66F4;&#x9AD8;&#x9636;&#x7684;&#x64CD;&#x4F5C;&#x5916;&#x90E8;&#x6570;&#x636E;&#x7684;&#x8BED;&#x6CD5;&#x673A;&#x5236;&#xFF0C;&#x5305;&#x542B;&#x5916;&#x90E8;&#x7ED3;&#x679C;&#x4F53;&#xFF0C;&#x8054;&#x5408;&#x4F53;&#xFF0C;&#x6570;&#x7EC4;&#xFF0C;&#x4F4D;&#x57DF;&#x3002;&#x8BED;&#x6CD5;&#x63A5;&#x53E3;&#x6BD4;&#x8FC7;&#x7A0B;&#x63A5;&#x53E3;&#x66F4;&#x52A0;&#x5B89;&#x5168;&#xFF0C;&#x4F46;&#x662F;&#x4ECD;&#x5FC5;&#x987B;&#x5047;&#x8BBE;&#x5BF9;&#x7ED9;&#x51FA;&#x7684;&#x88AB;&#x64CD;&#x4F5C;&#x7684;&#x5BF9;&#x8C61;&#x7C7B;&#x578B;&#x7684;&#x5730;&#x5740;&#x662F;&#x6B63;&#x786E;&#x7684;&#x3002;</p>
<p>&#x8FC7;&#x7A0B;: (foreign-alloc n)
&#x8FD4;&#x56DE;: &#x65B0;&#x5206;&#x914D;&#x7684;&#x5916;&#x90E8;&#x6570;&#x636E;&#x5757;&#x7684;&#x5730;&#x5740;&#xFF0C;&#x5177;&#x6709;n&#x5B57;&#x8282;&#x957F;&#x5EA6;
&#x5E93;: (chezscheme)</p>
<p>n&#x5FC5;&#x987B;&#x662F;&#x4E00;&#x4E2A;&#x6B63;&#x7684;fixnum&#x3002;&#x8FD4;&#x56DE;&#x503C;&#x662F;&#x4E00;&#x4E2A;exact integer&#xFF0C;&#x786E;&#x4FDD;&#x6309;&#x5E95;&#x5C42;&#x786C;&#x4EF6;&#x7684;&#x8981;&#x6C42;&#x5BF9;&#x4EFB;&#x610F;&#x7C7B;&#x578B;&#x5408;&#x7406;&#x5BF9;&#x9F50;&#x3002;&#x5982;&#x679C;&#x5916;&#x90E8;&#x6570;&#x636E;&#x5757;&#x4E0D;&#x80FD;&#x88AB;&#x5206;&#x914D;&#xFF0C;&#x4F1A;&#x629B;&#x51FA;&#x4E00;&#x4E2A;&amp;assertion&#x6761;&#x4EF6;&#x7C7B;&#x578B;&#x5F02;&#x5E38;&#x3002;</p>
<p>&#x8FC7;&#x7A0B;: (foreign-free address)
&#x8FD4;&#x56DE;: &#x672A;&#x6307;&#x5B9A;
libraries: (chezscheme)</p>
<p>&#x8BE5;&#x8FC7;&#x7A0B;&#x91CA;&#x653E;&#x5730;&#x5740;&#x70B9;&#x5904;&#x7684;&#x50A8;&#x5B58;&#x5757;&#x3002;&#x5730;&#x5740;&#x5FC5;&#x987B;&#x662F;&#x4E00;&#x4E2A;&#x5728;-2<sup>w-1</sup>&#x5230;2<sup>w</sup> - 1&#x8303;&#x56F4;&#x7684;exact integer&#xFF0C;&#x5176;&#x4E2D;w&#x662F;&#x6307;&#x9488;&#x7684;&#x5B57;&#x8282;&#x5BBD;&#x5EA6;&#xFF0C;&#x5373;&#x5BF9;&#x4E8E;64&#x4F4D;&#x673A;&#x5668;&#x662F;64&#x3002;&#x5B83;&#x5FC5;&#x987B;&#x662F;&#x7531;&#x4E4B;&#x524D;foreign-alloc&#x8FD4;&#x56DE;&#x7684;&#x5730;&#x5740;&#xFF0C;&#x800C;&#x4E0D;&#x662F;&#x4F20;&#x7ED9;foreign-free&#x540E;&#x7684;&#x3002;</p>
<p>&#x8FC7;&#x7A0B;: (foreign-ref type address offset)
&#x8FD4;&#x56DE;: &#x89C1;&#x4E0B;&#x6587;
&#x5E93;: (chezscheme)</p>
<p>foreign-ref &#x63D0;&#x53D6;type&#x7C7B;&#x578B;&#x7684;&#x503C;&#xFF0C;&#x8BE5;&#x503C;&#x7684;&#x5730;&#x5740;&#x5728;&#x5916;&#x90E8;&#x6570;&#x636E;&#x5730;&#x5740;address&#x504F;&#x79FB;offset&#x5B57;&#x8282;&#x5904;&#x3002;</p>
<p>type&#x5FC5;&#x987B;&#x662F;&#x4E2A;&#x8BC6;&#x522B;&#x8981;&#x63D0;&#x53D6;&#x7684;&#x503C;&#x7C7B;&#x578B;&#x7684;&#x7B26;&#x53F7;&#x3002;&#x4E0B;&#x9762;&#x7684;&#x7C7B;&#x578B;&#x5177;&#x6709;&#x4F9D;&#x8D56;&#x4E8E;&#x673A;&#x5668;&#x7684;&#x5927;&#x5C0F;&#x548C;&#x7C7B;&#x4F3C;&#x4E8E;C&#x4E2D;&#x7684;&#x7C7B;&#x578B;&#x540D;&#x79F0;&#xFF1A;</p>
<ul>
<li>short,</li>
<li>unsigned-short,</li>
<li>int,</li>
<li>unsigned,</li>
<li>unsigned-int,</li>
<li>long,</li>
<li>unsigned-long,</li>
<li>long-long,</li>
<li>unsigned-long-long,</li>
<li>ptrdiff_t,</li>
<li>size_t,</li>
<li>ssize_t,</li>
<li>char,</li>
<li>wchar_t,</li>
<li>float,</li>
<li>double,</li>
<li>void*</li>
</ul>
<p>long-long&#x548C;unsigned-long-long&#x7C7B;&#x578B;&#x5BF9;&#x5E94;&#x4E8E;C&#x7C7B;&#x578B;&#x4E2D;&#x7684;long long&#x548C;unsigned long long&#x3002;char&#x7C7B;&#x578B;&#x7684;&#x503C;&#x4EE5;&#x5355;&#x5B57;&#x8282;&#x5F15;&#x7528;&#xFF0C;&#x5E76;&#x8F6C;&#x6362;&#x4E3A;Scheme character&#xFF08;&#x7C7B;&#x4F3C;&#x901A;&#x8FC7;integer-&gt;char&#xFF09;&#x3002;wchar_t&#x7C7B;&#x578B;&#x7684;&#x503C;&#x88AB;&#x8F6C;&#x6362;&#x4E3A;Scheme character&#xFF08;&#x7C7B;&#x4F3C;&#x901A;&#x8FC7;integer-&gt;char&#xFF09;&#x3002;&#x5176;&#x503C;&#x5FC5;&#x987B;&#x662F;&#x4E00;&#x4E2A;&#x6709;&#x6548;&#x5730;Unicode&#x6807;&#x91CF;&#x503C;&#x3002;</p>
<p>wchar&#x662F;wchar_t&#x7684;&#x522B;&#x540D;&#x3002;</p>
<p>&#x53E6;&#x5916;&#x4E00;&#x4E9B;&#x4F9D;&#x8D56;&#x673A;&#x5668;&#x7684;&#x7C7B;&#x578B;&#x88AB;&#x8BB0;&#x4E3A;&#xFF1A;</p>
<ul>
<li>iptr,</li>
<li>uptr,</li>
<li>fixnum, and</li>
<li>boolean.</li>
</ul>
<p>uptr&#x7B49;&#x6548;&#x4E8E;void*&#xFF1B;&#x4E24;&#x8005;&#x90FD;&#x88AB;&#x5F53;&#x4F5C;unsigned integers&#xFF0C;&#x5373;&#x6307;&#x9488;&#x7684;&#x5927;&#x5C0F;&#x3002;itpr&#x88AB;&#x5F53;&#x4F5C;signed integer&#xFF0C;&#x5373;&#x6307;&#x9488;&#x7684;&#x5927;&#x5C0F;&#x3002;fixnum&#x88AB;&#x5F53;&#x4F5C;&#x4E00;&#x4E2A;iptr&#xFF0C;&#x4F46;&#x662F;&#x503C;&#x8303;&#x56F4;&#x88AB;&#x9650;&#x5B9A;&#x5728;fixnum&#x7684;&#x503C;&#x8303;&#x56F4;&#x3002;boolean&#x88AB;&#x5F53;&#x4F5C;&#x4E00;&#x4E2A;int&#xFF0C;0&#x88AB;&#x8F6C;&#x6362;&#x4E3A;Scheme&#x4E2D;&#x7684;#f&#xFF0C;&#x5176;&#x4ED6;&#x503C;&#x88AB;&#x8F6C;&#x6362;&#x4E3A;#t&#x3002;</p>
<p>&#x6700;&#x540E;&#x662F;&#x4E00;&#x4E9B;&#x652F;&#x6301;&#x7684;&#x56FA;&#x5B9A;&#x5927;&#x5C0F;&#x7C7B;&#x578B;&#xFF1A;</p>
<ul>
<li>integer-8,</li>
<li>unsigned-8,</li>
<li>integer-16,</li>
<li>unsigned-16,</li>
<li>integer-32,</li>
<li>unsigned-32,</li>
<li>integer-64,</li>
<li>unsigned-64,</li>
<li>single-float, and</li>
<li>double-float.</li>
</ul>
<p>&#xFF08;&#x8BD1;&#x8005;&#x6CE8;&#xFF1A;&#x539F;&#x6587;&#x4E2D;&#xFF0C;&#x8FD9;&#x91CC;&#x591A;&#x51FA;&#x73B0;&#x4E86;&#x4E00;&#x6BB5;&#x4EE5;&#x4E0B;&#x51FD;&#x6570;&#x7684;address&#x63CF;&#x8FF0;&#xFF09;</p>
<p>&#x8FC7;&#x7A0B;: (foreign-set! type address offset value)
&#x8FD4;&#x56DE;: &#x89C1;&#x4E0B;&#x6587;
&#x5E93;: (chezscheme)</p>
<p>foreign-set! &#x5B58;&#x50A8;&#x4E86;&#x4E00;&#x4E2A;&#x8868;&#x793A;value&#x7684;type&#x7C7B;&#x578B;&#x7684;&#x503C;&#xFF0C;&#x5176;&#x901A;&#x8FC7;&#x5916;&#x90E8;&#x6570;&#x636E;&#x5757;&#x5730;&#x5740;address&#x504F;&#x79FB;offset&#x5B57;&#x8282;&#x5BFB;&#x5740;&#x3002;</p>
<p>type&#x5FC5;&#x987B;&#x662F;&#x4E00;&#x4E2A;&#x8BC6;&#x522B;&#x50A8;&#x5B58;&#x503C;&#x7C7B;&#x578B;&#x7684;&#x7B26;&#x53F7;&#xFF0C;&#x4E3A;&#x5217;&#x5728;&#x4E0A;&#x9762;foreign-ref&#x63CF;&#x8FF0;&#x4E2D;&#x7684;&#x5176;&#x4E2D;&#x4E00;&#x4E2A;&#x7C7B;&#x578B;&#x3002;Scheme characters&#x88AB;&#x8F6C;&#x6362;&#x4E3A;char &#x6216;&#x8005; wchar_t&#xFF0C;&#x7C7B;&#x4F3C;&#x901A;&#x8FC7;char-&gt;integer&#x3002;&#x5BF9;&#x4E8E;boolean&#x7C7B;&#x578B;&#xFF0C;Scheme #f&#x8F6C;&#x6362;&#x4E3A;0&#xFF0C;&#x4EFB;&#x4F55;&#x5176;&#x4ED6;Scheme&#x5BF9;&#x8C61;&#x8F6C;&#x6362;&#x4E3A;1&#x3002;</p>
<p>&#x5730;&#x5740;&#x5FC5;&#x987B;&#x662F;&#x4E00;&#x4E2A;&#x5728;-2<sup>w-1</sup>&#x5230;2<sup>w</sup> - 1&#x8303;&#x56F4;&#x7684;exact integer&#xFF0C;&#x5176;&#x4E2D;w&#x662F;&#x6307;&#x9488;&#x7684;&#x5B57;&#x8282;&#x5BBD;&#x5EA6;&#xFF0C;&#x5373;&#x5BF9;&#x4E8E;64&#x4F4D;&#x673A;&#x5668;&#x662F;64&#x3002;offset&#x5FC5;&#x987B;&#x662F;&#x4E00;&#x4E2A;exact fixnum&#x3002;address&#x4E0E;offset&#x4E4B;&#x548C;&#x80FD;&#x591F;&#x5BFB;&#x5740;&#x4E00;&#x4E2A;&#x8DB3;&#x591F;&#x5BB9;&#x7EB3;type&#x7C7B;&#x578B;&#x7684;&#x503C;&#x5927;&#x5C0F;&#x7684;&#x53EF;&#x8BFB;&#x5185;&#x5B58;&#x5757;&#xFF0C;&#x5728;&#x4E00;&#x4E2A;&#x7531;foreign-alloc&#x8FD4;&#x56DE;&#x7684;&#x5B58;&#x50A8;&#x5757;&#x4E2D;&#xFF0C;&#x4E14;&#x5E76;&#x6CA1;&#x6709;&#x88AB;foreign-free&#x91CA;&#x653E;&#xFF0C;&#x6216;&#x8005;&#x5728;&#x7531;&#x5176;&#x4ED6;&#x673A;&#x5236;&#x83B7;&#x53D6;&#x7684;&#x4E00;&#x4E2A;&#x5B58;&#x50A8;&#x5757;&#x4E2D;&#xFF0C;&#x4F8B;&#x5982;&#xFF0C;&#x5916;&#x90E8;&#x8C03;&#x7528;&#x3002;&#x5BF9;&#x4E8E;&#x591A;&#x5B57;&#x8282;&#x7684;&#x503C;&#xFF0C;&#x5047;&#x8BBE;&#x4F7F;&#x7528;&#x673A;&#x5668;&#x672C;&#x8EAB;&#x7684;endianness&#x3002;</p>
<p>&#x8FC7;&#x7A0B;: (foreign-sizeof type)
&#x8FD4;&#x56DE;: type&#x7684;&#x5B57;&#x8282;&#x5927;&#x5C0F;
&#x5E93;: (chezscheme)</p>
<p>type &#x4E3A;&#x5217;&#x5728;&#x4E0A;&#x9762;foreign-ref&#x63CF;&#x8FF0;&#x4E2D;&#x7684;&#x5176;&#x4E2D;&#x4E00;&#x4E2A;&#x7C7B;&#x578B;&#x3002;</p>
<p>&#x8BED;&#x6CD5;: (define-ftype ftype-name ftype)
&#x8BED;&#x6CD5;: (define-ftype (ftype-name ftype) ...)
&#x8FD4;&#x56DE;: &#x672A;&#x6307;&#x5B9A;
&#x5E93;: (chezscheme)</p>
<p>define-ftype &#x5F62;&#x5F0F;&#x662F;&#x4E00;&#x4E2A;&#x5B9A;&#x4E49;&#xFF0C;&#x80FD;&#x51FA;&#x73B0;&#x4E8E;&#x4EFB;&#x4F55;&#x5176;&#x4ED6;&#x5B9A;&#x4E49;&#x80FD;&#x591F;&#x51FA;&#x73B0;&#x7684;&#x5730;&#x65B9;&#x3002;&#x5B83;&#x5EFA;&#x7ACB;&#x4E86;&#x4E00;&#x4E2A;&#x6216;&#x591A;&#x4E2A;foreign-type(ftype)&#x7684;&#x7ED1;&#x5B9A;&#xFF0C;&#x4ECE;&#x6807;&#x8BC6;ftype-name&#x6216;&#x8005;&#x6807;&#x8BC6;ftype-name ...&#x5230;&#x5916;&#x90E8;&#x7C7B;&#x578B;ftype&#x6216;ftype ...&#x7684;&#x7ED1;&#x5B9A;&#x3002;&#x6BCF;&#x4E2A;ftype-name&#x80FD;&#x88AB;&#x7528;&#x4E8E;&#x83B7;&#x53D6;&#x58F0;&#x660E;&#x7C7B;&#x578B;&#x7684;&#x5916;&#x90E8;&#x5BF9;&#x8C61;&#xFF08;&#x8BD1;&#x8005;&#x6CE8;&#xFF1A;&#x539F;&#x6587;&#x4E3A;declared shape&#xFF0C;&#x662F;&#x5426;&#x662F;declared type?&#xFF09;&#xFF0C;&#x6BCF;&#x4E2A;&#x80FD;&#x88AB;&#x7528;&#x4E8E;&#x6784;&#x6210;&#x5176;&#x4ED6;ftype&#x3002;</p>
<p>&#x4E00;&#x4E2A;ftype&#x5FC5;&#x987B;&#x662F;&#x4EE5;&#x4E0B;&#x5F62;&#x5F0F;&#x4E2D;&#x7684;&#x4E00;&#x79CD;&#xFF1A;</p>
<ul>
<li>ftype-name</li>
<li>(struct (field-name ftype) ...)</li>
<li>(union (field-name ftype) ...)</li>
<li>(array length ftype)</li>
<li>(* ftype)</li>
<li>(bits (field-name signedness bits) ...)</li>
<li>(function conv ... (ftype ...) ftype)</li>
<li>(packed ftype)</li>
<li>(unpacked ftype)</li>
<li>(endian endianness ftype)</li>
</ul>
<p>&#x5176;&#x4E2D;length&#x662F;&#x4E00;&#x4E2A;&#x975E;&#x8D1F;exact integer&#xFF0C;bits&#x662F;&#x4E00;&#x4E2A;&#x6B63;&#x7684;exact integer&#xFF0C;field-name&#x662F;&#x4E00;&#x4E2A;&#x6807;&#x8BC6;&#x7B26;&#xFF0C;conv&#x662F;#f&#x6216;&#x5982;4.2&#x6240;&#x8FF0;&#x7684;&#x6709;&#x6548;&#x8C03;&#x7528;&#x89C4;&#x5219;&#x540D;&#x5B57;&#x7684;string&#xFF0C;signedness&#x4E3A;signed&#x6216;&#x8005;unsigned&#xFF0C;endianness&#x662F;native, big, little&#x4E2D;&#x7684;&#x5176;&#x4E2D;&#x4E00;&#x4E2A;&#x3002;</p>
<p>&#x4EE5;&#x4E0A;&#x5E76;&#x6CA1;&#x6709;&#x53CD;&#x5E94;&#x51FA;&#x4E00;&#x4E2A;&#x9650;&#x5236;&#xFF0C;&#x5373;function ftypes&#x4E0D;&#x80FD;&#x88AB;&#x7528;&#x4E8E;field names &#x6216; array &#x4E2D;&#x503C;&#x7684;&#x7C7B;&#x578B;&#x3002;&#x5C31;&#x662F;&#x8BF4;&#xFF0C;function types&#x53EA;&#x5728;&#x4E00;&#x4E2A;ftype&#x7684;&#x6700;&#x9876;&#x5C42;&#x6709;&#x6548;&#xFF0C;&#x5982;&#xFF1A;</p>
<p><code>(define-ftype bvcopy_t (function (u8* u8* size_t) void))</code></p>
<p>&#x6216;&#x8005;&#x76F4;&#x63A5;&#x4F5C;&#x4E3A;&#x6307;&#x9488;ftype&#xFF08;*&#xFF09;&#x7C7B;&#x578B;&#x7684;&#x5B50;&#x7C7B;&#x578B;&#xFF0C;&#x5982;&#x4EE5;&#x4E0B;&#x5B9A;&#x4E49;&#xFF0C;&#x5176;&#x7B49;&#x6548;&#x4E8E;&#x4E0A;&#x9762;&#x7684;bvcopy_t&#x7684;&#x5B9A;&#x4E49;&#x3002;</p>
<pre><code>(define-ftype A
  (struct
    [x int]
    [f (* (function (u8* u8* size_t) void))]))

(define-ftype A
  (struct
    [x int]
    [f (* bvcopy_t)]))
</code></pre><p>&#x4E5F;&#x5C31;&#x662F;&#x8BF4;&#xFF0C;function&#x4E0D;&#x80FD;&#x76F4;&#x63A5;&#x5D4C;&#x5165;struct&#xFF0C;union&#xFF0C;array&#x4E2D;&#xFF0C;&#x4F46;&#x662F;function&#x7684;&#x6307;&#x9488;&#x80FD;&#x591F;&#x88AB;&#x5D4C;&#x5165;&#x3002;</p>
<p>&#x5982;&#x4E0B;&#x5B9A;&#x4E49;&#x5EFA;&#x7ACB;&#x4E86;F&#xFF0C;A&#xFF0C;E&#x7684;ftype&#x7ED1;&#x5B9A;&#x3002;</p>
<pre><code>(define-ftype F (function (wchar_t int) int))

(define-ftype A (array 10 wchar_t))

(define-ftype E
  (struct
    [a int]
    [b double]
    [c (array 25
         (struct
           [a short]
           [_ long]
           [b A]))]
    [d (endian big
         (union
           [v1 unsigned-32]
           [v2 (bits
                 [hi unsigned 12]
                 [lo unsigned 20])]))]
    [e (* A)]
    [f (* F)]))
</code></pre><p>ftype F &#x63CF;&#x8FF0;&#x4E86;&#x63A5;&#x6536;&#x4E24;&#x4E2A;&#x53C2;&#x6570;&#x7684;&#x5916;&#x90E8;&#x51FD;&#x6570;&#x7684;&#x7C7B;&#x578B;&#xFF0C;&#x4E00;&#x4E2A;&#x5BBD;&#x5B57;&#x7B26;&#x548C;&#x4E00;&#x4E2A;integer&#xFF0C;&#x8FD4;&#x56DE;&#x4E00;&#x4E2A;integer&#x3002;ftype A&#x662F;&#x4E00;&#x4E2A;&#x7B80;&#x5355;&#x7684;&#x542B;&#x6709;10&#x4E2A;wchar_t&#x7684;&#x6570;&#x7EC4;&#xFF0C;&#x5176;&#x5927;&#x5C0F;&#x4E3A;10&#x500D;&#x7684;&#x5355;&#x4E2A;wchar_t&#x3002;ftype E&#x662F;&#x4E00;&#x4E2A;&#x6709;&#x4E94;&#x4E2A;&#x57DF;&#x7684;&#x7ED3;&#x6784;&#x4F53;&#xFF0C;&#x4E00;&#x4E2A;integer&#x7C7B;&#x578B;a&#xFF0C;&#x4E00;&#x4E2A;double&#x7C7B;&#x578B;b&#xFF0C;&#x4E00;&#x4E2A;&#x6570;&#x7EC4;c&#xFF0C;&#x4E00;&#x4E2A;&#x8054;&#x5408;d&#xFF0C;&#x4E00;&#x4E2A;&#x6307;&#x9488;e&#x3002;&#x6570;&#x7EC4;c&#x662F;&#x5305;&#x542B;25&#x4E2A;&#x7ED3;&#x6784;&#x4F53;&#x7684;&#x6570;&#x7EC4;&#xFF0C;&#x6BCF;&#x4E2A;&#x7ED3;&#x6784;&#x4F53;&#x5305;&#x542B;&#x4E00;&#x4E2A;short integer&#x7C7B;&#x578B;&#xFF0C;&#x4E00;&#x4E2A;long integer&#x7C7B;&#x578B;&#xFF0C;&#x4E00;&#x4E2A;A&#x7C7B;&#x578B;&#x6570;&#x7EC4;&#x3002;c&#x6570;&#x7EC4;&#x7684;&#x5927;&#x5C0F;&#x662F;25&#x500D;&#x7684;A&#x7C7B;&#x578B;&#x6570;&#x7EC4;&#xFF0C;&#x52A0;&#x4E0A;25&#x500D;&#x7684;&#x80FD;&#x591F;&#x5B58;&#x50A8;&#x4E00;&#x4E2A;short&#x548C;&#x4E00;&#x4E2A;long integer&#x7C7B;&#x578B;&#x7684;&#x7A7A;&#x95F4;&#x3002;&#x8054;&#x5408;d&#x53EF;&#x4EE5;&#x662F;&#x4E00;&#x4E2A;32bit&#x7684;unsigned integer&#x7C7B;&#x578B;&#x6216;&#x8005;&#x4E00;&#x4E2A;32bit unsigned integer&#x5206;&#x4E3A;&#x9AD8;&#x4F4D;&#xFF08;12bits&#xFF09;&#x548C;&#x4F4E;&#x4F4D;&#xFF08;20btis&#xFF09;&#x5206;&#x91CF;&#x3002;&#x8054;&#x5408;&#x7684;&#x57DF;&#x662F;&#x91CD;&#x5408;&#x7684;&#xFF0C;&#x4EE5;&#x81F3;&#x4E8E;&#x5F80;&#x4E00;&#x4E2A;&#x5199;&#x5165;&#x4F1A;&#x6709;&#x6548;&#x5730;&#x5F71;&#x54CD;&#x5230;&#x53E6;&#x4E00;&#x4E2A;&#x3002;&#x56E0;&#x6B64;&#xFF0C;&#x53EF;&#x4EE5;&#x4F7F;&#x7528;d&#x8054;&#x5408;&#x7C7B;&#x578B;&#x5206;&#x5F00;&#x4E00;&#x4E2A;unsigned integer&#xFF0C;&#x901A;&#x8FC7;&#x5F80;v1&#x4E2D;&#x5199;&#x5165;&#xFF0C;&#x800C;&#x4ECE;hi&#x548C;lo&#x8BFB;&#x53D6;&#x3002;e&#x662F;&#x4E00;&#x4E2A;&#x6307;&#x5411;A&#x6570;&#x7EC4;&#x7684;&#x6307;&#x9488;&#xFF0C;&#x5B83;&#x81EA;&#x5DF1;&#x4E0D;&#x662F;&#x6570;&#x7EC4;&#xFF0C;&#x5B83;&#x7684;&#x5927;&#x5C0F;&#x53EA;&#x662F;&#x5355;&#x4E2A;&#x6307;&#x9488;&#x7684;&#x5927;&#x5C0F;&#x3002;&#x7C7B;&#x4F3C;&#x7684;&#xFF0C;f&#x6307;&#x5411;&#x4E00;&#x4E2A;&#x51FD;&#x6570;&#xFF0C;&#x5B83;&#x7684;&#x5927;&#x5C0F;&#x4E5F;&#x662F;&#x5355;&#x4E2A;&#x6307;&#x9488;&#x7684;&#x5927;&#x5C0F;&#x3002;</p>
<p>&#x4E00;&#x4E2A;&#x4E0B;&#x5212;&#x7EBF;(_)&#x53EF;&#x7528;&#x4E8E;&#x8868;&#x793A;struct, union, bits ftype&#x7684;&#x4E00;&#x4E2A;&#x6216;&#x591A;&#x4E2A;&#x57DF;&#x540D;&#x5B57;&#x3002;&#x5728;&#x5185;&#x5B58;&#x5E03;&#x5C40;&#x4E2D;&#x5305;&#x542B;&#x4E86;&#x8FD9;&#x4E9B;&#x57DF;&#xFF0C;&#x4F46;&#x662F;&#x88AB;&#x8BA4;&#x4E3A;&#x672A;&#x547D;&#x540D;&#xFF0C;&#x4E0D;&#x80FD;&#x901A;&#x8FC7;&#x4EE5;&#x4E0A;&#x63CF;&#x8FF0;&#x7684;ftype&#x7684;&#x64CD;&#x4F5C;&#x83B7;&#x53D6;&#x3002;&#x56E0;&#x6B64;&#xFF0C;&#x4E0A;&#x9762;&#x7684;&#x4F8B;&#x5B50;&#xFF0C;c&#x6570;&#x7EC4;&#x4E2D;&#x7684;long&#x57DF;&#x662F;&#x4E0D;&#x80FD;&#x88AB;&#x83B7;&#x53D6;&#x7684;&#x3002;</p>
<p>&#x4E0D;&#x662F;&#x4E0B;&#x5212;&#x7EBF;&#x7684;&#x540D;&#x5B57;&#x88AB;&#x7B26;&#x53F7;&#x5316;&#x5904;&#x7406;&#xFF0C;&#x5373;&#x4ED6;&#x4EEC;&#x88AB;&#x8BA4;&#x4E3A;&#x662F;&#x7B26;&#x53F7;&#x800C;&#x4E0D;&#x662F;&#x6807;&#x8BC6;&#x7B26;&#x3002;&#x76F8;&#x5BF9;&#x4E8E;&#x540C;&#x4E00;&#x4E2A;struct&#xFF0C;union&#xFF0C;bits ftype&#x4E2D;&#x7684;&#x5176;&#x4ED6;&#x57DF;&#x540D;&#x5B57;&#xFF0C;&#x6BCF;&#x4E2A;&#x7B26;&#x53F7;&#x5FC5;&#x987B;&#x662F;&#x552F;&#x4E00;&#x7684;&#xFF08;&#x4F5C;&#x4E3A;&#x4E00;&#x4E2A;&#x7B26;&#x53F7;&#xFF09;&#xFF0C;&#x4F46;&#x662F;&#x5728;&#x540C;&#x4E00;&#x4E2A;ftype&#x4E2D;&#x5BF9;&#x4E8E;&#x4E0D;&#x540C;&#x7684;struct&#xFF0C;union&#xFF0C;bits ftype&#x4E2D;&#x7684;&#x57DF;&#x540D;&#x5B57;&#x4E0D;&#x9700;&#x8981;&#x662F;&#x552F;&#x4E00;&#x7684;&#x3002;</p>
<p>&#x4E00;&#x4E2A;ftype&#x4E2D;&#x7684;&#x6BCF;&#x4E2A;ftype-name&#x5FC5;&#x987B;&#x6EE1;&#x8DB3;(a)&#x4E4B;&#x524D;&#x5DF2;&#x7ECF;&#x88AB;define-ftype&#x5B9A;&#x4E49;&#x8FC7;&#x4E86;&#xFF0C;(b)&#x88AB;&#x5F53;&#x524D;&#x7684;define-ftype&#x5B9A;&#x4E49;&#xFF0C;&#x6216;&#x8005;(c)&#x662F;&#x4E00;&#x4E2A;&#x57FA;&#x7C7B;&#x540D;&#xFF0C;&#x5373;&#x88AB;foreign-ref&#x548C;foreign-set&#xFF01;&#x6240;&#x652F;&#x6301;&#x7684;&#x7C7B;&#x540D;&#x4E2D;&#x7684;&#x4E00;&#x4E2A;&#x3002;&#x5728;&#x60C5;&#x51B5;(b)&#x4E2D;&#xFF0C;&#x4E00;&#x4E2A;ftype&#x4E2D;&#x7684;&#x4E00;&#x4E2A;&#x4E4B;&#x524D;&#x7ED1;&#x5B9A;&#x7684;ftype-name&#x7684;&#x4EFB;&#x4F55;&#x5F15;&#x7528;&#x662F;&#x88AB;&#x5141;&#x8BB8;&#x7684;&#xFF0C;&#x4F46;&#x662F;&#x5F53;&#x524D;&#x7684;ftype-name&#x7684;&#x5F15;&#x7528;&#x6216;&#x8005;&#x4E4B;&#x540E;&#x7684;&#x7ED1;&#x5B9A;&#xFF0C;&#x53EA;&#x80FD;&#x4EE5;&#x6307;&#x9488;&#x57DF;&#x7684;&#x5F62;&#x5F0F;&#x51FA;&#x73B0;&#x3002;</p>
<p>&#x4F8B;&#x5982;&#xFF1A;</p>
<pre><code>(define-ftype
  [Qlist (struct
           [head int]
           [tail (* Qlist)])])
</code></pre><p>&#x5BF9;&#x4E8E;Qlist&#x7684;&#x5F15;&#x7528;&#x662F;&#x88AB;&#x5141;&#x8BB8;&#x7684;&#xFF0C;&#x56E0;&#x4E3A;&#x5B83;&#x662F;&#x4EE5;&#x6307;&#x9488;&#x57DF;&#x7684;&#x5F62;&#x5F0F;&#x51FA;&#x73B0;&#x7684;&#x3002;&#x7C7B;&#x4F3C;&#x7684;&#xFF1A;</p>
<pre><code>(define-ftype
  [Qfrob (struct
           [head int]
           [tail (* Qsnark)])]
  [Qsnark (struct
            [head int]
            [xtra Qfrob]
            [tail (* Qfrob)])])
</code></pre><p>Qsnark&#x548C;Qfrob&#x7684;&#x76F8;&#x4E92;&#x9012;&#x5F52;&#x5F15;&#x7528;&#x4E5F;&#x662F;&#x5141;&#x8BB8;&#x7684;&#x3002;&#x4F46;&#x662F;&#xFF0C;&#x5728;&#x4E0B;&#x9762;&#x7684;&#x4F8B;&#x5B50;&#x4E2D;&#xFF1A;</p>
<pre><code>(define-ftype
  [Qfrob (struct
           [head int]
           [xtra Qfrob]
           [tail (* Qsnark)])]
  [Qsnark (struct
            [head int]
            [tail (* Qfrob)])])
</code></pre><p>Qfrob ftype&#x4E2D;&#x7684;Qfrob&#x5F15;&#x7528;&#x662F;&#x65E0;&#x6548;&#x7684;&#xFF0C;&#x518D;&#x5982;&#xFF1A;</p>
<pre><code>(define-ftype
  [Qfrob (struct
           [head int]
           [xtra Qsnark]
           [tail (* Qsnark)])]
  [Qsnark (struct
            [head int]
            [tail (* Qfrob)])])
</code></pre><p>&#x7C7B;&#x4F3C;&#x5730;&#xFF0C;Qsnark&#x7684;&#x5F15;&#x7528;&#x4E5F;&#x662F;&#x65E0;&#x6548;&#x3002;</p>
<p>&#x9ED8;&#x8BA4;&#x60C5;&#x51B5;&#x4E0B;&#xFF0C;&#x4E3A;&#x4E86;&#x7EF4;&#x6301;&#x591A;&#x5B57;&#x8282;&#x6807;&#x91CF;&#x5408;&#x9002;&#x7684;&#x5BF9;&#x9F50;&#xFF0C;&#x9700;&#x8981;&#x5728;&#x5408;&#x9002;&#x7684;&#x5730;&#x65B9;&#x63D2;&#x5165;&#x586B;&#x5145;&#x5B57;&#x8282;&#xFF0C;&#x4F7F;&#x5F97;&#x4E0E;&#x76EE;&#x6807;&#x673A;&#x5668;&#x7684;C&#x7ED3;&#x6784;&#x4F53;&#x5E03;&#x5C40;&#x89C4;&#x5219;&#x76F8;&#x5BF9;&#x5E94;&#xFF0C;&#x8FD9;&#x4E9B;&#x5E03;&#x5C40;&#x5DF2;&#x88AB;&#x5145;&#x5206;&#x6587;&#x6863;&#x5316;&#x3002;&#x5BF9;&#x4E8E;packed ftypes&#xFF08;&#x5728;packed&#x5F62;&#x5F0F;&#x4E2D;&#x5C01;&#x88C5;&#x7684;ftypes&#xFF0C;&#x4E14;&#x6CA1;&#x6709;&#x5728;&#x6700;&#x8FD1;&#x7684;unpacked&#x5F62;&#x5F0F;&#x4E2D;&#x88AB;&#x5305;&#x542B;&#xFF09;&#xFF0C;&#x586B;&#x5145;&#x5B57;&#x8282;&#x4E0D;&#x63D2;&#x5165;&#x3002;(&#x8BD1;&#x8005;&#x6CE8;&#xFF1A;&#x539F;&#x6587;ftypes wrapped in a packed form with no closer enclosing upacked form)</p>
<p>&#x5185;&#x5B58;&#x4E2D;&#x5B58;&#x50A8;&#x7684;&#x591A;&#x5B57;&#x8282;&#x6807;&#x91CF;&#x503C;&#x4F7F;&#x7528;&#x76EE;&#x6807;&#x673A;&#x5668;&#x672C;&#x5730;&quot;endianness&quot;&#xFF0C;&#x6BD4;&#x5982;&#xFF0C;&#x5728;&#x57FA;&#x4E8E;X86&#x6216;&#x8005;X86_64&#x7684;&#x5E73;&#x53F0;&#x4E0A;&#x662F;little&#x7684;&#xFF0C;&#x5728;&#x57FA;&#x4E8E;Sparc&#x7684;&#x5E73;&#x53F0;&#x4E0A;&#x662F;big&#x7684;&#x3002;Big-endian&#x548C;little-endian&#x8868;&#x793A;&#x80FD;&#x591F;&#x901A;&#x8FC7;endian ftype&#x6307;&#x5B9A;big &#x6216;&#x8005; little endianness&#x6307;&#x793A;&#x7B26;&#x800C;&#x5F3A;&#x5236;&#x6539;&#x53D8;&#x3002;native&#x6307;&#x793A;&#x7B26;&#x88AB;&#x7528;&#x6765;&#x5F3A;&#x5236;&#x8FD4;&#x56DE;&#x672C;&#x5730;&#x8868;&#x793A;&#x3002;&#x6BCF;&#x4E2A;endian&#x5F62;&#x5F0F;&#x5728;&#x8BED;&#x6CD5;&#x4E0A;&#x53EA;&#x5F71;&#x54CD;&#x5D4C;&#x5957;&#x5728;&#x5176;&#x4E2D;&#x7684;ftypes&#x4E14;&#x6CA1;&#x6709;&#x5D4C;&#x5957;&#x5728;&#x6700;&#x8FD1;&#x7684;endian&#x5F62;&#x5F0F;&#x4E2D;&#x3002;(&#x8BD1;&#x8005;&#x6CE8;&#xFF1A;&#x539F;&#x6587;not nested within a closer endian form)</p>
<p>bits&#x5F62;&#x5F0F;&#x7684;ftype&#x4E2D;&#x7684;&#x5404;&#x4E2A;&#x57DF;&#x7684;&#x603B;&#x5927;&#x5C0F;n&#x5FC5;&#x987B;&#x6EE1;&#x8DB3;8&#xFF0C;16&#xFF0C;24&#xFF0C;32&#xFF0C;40&#xFF0C;48&#xFF0C;56 &#x6216; 64&#x3002;&#x5982;&#x679C;&#x9700;&#x8981;&#x5B57;&#x8282;&#x586B;&#x5145;&#x5FC5;&#x987B;&#x4EBA;&#x4E3A;&#x6DFB;&#x52A0;&#x3002;&#x5728;little-endian&#x8868;&#x793A;&#x4E0B;&#xFF0C;&#x7B2C;&#x4E00;&#x4E2A;&#x57DF;&#x5360;&#x7528;&#x4F4E;&#x4F4D;bits&#xFF0C;8&#xFF0C;16&#xFF0C;24&#xFF0C;32&#xFF0C;40&#xFF0C;48&#xFF0C;56&#xFF0C;&#x6216;64bit&#x5B57;&#xFF0C;&#x63A5;&#x4E0B;&#x6765;&#x7684;&#x57DF;&#x5728;&#x8BE5;&#x57DF;&#x4E4B;&#x4E0A;&#x3002;&#x5728;big-endian&#x8868;&#x793A;&#x65F6;&#xFF0C;&#x7B2C;&#x4E00;&#x4E2A;&#x57DF;&#x5360;&#x7528;&#x9AD8;&#x4F4D;bits&#xFF0C;&#x63A5;&#x4E0B;&#x6765;&#x7684;&#x57DF;&#x5728;&#x8BE5;&#x57DF;&#x4E4B;&#x4E0B;&#x3002;</p>
<p>&#x53EA;&#x6709;&#x5F53;&#x4E24;&#x4E2A;ftypes&#x7ED1;&#x5B9A;&#x76F8;&#x540C;&#x7684;ftype&#x65F6;&#xFF0C;&#x5B83;&#x4EEC;&#x88AB;&#x8BA4;&#x4E3A;&#x662F;&#x7B49;&#x4EF7;&#x7684;&#x3002;&#x5982;&#x679C;&#x4E24;&#x4E2A;ftype&#x7684;&#x5B9A;&#x4E49;&#x770B;&#x8D77;&#x6765;&#x662F;&#x4E00;&#x6837;&#x7684;&#xFF0C;&#x4F46;&#x662F;&#x51FA;&#x73B0;&#x5728;&#x540C;&#x4E00;&#x4E2A;&#x7A0B;&#x5E8F;&#x7684;&#x4E24;&#x4E2A;&#x90E8;&#x5206;&#xFF0C;&#x90A3;&#x8FD9;&#x4E24;&#x4E2A;ftypes&#x88AB;&#x8BA4;&#x4E3A;&#x662F;&#x4E0D;&#x540C;&#x7684;&#xFF0C;&#x5C1D;&#x8BD5;&#x901A;&#x8FC7;&#x4E0B;&#x9762;&#x4ECB;&#x7ECD;&#x7684;&#x64CD;&#x4F5C;&#x7B26;&#xFF0C;&#x4F7F;&#x7528;&#x4E00;&#x4E2A;ftype&#x7684;&#x540D;&#x5B57;&#x6765;&#x8BBF;&#x95EE;&#x53E6;&#x5916;&#x4E00;&#x4E2A;ftype&#x4F1A;&#x5BFC;&#x81F4;&#x5931;&#x8D25;&#xFF0C;&#x5E76;&#x4EA7;&#x751F;&#x8FD0;&#x884C;&#x65F6;&#x5F02;&#x5E38;&#x3002;</p>
<p>&#x6570;&#x7EC4;Array&#x7684;&#x5927;&#x5C0F;&#x5FC5;&#x987B;&#x662F;&#x5E38;&#x6570;&#x3002;&#x5982;&#x679C;&#x53EA;&#x6709;&#x5230;&#x8FD0;&#x884C;&#x65F6;&#x624D;&#x80FD;&#x786E;&#x5B9A;&#x4E00;&#x4E2A;&#x6570;&#x7EC4;&#x7684;&#x957F;&#x5EA6;&#xFF0C;&#x90A3;&#x4E48;&#x6570;&#x7EC4;&#x9700;&#x8981;&#x88AB;&#x653E;&#x5728;ftype&#x7684;&#x672B;&#x5C3E;&#xFF08;&#x548C;&#x4EFB;&#x4F55;&#x5305;&#x542B;&#x7684;ftype&#xFF09;&#xFF0C;&#x7136;&#x540E;&#x5C06;&#x5176;&#x58F0;&#x660E;&#x4E3A;0&#x5927;&#x5C0F;&#xFF0C;&#x5982;&#x4E0B;&#x4F8B;&#x6240;&#x793A;&#x3002;</p>
<pre><code>(define-ftype Vec
  (struct
    [len int]
    [data (array 0 double)]))
(define make-Vec
  (lambda (n)
    (let ([fptr (make-ftype-pointer Vec
                  (foreign-alloc
                    (+ (ftype-sizeof Vec)
                       (* (ftype-sizeof double) n))))])
      (ftype-set! Vec (len) fptr n)
      fptr)))
(define x (make-Vec 100))
(/ (- (ftype-pointer-address (ftype-&amp;ref Vec (data 10) x))
      (ftype-pointer-address x)
      (ftype-sizeof int))
   (ftype-sizeof double)) =&gt;  10
(foreign-free (ftype-pointer-address x))
</code></pre><p>(&#x8BD1;&#x8005;&#x6CE8;&#xFF1A;&#x5728;&#x7B14;&#x8005;64&#x4F4D;&#x7535;&#x8111;&#x4E2D;&#x7ED3;&#x679C;&#x4E3A;21/2&#xFF0C;&#x7531;&#x4E8E;&#x5185;&#x5B58;&#x5BF9;&#x9F50;&#x4F1A;&#x586B;&#x5145;&#x989D;&#x5916;&#x5B57;&#x8282;&#x7684;&#x539F;&#x56E0;&#x5427;&#xFF0C;&#x56E0;&#x4E3A;(ftype-sizeof Vec)&#x4E3A;8&#x5B57;&#x8282;)</p>
<p>&#x5BF9;&#x4E8E;0&#x957F;&#x5EA6;&#x6570;&#x7EC4;&#x4E0D;&#x6267;&#x884C;&#x6570;&#x7EC4;&#x8FB9;&#x754C;&#x68C0;&#x67E5;&#x3002;&#x5728;&#x4E00;&#x4E2A;&#x5916;&#x90E8;&#x5BF9;&#x8C61;&#x4E2D;&#x53EA;&#x80FD;&#x51FA;&#x73B0;&#x4E00;&#x4E2A;&#x53D8;&#x957F;&#x5EA6;&#x6570;&#x7EC4;&#xFF0C;&#x4F46;&#x662F;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;&#x5C06;&#x8BE5;&#x5BF9;&#x8C61;&#x8BA4;&#x4E3A;&#x662F;&#x591A;&#x4E2A;&#x72EC;&#x7ACB;&#x7684;&#x5BF9;&#x8C61;&#x6765;&#x7ED5;&#x8FC7;&#x8BE5;&#x95EE;&#x9898;&#x3002;&#xFF08;&#x8BD1;&#x8005;&#x6CE8;&#xFF1A;&#x539F;&#x6587;but one can work around this by treating the object as multiple individual objects&#xFF09;</p>
<p>&#x4E3A;&#x4E86;&#x907F;&#x514D;&#x5728;&#x591A;&#x4E2A;&#x4F4D;&#x7F6E;&#x5904;&#x6307;&#x5B9A;&#x4E00;&#x4E2A;&#x6570;&#x7EC4;&#x7684;&#x5E38;&#x6570;&#x957F;&#x5EA6;&#xFF0C;&#x53EF;&#x4EE5;&#x4F7F;&#x7528;&#x4E00;&#x4E2A;&#x7ED1;&#x5B9A;&#x5927;&#x5C0F;&#x7684;&#x53D8;&#x91CF;&#x548C;ftype&#x540D;&#x5B57;&#x7684;&#x5B8F;&#x3002;&#x4F8B;&#x5982;&#xFF1A;</p>
<pre><code>(define-syntax define-array
  (syntax-rules ()
    [(_ array-name type size-name size)
     (begin
       (define size-name size)
       (define-ftype array-name
         (array size type)))]))
(define-array A int A-size 100)
A-size =&gt; 100
(ftype-pointer-ftype
  (make-ftype-pointer A
    (foreign-alloc (ftype-sizeof A)))) =&gt; (array 100 int)
</code></pre><p>&#x8BE5;&#x6280;&#x672F;&#x80FD;&#x88AB;&#x7528;&#x4E8E;&#x5B9A;&#x4E49;&#x4EFB;&#x4F55;&#x542B;&#x6709;&#x4EFB;&#x610F;&#x5927;&#x5C0F;&#x7684;&#x6570;&#x7EC4;&#x57DF;&#x7684;ftypes&#x3002;</p>
<p>&#x4E00;&#x4E2A;struct ftype&#x662F;struct&#x7684;&#x7B2C;&#x4E00;&#x4E2A;&#x57DF;&#x7C7B;&#x578B;&#x7684;&#x9690;&#x5F0F;&#x5B50;&#x7C7B;&#x578B;&#x3002;&#x7C7B;&#x4F3C;&#x7684;&#xFF0C;&#x4E00;&#x4E2A;array ftype&#x662F;&#x5B83;&#x7684;&#x5143;&#x7D20;&#x7C7B;&#x578B;&#x7684;&#x9690;&#x5F0F;&#x5B50;&#x7C7B;&#x578B;&#x3002;&#x56E0;&#x6B64;&#xFF0C;struct&#x6216;&#x8005;array&#x4EE5;&#x66F4;&#x591A;&#x7684;&#x57DF;&#x6216;&#x8005;&#x5143;&#x7D20;&#x6765;&#x6269;&#x5C55;&#x7B2C;&#x4E00;&#x4E2A;&#x57DF;&#x6216;&#x8005;&#x5143;&#x7D20;&#x7684;&#x7C7B;&#x578B;&#x3002;&#x8FD9;&#x5141;&#x8BB8;struct&#x6216;&#x8005;array&#x7684;&#x5B9E;&#x4F8B;&#x88AB;&#x5F53;&#x4F5C;&#x7B2C;&#x4E00;&#x4E2A;&#x57DF;&#x6216;&#x8005;&#x5143;&#x7D20;&#x7C7B;&#x578B;&#x7684;&#x5B9E;&#x4F8B;&#xFF0C;&#x4E0D;&#x9700;&#x8981;&#x4F7F;&#x7528;ftype-&amp;ref&#x6765;&#x5206;&#x914D;&#x4E00;&#x4E2A;&#x6307;&#x5411;&#x57DF;&#x6216;&#x5143;&#x7D20;&#x7684;&#x65B0;&#x6307;&#x9488;&#x3002;</p>
<p>&#x8BED;&#x6CD5;: (ftype-sizeof ftype-name)
&#x8FD4;&#x56DE;: ftype-name&#x6807;&#x8BC6;&#x7684;ftype&#x7C7B;&#x578B;&#x7684;&#x5B57;&#x8282;&#x5927;&#x5C0F;
&#x5E93;: (chezscheme)</p>
<p>&#x5927;&#x5C0F;&#x5305;&#x542B;&#x4EFB;&#x4F55;&#x5728;&#x6807;&#x8BC6;ftype&#x4E2D;&#x76F4;&#x63A5;&#x5D4C;&#x5165;&#x7684;&#x4EFB;&#x4F55;ftype&#x7684;&#x5927;&#x5C0F;&#xFF0C;&#x4F46;&#x4E0D;&#x5305;&#x542B;&#x7531;pointer ftype&#x95F4;&#x63A5;&#x5D4C;&#x5165;&#x7684;&#x5927;&#x5C0F;&#x3002;&#x5728;&#x540E;&#x9762;&#x7684;&#x60C5;&#x51B5;&#x4E2D;&#xFF0C;pointer&#x7684;&#x5927;&#x5C0F;&#x662F;&#x88AB;&#x5305;&#x62EC;&#x7684;&#x3002;</p>
<p>ftype-name &#x5FC5;&#x987B;&#x4E0D;&#x662F;&#x4E00;&#x4E2A;function ftype&#xFF0C;&#x56E0;&#x4E3A;&#x51FD;&#x6570;&#x7684;&#x5927;&#x5C0F;&#x4E00;&#x822C;&#x4E0D;&#x80FD;&#x88AB;&#x786E;&#x5B9A;&#x3002;</p>
<pre><code>(define-ftype B
  (struct
    [b1 integer-32]
    [b2 (array 10 integer-32)]))
(ftype-sizeof B) =&gt; 44

(define-ftype C (* B))
(ftype-sizeof C) =&gt; 4  ; on 32-bit machines
(ftype-sizeof C) =&gt; 8  ; on 64-bit machines

(define-ftype BB
  (struct
    [bb1 B]
    [bb2 (* B)]))
(- (ftype-sizeof BB) (ftype-sizeof void* )) =&gt; 44
</code></pre><p>(&#x8BD1;&#x8005;&#x6CE8;&#xFF1A;(- (ftype-sizeof BB) (ftype-sizeof void* )) =&gt; 48&#xFF0C;&#x7531;&#x4E8E;&#x5B57;&#x8282;&#x5BF9;&#x9F50;&#x7684;&#x539F;&#x56E0;)</p>
<p>&#x8BED;&#x6CD5;: (make-ftype-pointer ftype-name expr)
&#x8FD4;&#x56DE;: &#x4E00;&#x4E2A;ftype-pointer&#x5BF9;&#x8C61;
&#x5E93;: (chezscheme)</p>
<p>&#x5982;&#x679C;ftype-name&#x4E0D;&#x662F;function ftype&#xFF0C;expr&#x5FC5;&#x987B;&#x662F;exact integer&#x8868;&#x793A;&#x7684;&#x5730;&#x5740;&#xFF0C;&#x5176;&#x503C;&#x5728;&#x76EE;&#x6807;&#x673A;&#x5668;&#x5408;&#x9002;&#x7684;&#x8303;&#x56F4;&#x3002;</p>
<p>&#x8BE5;&#x8FC7;&#x7A0B;&#x8FD4;&#x56DE;&#x7684;ftype-pointer&#x5BF9;&#x8C61;&#x5C01;&#x88C5;&#x4E86;&#x8BE5;&#x5730;&#x5740;&#xFF0C;&#x4EE5;ftype-name&#x4E3A;&#x5176;&#x8868;&#x793A;&#x7684;&#x7C7B;&#x578B;&#x540D;&#xFF0C;&#x901A;&#x8FC7;&#x4F7F;&#x7528;&#x4E0B;&#x9762;&#x63CF;&#x8FF0;&#x7684;&#x8FC7;&#x7A0B;&#x4F7F;&#x5F97;&#x5404;&#x79CD;&#x5F62;&#x5F0F;&#x7684;&#x68C0;&#x67E5;&#x80FD;&#x591F;&#x8FDB;&#x884C;&#x3002;</p>
<p><code>(make-ftype-pointer E #x80000000) =&gt; #&lt;ftype-pointer #x80000000&gt;</code></p>
<p>&#x5730;&#x5740;&#x901A;&#x5E38;&#x4E0D;&#x4F1A;&#x662F;&#x5982;&#x4E0A;&#x6240;&#x793A;&#x7684;&#x5E38;&#x91CF;&#x3002;&#x76F8;&#x53CD;&#xFF0C;&#x53EF;&#x80FD;&#x4F1A;&#x662F;&#x6765;&#x81EA;foreign-alloc&#x8C03;&#x7528;&#x7684;&#x8FD4;&#x56DE;&#x503C;&#xFF0C;&#x5982;&#xFF1A;</p>
<p><code>(make-ftype-pointer E (foreign-alloc (ftype-sizeof E)))</code></p>
<p>&#x4E5F;&#x53EF;&#x80FD;&#x6765;&#x81EA;Scheme&#x5916;&#x90E8;&#x7684;&#x6765;&#x6E90;&#xFF0C;&#x6BD4;&#x5982;&#x6765;&#x81EA;Scheme&#x901A;&#x8FC7;foreign-procedure&#x63A5;&#x53E3;&#x8C03;&#x7528;&#x7684;&#x4E00;&#x4E2A;C&#x8FC7;&#x7A0B;&#x3002;</p>
<p>&#x5982;&#x679C;ftype-name&#x4E3A;&#x51FD;&#x6570;&#x7C7B;&#x578B;&#xFF0C;expr&#x5FC5;&#x987B;&#x662F;&#x4E2A;&#x5730;&#x5740;&#xFF0C;procedure&#x6216;&#x8005;string&#x3002;&#x5982;&#x679C;&#x662F;&#x5730;&#x5740;&#xFF0C;&#x90A3;&#x4E48;&#x8BE5;&#x8C03;&#x7528;&#x4E0E;&#x5176;&#x4ED6;&#x4EFB;&#x4F55;&#x4F7F;&#x7528;&#x5730;&#x5740;&#x4F5C;&#x4E3A;&#x53C2;&#x6570;&#x7684;make-ftype-pointer&#x8C03;&#x7528;&#x4E00;&#x6837;&#x3002;</p>
<p>&#x5982;&#x679C;&#x662F;procedure&#xFF0C;&#x4E00;&#x4E2A;&#x9488;&#x5BF9;&#x8BE5;&#x8FC7;&#x7A0B;&#x7684;foreign-callable code&#x5BF9;&#x8C61;&#x88AB;&#x521B;&#x5EFA;&#xFF0C;&#x7C7B;&#x4F3C;&#x4E8E;&#x901A;&#x8FC7;foreign-callable&#xFF08;4.3&#x8282;&#xFF09;&#x3002;&#x5730;&#x5740;&#x88AB;&#x5C01;&#x88C5;&#x5728;&#x8FD4;&#x56DE;&#x7684;ftype-pointer&#x5BF9;&#x8C61;&#x4E2D;&#xFF0C;&#x662F;&#x8BE5;&#x8FC7;&#x7A0B;&#x7684;&#x5165;&#x53E3;&#x5730;&#x5740;&#x3002;</p>
<pre><code>(define fact
  (lambda (n)
    (if (= n 0) 1 (fact (- n 1)))))
(define-ftype fact_t (function (int) int))
(define fact-fptr (make-ftype-pointer fact_t fact))
</code></pre><p>&#x8FD4;&#x56DE;&#x7684;ftype&#x6307;&#x9488;&#x80FD;&#x88AB;&#x4F20;&#x9012;&#x7ED9;C&#x8FC7;&#x7A0B;&#xFF0C;&#x5982;&#x679C;&#x53C2;&#x6570;&#x88AB;&#x58F0;&#x660E;&#x4E3A;&#x6307;&#x5411;&#x76F8;&#x540C;ftype&#x7684;&#x6307;&#x9488;&#xFF0C;C&#x8FC7;&#x7A0B;&#x80FD;&#x50CF;&#x8C03;&#x7528;&#x5176;&#x4ED6;&#x51FD;&#x6570;&#x6307;&#x9488;&#x4E00;&#x6837;&#x8C03;&#x7528;&#x5176;&#x6536;&#x5230;&#x7684;&#x8BE5;&#x51FD;&#x6570;&#x6307;&#x9488;&#x3002;&#x56E0;&#x6B64;&#xFF0C;ftype-name&#x4E3A;function ftype&#x7684;make-ftype-pointer&#x662F;&#x4E00;&#x79CD;&#x521B;&#x5EFA;Scheme&#x8FC7;&#x7A0B;&#x7684;C&#x53EF;&#x8C03;&#x7528;&#x5C01;&#x88C5;foreign-callable&#x7684;&#x53E6;&#x5916;&#x4E00;&#x79CD;&#x65B9;&#x5F0F;&#x3002;</p>
<p>&#x56E0;&#x4E3A;&#x6240;&#x6709;&#x7684;Scheme&#x5BF9;&#x8C61;&#xFF0C;&#x5305;&#x62EC;code&#x5BF9;&#x8C61;&#xFF0C;&#x80FD;&#x591F;&#x88AB;&#x91CD;&#x65B0;&#x5B9A;&#x4F4D;&#x751A;&#x81F3;&#x88AB;&#x5783;&#x573E;&#x56DE;&#x6536;&#x5668;&#x56DE;&#x6536;&#xFF0C;&#x6240;&#x4EE5;&#x5728;&#x5D4C;&#x5165;ftype&#x6307;&#x9488;&#x524D;foreign-callable code&#x5BF9;&#x8C61;&#x88AB;&#x81EA;&#x52A8;&#x9501;&#x5B9A;&#xFF0C;&#x5C31;&#x50CF;&#x901A;&#x8FC7;lock-object&#x3002;code&#x5BF9;&#x8C61;&#x5E94;&#x8BE5;&#x5728;C&#x4E2D;&#x4F7F;&#x7528;&#x540E;&#x88AB;&#x89E3;&#x9501;&#x5B9A;&#x3002;&#x56E0;&#x4E3A;&#x9501;&#x5B9A;&#x5BF9;&#x8C61;&#x5360;&#x7528;&#x7A7A;&#x95F4;&#xFF0C;&#x5BFC;&#x81F4;&#x5185;&#x5B58;&#x788E;&#x7247;&#xFF0C;&#x589E;&#x52A0;&#x56DE;&#x6536;&#x4EE3;&#x4EF7;&#x3002;&#x7531;&#x4E8E;&#x7CFB;&#x7EDF;&#x81EA;&#x52A8;&#x786E;&#x5B9A;&#x4F55;&#x65F6;&#x662F;&#x6700;&#x540E;&#x4E00;&#x6B21;C&#x4E2D;&#x7684;&#x4F7F;&#x7528;&#xFF0C;&#x7A0B;&#x5E8F;&#x5FC5;&#x987B;&#x663E;&#x793A;&#x89E3;&#x9501;code&#x5BF9;&#x8C61;&#xFF0C;&#x901A;&#x8FC7;&#x4ECE;ftype-pointer&#x4E2D;&#x63D0;&#x53D6;&#x5730;&#x5740;&#xFF0C;&#x5C06;&#x5730;&#x5740;&#x8F6C;&#x6362;&#x56DE;code&#x5BF9;&#x8C61;&#xFF0C;&#x4F20;&#x5165;unlock-object&#xFF1A;</p>
<pre><code>(unlock-object
  (foreign-callable-code-object
    (ftype-pointer-address fact-fptr)))
</code></pre><p>&#x4E00;&#x65E6;&#x89E3;&#x9501;&#xFF0C;ftype pointer&#x4E0D;&#x80FD;&#x518D;&#x88AB;&#x4F7F;&#x7528;&#xFF0C;&#x9664;&#x975E;&#x518D;&#x6B21;&#x88AB;&#x9501;&#x5B9A;&#xFF0C;&#x4F8B;&#x5982;&#x901A;&#x8FC7;&#xFF1A;</p>
<pre><code>(lock-object
  (foreign-callable-code-object
    (ftype-pointer-address fact-fptr)))
</code></pre><p>&#x7A0B;&#x5E8F;&#x80FD;&#x901A;&#x8FC7;lock-object?&#x5224;&#x65AD;&#x6765;&#x786E;&#x5B9A;&#x4E00;&#x4E2A;&#x5BF9;&#x8C61;&#x662F;&#x5426;&#x5DF2;&#x7ECF;&#x88AB;&#x9501;&#x5B9A;&#x3002;</p>
<p>function ftype &#x4E5F;&#x80FD;&#x5728;make-ftype-pointer&#x4E2D;&#x88AB;&#x7528;&#x4E8E;&#x521B;&#x5EFA;&#x4E00;&#x4E2A;C&#x51FD;&#x6570;&#x7684;ftype-pointer&#xFF0C;&#x65E0;&#x8BBA;&#x662F;&#x63D0;&#x4F9B;C&#x51FD;&#x6570;&#x7684;&#x5730;&#x5740;&#x6216;&#x8005;&#x5B83;&#x7684;&#x540D;&#x5B57;&#xFF0C;&#x4EE5;string&#x8868;&#x793A;&#x3002;&#x4F8B;&#x5982;&#x4F7F;&#x7528;&#x5982;&#x4E0B;bvcopy_t&#x7684;&#x5B9A;&#x4E49;&#xFF1A;</p>
<p><code>(define-ftype bvcopy_t (function (u8* u8* size_t) void))</code></p>
<p>&#x4E0B;&#x9762;&#x4E24;&#x79CD;&#x5B9A;&#x4E49;&#x65B9;&#x5F0F;&#x662F;&#x7B49;&#x6548;&#x7684;&#x3002;</p>
<pre><code>(define bvcopy-fptr (make-ftype-pointer bvcopy_t &quot;memcpy&quot;))
(define bvcopy-fptr (make-ftype-pointer bvcopy_t (foreign-entry &quot;memcpy&quot;)))
</code></pre><p>&#x5305;&#x542B;memcpy&#x7684;&#x5E93;&#x5FC5;&#x987B;&#x9996;&#x5148;&#x901A;&#x8FC7;load-shared-object&#x52A0;&#x8F7D;&#xFF0C;&#x6216;&#x8005;memcpy&#x5FC5;&#x987B;&#x901A;&#x8FC7;4.6&#x8282;&#x4E2D;&#x63CF;&#x8FF0;&#x7684;&#x5176;&#x4E2D;&#x4E00;&#x79CD;&#x65B9;&#x6CD5;&#x6CE8;&#x518C;&#x3002;</p>
<p>&#x8BED;&#x6CD5;: (ftype-pointer? obj)
&#x8FD4;&#x56DE;: &#x5982;&#x679C;obj&#x662F;ftype pointer&#x8FD4;&#x56DE;#t&#xFF0C;&#x5426;&#x5219;&#x8FD4;&#x56DE;#f
&#x8BED;&#x6CD5;: (ftype-pointer? ftype-name obj)
&#x8FD4;&#x56DE;: &#x5982;&#x679C;obj&#x662F;ftype-name&#x7C7B;&#x578B;&#x5219;&#x8FD4;&#x56DE;#t&#xFF0C;&#x5426;&#x5219;&#x8FD4;&#x56DE;#f
&#x5E93;: (chezscheme)</p>
<pre><code>(define-ftype Widget1 (struct [x int] [y int]))
(define-ftype Widget2 (struct [w Widget1] [b boolean]))

(define x1 (make-ftype-pointer Widget1 #x80000000))
(define x2 (make-ftype-pointer Widget2 #x80000000))

(ftype-pointer? x1) =&gt; #t
(ftype-pointer? x2) =&gt; #t

(ftype-pointer? Widget1 x1) =&gt; #t
(ftype-pointer? Widget1 x2) =&gt; #t

(ftype-pointer? Widget2 x1) =&gt; #f
(ftype-pointer? Widget2 x2) =&gt; #t

(ftype-pointer? #x80000000) =&gt; #f
(ftype-pointer? Widget1 #x80000000) =&gt; #f
</code></pre><p>&#x8FC7;&#x7A0B;: (ftype-pointer-address fptr)
&#x8FD4;&#x56DE;: &#x8FD4;&#x56DE;fptr&#x4E2D;&#x5C01;&#x88C5;&#x7684;&#x5730;&#x4E2D;
&#x5E93;: (chezscheme)</p>
<p>fptr&#x5FC5;&#x987B;&#x662F;&#x4E00;&#x4E2A;ftype-pointer&#x5BF9;&#x8C61;&#x3002;</p>
<pre><code>(define x (make-ftype-pointer E #x80000000))
(ftype-pointer-address x) =&gt; #x80000000 (&#x8BD1;&#x8005;&#x6CE8;&#xFF1A;&#x4E00;&#x822C;&#x8F93;&#x51FA;&#x4E3A;&#x5341;&#x8FDB;&#x5236;&#x6570;&#xFF0C;&#x8FD9;&#x91CC;&#x53EF;&#x80FD;&#x662F;&#x4E3A;&#x4E86;&#x8868;&#x8FF0;&#x66F4;&#x6E05;&#x695A;)
</code></pre><p>&#x8BED;&#x6CD5;: (ftype-pointer=? fptr1 fptr2)
&#x8FD4;&#x56DE;: &#x5982;&#x679C;ftpr1&#x548C;fptr2&#x6709;&#x76F8;&#x540C;&#x7684;&#x5730;&#x5740;&#x8FD4;&#x56DE;#t&#xFF0C;&#x5426;&#x5219;&#x8FD4;&#x56DE;#f
&#x5E93;: (chezscheme)</p>
<p>fptr1&#x548C;fptr2&#x5FC5;&#x987B;&#x662F;ftype-pointer&#x5BF9;&#x8C61;&#x3002;</p>
<p>ftype-pointer=? &#x53EF;&#x80FD;&#x88AB;&#x5B9A;&#x4E49;&#x4E3A;&#xFF1A;</p>
<pre><code>(define ftype-pointer=?
  (lambda (fptr1 fptr2)
    (= (ftype-pointer-address fptr1) (ftype-pointer-address fptr2))))
</code></pre><p>&#x4FDD;&#x8BC1;&#x4E0D;&#x8981;&#x4E3A;&#x5730;&#x5740;&#x5206;&#x914D;bignums&#x7C7B;&#x578B;&#xFF0C;&#x5373;&#x4F7F;&#x5730;&#x5740;&#x4E0D;&#x80FD;&#x5728;fixnum&#x8303;&#x56F4;&#x5185;&#x8868;&#x793A;&#x3002;</p>
<p>&#x8BED;&#x6CD5;: (ftype-pointer-null? fptr)
&#x8FD4;&#x56DE;: &#x5982;&#x679C;fptr&#x7684;&#x5730;&#x5740;&#x4E3A;0&#x8FD4;&#x56DE;#t&#xFF0C;&#x5426;&#x5219;&#x8FD4;&#x56DE;#f
&#x5E93;: (chezscheme)</p>
<p>fptr&#x5FC5;&#x987B;&#x662F;&#x4E00;&#x4E2A;ftype-pointer&#x5BF9;&#x8C61;&#x3002;</p>
<p>ftype-pointer-null?&#x53EF;&#x80FD;&#x88AB;&#x5B9A;&#x4E49;&#x4E3A;&#xFF1A;</p>
<pre><code>(define ftype-pointer-null?
  (lambda (fptr)
    (= (ftype-pointer-address fptr) 0)))
</code></pre><p>&#x4FDD;&#x8BC1;&#x4E0D;&#x8981;&#x4E3A;&#x5730;&#x5740;&#x5206;&#x914D;bignums&#x7C7B;&#x578B;&#xFF0C;&#x5373;&#x4F7F;&#x5730;&#x5740;&#x4E0D;&#x80FD;&#x5728;fixnum&#x8303;&#x56F4;&#x5185;&#x8868;&#x793A;&#x3002;</p>
<p>&#x8BED;&#x6CD5;: (ftype-&amp;ref ftype-name (a ...) fptr-expr)
&#x8BED;&#x6CD5;: (ftype-&amp;ref ftype-name (a ...) fptr-expr index)
&#x8FD4;&#x56DE;: &#x4E00;&#x4E2A;ftype-pointer&#x5BF9;&#x8C61;
&#x5E93;: (chezscheme)</p>
<p>&#x7531;ftype-&amp;ref&#x8FD4;&#x56DE;&#x7684;ftype-pointer&#x5BF9;&#x8C61;&#x5C01;&#x88C5;&#x5916;&#x90E8;&#x5BF9;&#x8C61;&#x4E2D;&#x76F4;&#x63A5;&#x6216;&#x95F4;&#x63A5;&#x5D4C;&#x5165;&#x5BF9;&#x8C61;&#x7684;&#x5730;&#x5740;&#xFF0C;&#x7531;fptr-expr&#x7684;&#x503C;&#x6240;&#x6307;&#x5411;&#xFF0C;&#x5982;&#x679C;index&#x5B58;&#x5728;&#xFF0C;index&#x4E3A;&#x504F;&#x79FB;&#x3002;fptr-expr&#x7684;&#x503C;&#x5FC5;&#x987B;&#x662F;ftype-name&#x7C7B;&#x578B;&#x7684;&#x4E00;&#x4E2A;ftype&#x6307;&#x9488;(fptr)&#xFF0C;index&#x5FC5;&#x987B;&#x662F; <em> &#x6216;&#x8005;&#x662F;fixnum&#xFF0C;&#x53EF;&#x80FD;&#x662F;&#x8D1F;&#x7684;&#x3002;index&#x503C;&#x4F1A;&#x88AB;&#x81EA;&#x52A8;&#x4E58;&#x4EE5;ftype-name&#x7C7B;&#x578B;&#x7684;ftype&#x5927;&#x5C0F;&#xFF0C;&#x5141;&#x8BB8;fptr&#x88AB;&#x8BA4;&#x4E3A;&#x662F;ftype-name&#x5BF9;&#x8C61;&#x7684;&#x6570;&#x7EC4;&#xFF0C;index&#x4F5C;&#x4E3A;&#x8BE5;&#x6570;&#x7EC4;&#x7684;&#x7D22;&#x5F15;&#x3002;index&#x4E3A; </em> &#x6216;&#x8005;0 &#x4E0E;&#x6CA1;&#x6709;&#x6307;&#x5B9A;index&#x662F;&#x76F8;&#x540C;&#x7684;&#x3002;</p>
<p>&#x8BBF;&#x95EE;&#x5668;&#x5E8F;&#x5217;a...&#x5FC5;&#x987B;&#x6307;&#x5B9A;&#x901A;&#x8FC7;&#x6807;&#x8BC6;&#x7B26;ftype&#x7684;&#x6709;&#x6548;&#x8DEF;&#x5F84;&#x3002;&#x5BF9;&#x4E8E;struct&#xFF0C;union&#xFF0C;bits ftypes&#xFF0C;&#x8BBF;&#x95EE;&#x5668;&#x5FC5;&#x987B;&#x662F;&#x6709;&#x6548;&#x7684;ftype&#x57DF;&#x540D;&#xFF0C;&#x5BF9;&#x4E8E;pointer&#x548C;array ftypes&#xFF0C;&#x8BBF;&#x95EE;&#x5668;&#x5FC5;&#x987B;&#x662F; * &#x6216;&#x8005;fixnum&#x7D22;&#x5F15;&#x3002;&#x5BF9;&#x4E8E;array ftypes&#xFF0C;&#x7D22;&#x5F15;&#x5FC5;&#x987B;&#x662F;&#x975E;&#x8D1F;&#x7684;&#xFF0C;&#x5BF9;&#x4E8E;0&#x957F;&#x5EA6;&#x7684;array ftypes&#xFF0C;&#x7D22;&#x5F15;&#x5FC5;&#x987B;&#x5C0F;&#x4E8E;&#x5176;&#x957F;&#x5EA6;&#x3002;</p>
<p>&#x4EE5;&#x4E0B;&#x4F8B;&#x5B50;&#x4E2D;&#x5047;&#x8BBE;B&#x548C;BB&#x7684;&#x5B9A;&#x4E49;&#x4E3A;&#x4E0A;&#x9762;ftype-sizeof&#x63CF;&#x8FF0;&#x4E2D;&#x7684;&#x5B9A;&#x4E49;&#x3002;&#x56FA;&#x5B9A;&#x5730;&#x5740;&#x53EA;&#x8D77;&#x5230;&#x8BF4;&#x660E;&#x7684;&#x4F5C;&#x7528;&#xFF0C;&#x5176;&#x88AB;&#x5047;&#x8BBE;&#x4E3A;&#x6709;&#x6548;&#x7684;&#xFF0C;&#x5C3D;&#x7BA1;&#x5730;&#x5740;&#x662F;&#x5728;&#x8FD0;&#x884C;&#x65F6;&#x901A;&#x8FC7;foreign-alloc&#x6216;&#x8005;&#x5176;&#x4ED6;&#x7684;&#x673A;&#x5236;&#x5B9A;&#x4E49;&#x7684;&#x3002;</p>
<pre><code>(define x (make-ftype-pointer B #x80000000))
(ftype-&amp;ref B () x)                   =&gt; #&lt;ftype-pointer #x80000000&gt;
(let ([idx 1])                        =&gt; #&lt;ftype-pointer #x8000002C&gt;
  (ftype-&amp;ref B () x idx))
(let ([idx -1])                       =&gt; #&lt;ftype-pointer #x7FFFFFD4&gt;
  (ftype-&amp;ref B () x idx))
(ftype-&amp;ref B (b1) x)                 =&gt; #&lt;ftype-pointer #x80000000&gt;
(ftype-&amp;ref B (b2) x)                 =&gt; #&lt;ftype-pointer #x80000004&gt;
(ftype-&amp;ref B (b2 5) x)               =&gt; #&lt;ftype-pointer #x80000018&gt;
(let ([n 5]) (ftype-&amp;ref B (b2 n) x)) =&gt; #&lt;ftype-pointer #x80000018&gt;

(ftype-&amp;ref B (b1 b2) x) =&gt; syntax error
(ftype-&amp;ref B (b2 15) x) =&gt; run-time exception

(define y (make-ftype-pointer BB #x90000000))
(ftype-set! BB (bb2) y x)
(ftype-&amp;ref BB (bb1 b2) y)           =&gt; #&lt;ftype-pointer #x90000004&gt;
(ftype-&amp;ref BB (bb2 * b2) y)         =&gt; #&lt;ftype-pointer #x80000004&gt;
(let ([idx 1])                       =&gt; #&lt;ftype-pointer #x80000030&gt;
  (ftype-&amp;ref BB (bb2 idx b2) y))
</code></pre><p>&#x6CA1;&#x6709;&#x8BBF;&#x95EE;&#x5668;&#x6216;&#x8005;index&#xFF0C;&#x90A3;&#x4E48;&#x8FD4;&#x56DE;&#x7684;ftype-pointer&#x53EF;&#x80FD;&#x4E0E;&#x8F93;&#x5165;&#x76F8;&#x7B49;&#xFF0C;&#x5982;&#x5728;&#x4E0A;&#x9762;&#x7B2C;&#x4E00;&#x4E2A;&#x4F7F;&#x7528;ftype-&amp;ref&#x7684;&#x4F8B;&#x5B50;&#x4E2D;&#x3002;&#x5426;&#x5219;&#xFF0C;ftype-pointer&#x662F;&#x88AB;&#x65B0;&#x5206;&#x914D;&#x51FA;&#x6765;&#x7684;&#x3002;</p>
<p>&#x8BED;&#x6CD5;: (ftype-set! ftype-name (a ...) fptr-expr val-expr)
&#x8BED;&#x6CD5;: (ftype-set! ftype-name (a ...) fptr-expr index val-expr)
&#x8FD4;&#x56DE;: &#x672A;&#x6307;&#x5B9A;
&#x8BED;&#x6CD5;: (ftype-ref ftype-name (a ...) fptr-expr)
&#x8BED;&#x6CD5;: (ftype-ref ftype-name (a ...) fptr-expr index)
&#x8FD4;&#x56DE;: an ftype-pointer object
&#x5E93;: (chezscheme)</p>
<p>&#x8FD9;&#x4E9B;&#x5F62;&#x5F0F;&#x7528;&#x4E8E;&#x5411;fptr-expr&#x7684;&#x503C;&#x6240;&#x6307;&#x7684;&#x5BF9;&#x8C61;&#x4E2D;&#x5B58;&#x50A8;&#x6570;&#x636E;&#x6216;&#x8005;&#x4ECE;&#x8BE5;&#x5BF9;&#x8C61;&#x4E2D;&#x83B7;&#x53D6;&#x6570;&#x636E;&#xFF0C;&#x5982;&#x679C;&#x5B58;&#x5728;index&#xFF0C;index&#x4E3A;&#x504F;&#x79FB;&#x91CF;&#x3002;fptr-expr&#x7684;&#x503C;&#x5FC5;&#x987B;&#x662F;&#x4E00;&#x4E2A;ftype-name&#x7C7B;&#x578B;&#x7684;ftype&#x6307;&#x9488;(fptr)&#xFF0C;index&#x5FC5;&#x987B;&#x662F; <em> &#x6216;&#x8005;fixnum&#xFF0C;&#x53EF;&#x80FD;&#x4E3A;&#x8D1F;&#x3002;index&#x88AB;&#x81EA;&#x52A8;&#x4E58;&#x4EE5;ftype-name&#x7C7B;&#x578B;&#x7684;ftype&#x7684;&#x5927;&#x5C0F;&#xFF0C;&#x5141;&#x8BB8;&#x628A;fptr&#x5F53;&#x4F5C;ftype-name&#x5BF9;&#x8C61;&#x7684;&#x6570;&#x7EC4;&#xFF0C;index&#x662F;&#x6570;&#x7EC4;&#x7684;&#x7D22;&#x5F15;&#x3002; </em> &#x6216;0&#x5F53;&#x4F5C;index&#x65F6;&#x4E0E;&#x6CA1;&#x6709;index&#x662F;&#x76F8;&#x540C;&#x7684;&#x3002;</p>
<p>&#x8BBF;&#x95EE;&#x5668;&#x5E8F;&#x5217;a...&#x5FC5;&#x987B;&#x6307;&#x5B9A;&#x901A;&#x8FC7;&#x6807;&#x8BC6;&#x7B26;ftype&#x7684;&#x6709;&#x6548;&#x8DEF;&#x5F84;&#x3002;&#x5BF9;&#x4E8E;struct&#xFF0C;union&#xFF0C;bits ftypes&#xFF0C;&#x8BBF;&#x95EE;&#x5668;&#x5FC5;&#x987B;&#x662F;&#x6709;&#x6548;&#x7684;ftype&#x57DF;&#x540D;&#xFF0C;&#x5BF9;&#x4E8E;pointer&#x548C;array ftypes&#xFF0C;&#x8BBF;&#x95EE;&#x5668;&#x5FC5;&#x987B;&#x662F; * &#x6216;&#x8005;fixnum&#x7D22;&#x5F15;&#x3002;&#x5BF9;&#x4E8E;array ftypes&#xFF0C;&#x7D22;&#x5F15;&#x5FC5;&#x987B;&#x662F;&#x975E;&#x8D1F;&#x7684;&#xFF0C;&#x5BF9;&#x4E8E;0&#x957F;&#x5EA6;&#x7684;array ftypes&#xFF0C;&#x7D22;&#x5F15;&#x5FC5;&#x987B;&#x5C0F;&#x4E8E;&#x5176;&#x957F;&#x5EA6;&#x3002;&#x7531;&#x8BBF;&#x95EE;&#x5668;&#x5E8F;&#x5217;&#x6307;&#x5B9A;&#x7684;&#x57DF;&#x6216;&#x8005;&#x5143;&#x7D20;&#x5FC5;&#x987B;&#x662F;&#x6807;&#x91CF;&#x57DF;&#xFF0C;&#x4F8B;&#x5982;&#xFF0C;&#x6307;&#x9488;&#x57DF;&#x6216;&#x8005;&#x5305;&#x542B;&#x57FA;&#x672C;&#x7C7B;&#x7684;&#x57DF;&#xFF0C;&#x5982;int, char, double&#x3002;</p>
<p>&#x5BF9;&#x4E8E;ftype-set!&#xFF0C;val-expr&#x5FC5;&#x987B;&#x662F;&#x5BF9;&#x4E8E;&#x6307;&#x5B9A;&#x57DF;&#x7684;&#x5408;&#x9002;&#x7C7B;&#x578B;&#x7684;&#x503C;&#xFF0C;&#x5373;&#x4E00;&#x4E2A;&#x5408;&#x9002;&#x7C7B;&#x578B;&#x7684;ftype pointer&#x6216;&#x4E00;&#x4E2A;&#x5408;&#x9002;&#x7684;&#x57FA;&#x7840;&#x7C7B;&#x578B;&#x503C;&#x3002;</p>
<p>&#x5BF9;&#x4E8E;signed&#x548C;unsigned integer&#x57DF;&#xFF0C;&#x53EF;&#x63A5;&#x53D7;-2<sup>w-1</sup>&#x5230;2<sup>w</sup>-1&#x8303;&#x56F4;&#x7684;&#x503C;&#xFF0C;&#x5176;&#x4E2D;w&#x662F;integer&#x57DF;&#x7684;&#x4F4D;&#x5BBD;&#x3002;&#x5BF9;&#x4E8E;signed integer&#x57DF;&#xFF0C;&#x5BF9;&#x4E8E;2<sup>w-1</sup>&#x5230;2<sup>w</sup>-1&#x8303;&#x56F4;&#x7684;&#x503C;&#x88AB;&#x8BA4;&#x4E3A;&#x662F;&#x8D1F;&#x6570;&#x7684;&#x4E92;&#x8865;&#x8868;&#x793A;&#x3002;&#x5BF9;&#x4E8E;unsigned integer&#x57DF;&#xFF0C;&#x540C;&#x6837;&#x5730;&#xFF0C;&#x5BF9;&#x4E8E;-2<sup>w-1</sup>&#x5230;-1&#x8303;&#x56F4;&#x7684;&#x503C;&#x88AB;&#x8BA4;&#x4E3A;&#x662F;&#x6B63;&#x6570;&#x7684;&#x4E92;&#x8865;&#x8868;&#x793A;&#x3002;</p>
<p>char&#x548C;wchar_t(wchar)&#x57DF;&#x7684;&#x503C;&#x7531;Scheme&#x5B57;&#x7B26;&#x8F6C;&#x6362;&#x5F97;&#x5230;(ftype-set!)&#x6216;&#x8005;&#x88AB;&#x8F6C;&#x6362;&#x6210;Scheme&#x5B57;&#x7B26;(ftype-ref)&#xFF0C;&#x5C31;&#x50CF;&#x4F7F;&#x7528;char-&gt;integer&#x6216;integer-&gt;char&#x3002;&#x901A;&#x8FC7;ftype-set!&#x88AB;&#x4FDD;&#x5B58;&#x5230;char&#x57DF;&#x7684;&#x5B57;&#x7B26;&#x5FC5;&#x987B;&#x6709;&#x5728;0 ~ 255&#x8303;&#x56F4;&#x7684;Unicode&#x6807;&#x91CF;&#x503C;&#x3002;&#x5728;Windows&#x548C;&#x4EFB;&#x4F55;wchar_t(wchar)&#x8868;&#x793A;&#x4E3A;16bit&#x503C;&#x7684;&#x5176;&#x4ED6;&#x7CFB;&#x7EDF;&#x4E2D;&#xFF0C;&#x901A;&#x8FC7;ftype-set!&#x88AB;&#x4FDD;&#x5B58;&#x5230;wchar_t(wchar)&#x57DF;&#x7684;&#x5B57;&#x7B26;&#x5FC5;&#x987B;&#x662F;0 ~ 2<sup>16</sup>-1&#x8303;&#x56F4;&#x5185;&#x7684;Unicode&#x6807;&#x91CF;&#x503C;&#x3002;&#x5728;&#x90A3;&#x4E9B;wchar_t&#x8868;&#x793A;32bit&#x503C;&#x5F97;&#x7CFB;&#x7EDF;&#x4E0A;&#xFF0C;&#x4EFB;&#x4F55;&#x5B57;&#x7B26;&#x80FD;&#x591F;&#x88AB;&#x4FDD;&#x5B58;&#x5230;wchar_t(wchar)&#x57DF;&#x3002;</p>
<p>&#x5982;&#x4E0B;&#x793A;&#x4F8B;&#x4E2D;&#x5047;&#x8BBE; B &#x548C; C &#x5DF2;&#x7ECF;&#x5728;&#x4E0A;&#x9762;&#x7684;ftype-sizeof&#x63CF;&#x8FF0;&#x4E2D;&#x5B9A;&#x4E49;&#x3002;</p>
<pre><code>(define b
  (make-ftype-pointer B
    (foreign-alloc
      (* (ftype-sizeof B) 3))))
(define c
  (make-ftype-pointer C
    (foreign-alloc (ftype-sizeof C))))

(ftype-set! B (b1) b 5)
(ftype-set! B (b1) b 1 6)
(ftype-set! B (b1) c 5)     =&gt; exception: ftype mismatch
(ftype-set! B (b2) b 0)     =&gt; exception: not a scalar
(ftype-set! B (b2 -1) b 0)  =&gt; exception: invalid index
(ftype-set! B (b2 0) b 50)
(ftype-set! B (b2 4) b 55)
(ftype-set! B (b2 10) b 55) =&gt; exception: invalid index

(ftype-set! C () c (ftype-&amp;ref B () b 1))

(= (ftype-pointer-address (ftype-ref C () c))      =&gt; #t
   (+ (ftype-pointer-address b) (ftype-sizeof B)))
(= (ftype-pointer-address (ftype-&amp;ref C (*) c))    =&gt; #t
   (+ (ftype-pointer-address b) (ftype-sizeof B)))
(= (ftype-pointer-address (ftype-&amp;ref C (-1) c))   =&gt; #t
   (ftype-pointer-address b))

(ftype-ref C (-1 b1) c)                     =&gt; 5
(ftype-ref C (* b1) c)                      =&gt; 6
(ftype-ref C (-1 b2 0) c)                   =&gt; 50
(let ([i 4]) (ftype-ref C (-1 b2 i) c))     =&gt; 55

(ftype-set! C (-1 b2 0) c 75)
(ftype-ref B (b2 0) b)                      =&gt; 75
(foreign-free (ftype-pointer-address c))
(foreign-free (ftype-pointer-address b))
</code></pre><p>&#x901A;&#x8FC7;ftype-ref&#xFF0C;function ftype&#x6307;&#x9488;&#x80FD;&#x591F;&#x88AB;&#x8F6C;&#x6362;&#x4E3A;Scheme&#x53EF;&#x8C03;&#x7528;&#x7684;&#x8FC7;&#x7A0B;&#x3002;&#x5047;&#x8BBE;&#x4E00;&#x4E2A;&#x5B9A;&#x4E49;&#x4E86;memcpy&#x7684;&#x5E93;&#x901A;&#x8FC7;load-shared-object&#x88AB;&#x52A0;&#x8F7D;&#x6216;&#x8005;memcpy&#x901A;&#x8FC7;4.6&#x8282;&#x4E2D;&#x63CF;&#x8FF0;&#x7684;&#x4E00;&#x79CD;&#x65B9;&#x6CD5;&#x88AB;&#x6CE8;&#x518C;&#xFF0C;Scheme&#x80FD;&#x8C03;&#x7528;&#x7684;memcpy&#x53EF;&#x88AB;&#x5982;&#x4E0B;&#x65B9;&#x5F0F;&#x5B9A;&#x4E49;&#x3002;</p>
<pre><code>(define-ftype bvcopy_t (function (u8* u8* size_t) void))
(define bvcopy-fptr (make-ftype-pointer bvcopy_t &quot;memcpy&quot;))
(define bvcopy (ftype-ref bvcopy_t () bvcopy-fptr))

(define bv1 (make-bytevector 8 0))
(define bv2 (make-bytevector 8 57))
bv1 =&gt; #vu8(0 0 0 0 0 0 0 0)
bv2 =&gt; #vu8(57 57 57 57 57 57 57 57)
(bvcopy bv1 bv2 5)
bv1 =&gt; #vu8(57 57 57 57 57 0 0 0)
</code></pre><p>&#x4E00;&#x4E2A;ftype pointer&#x4E5F;&#x53EF;&#x4EE5;&#x4F5C;&#x4E3A;C&#x51FD;&#x6570;&#x7684;&#x8FD4;&#x56DE;&#x503C;&#xFF0C;&#x8BE5;C&#x51FD;&#x6570;&#x88AB;&#x58F0;&#x660E;&#x4E3A;&#x8FD4;&#x56DE;&#x4E00;&#x4E2A;&#x6307;&#x5411;function ftype&#x7684;&#x6307;&#x9488;&#x3002;</p>
<p>&#x56E0;&#x6B64;&#xFF0C;ftype-ref&#x7528;&#x5728;&#x4E00;&#x4E2A;function ftype&#x4E0A;&#xFF0C;&#x662F;&#x4E00;&#x79CD;foreign-procedure&#xFF08;4.2&#x8282;&#xFF09;&#x7684;&#x66FF;&#x4EE3;&#x65B9;&#x5F0F;&#xFF0C;&#x7528;&#x4E8E;&#x521B;&#x5EFA;C&#x51FD;&#x6570;&#x7684;Scheme&#x53EF;&#x8C03;&#x7528;&#x5C01;&#x88C5;&#x3002;</p>
<p>&#x8FC7;&#x7A0B;: (ftype-pointer-ftype fptr)
&#x8FD4;&#x56DE;: fptr&#x7684;ftype, &#x8868;&#x793A;&#x4E3A;&#x4E00;&#x4E2A;s-expression
libraries: (chezscheme)</p>
<p>fptr&#x5FC5;&#x987B;&#x662F;&#x4E00;&#x4E2A;ftype-pointer&#x5BF9;&#x8C61;&#x3002;</p>
<pre><code>(define-ftype Q0
  (struct
    [x int]
    [y int]))
(define-ftype Q1
  (struct
    [x double]
    [y char]
    [z (endian big
         (bits
           [_ unsigned 3]
           [a unsigned 9]
           [b unsigned 4]))]
    [w (* Q0)]))
(define q1 (make-ftype-pointer Q1 0))
(ftype-pointer-ftype q1) =&gt; (struct
                            [x double]
                            [y char]
                            [z (endian big
                                 (bits
                                   [_ unsigned 3]
                                   [a unsigned 9]
                                   [b unsigned 4]))]
                            [w (* Q0)])
</code></pre><p>&#x8FC7;&#x7A0B;: (ftype-pointer-&gt;sexpr fptr)
&#x8FD4;&#x56DE;: fptr&#x6240;&#x6307;&#x5411;&#x7684;&#x5BF9;&#x8C61;&#x7684;s-expression&#x8868;&#x793A;
&#x5E93;: (chezscheme)</p>
<p>fptr&#x5FC5;&#x987B;&#x662F;&#x4E00;&#x4E2A;ftype-pointer&#x5BF9;&#x8C61;&#x3002;</p>
<p>&#x5BF9;&#x4E8E;&#x6BCF;&#x4E2A;&#x672A;&#x547D;&#x540D;&#x57DF;&#xFF0C;&#x5982;&#x5176;&#x57DF;&#x540D;&#x4E3A;&#x4E0B;&#x5212;&#x7EBF;&#x7684;&#x57DF;&#xFF0C;&#x8FD4;&#x56DE;&#x7684;s-expression&#x4E2D;&#x5176;&#x5BF9;&#x5E94;&#x57DF;&#x503C;&#x4E5F;&#x662F;&#x4E0B;&#x5212;&#x7EBF;&#x3002;&#x7C7B;&#x4F3C;&#x7684;&#xFF0C;&#x5982;&#x679C;&#x57DF;&#x662F;&#x4E0D;&#x53EF;&#x8BBF;&#x95EE;&#x7684;&#xFF0C;&#x4F8B;&#x5982;&#x5176;&#x5730;&#x5740;&#x662F;&#x65E0;&#x6548;&#x7684;&#xFF0C;&#x90A3;&#x4E48;&#x503C;&#x662F;&#x4E00;&#x4E2A;&#x65E0;&#x6548;&#x7684;&#x7B26;&#x53F7;&#x3002;</p>
<pre><code>(define-ftype Frob
  (struct
    [p boolean]
    [q char]))
(define-ftype Snurk
  (struct
    [a Frob]
    [b (* Frob)]
    [c (* Frob)]
    [d (bits
         [_ unsigned 15]
         [dx signed 17])]
    [e (array 5 double)]))
(define x
  (make-ftype-pointer Snurk
    (foreign-alloc (ftype-sizeof Snurk))))
(ftype-set! Snurk (b) x
  (make-ftype-pointer Frob
    (foreign-alloc (ftype-sizeof Frob))))
(ftype-set! Snurk (c) x
  (make-ftype-pointer Frob 0))
(ftype-set! Snurk (a p) x #t)
(ftype-set! Snurk (a q) x #\A)
(ftype-set! Snurk (b * p) x #f)
(ftype-set! Snurk (b * q) x #\B)
(ftype-set! Snurk (d dx) x -2500)
(do ([i 0 (fx+ i 1)])
    ((fx= i 5))
  (ftype-set! Snurk (e i) x (+ (* i 5.0) 3.0)))
(ftype-pointer-&gt;sexpr x) =&gt; (struct
                            [a (struct [p #t] [q #\A])]
                            [b (* (struct [p #f] [q #\B]))]
                            [c (* (struct [p invalid] [q invalid]))]
                            [d (bits [_ _] [dx -2500])]
                            [e (array 5 3.0 8.0 13.0 18.0 23.0)])
</code></pre><h2 id="46-&#x63D0;&#x4F9B;&#x5916;&#x90E8;&#x8FC7;&#x7A0B;&#x8BBF;&#x95EE;-providing-access-to-foreign-procedures">4.6 &#x63D0;&#x4F9B;&#x5916;&#x90E8;&#x8FC7;&#x7A0B;&#x8BBF;&#x95EE; (Providing Access to Foreign Procedures)</h2>
<p>&#x53EF;&#x4EE5;&#x901A;&#x8FC7;&#x4EE5;&#x4E0B;&#x63D0;&#x4F9B;&#x7684;&#x51E0;&#x79CD;&#x65B9;&#x5F0F;&#x8BBF;&#x95EE;&#x5916;&#x90E8;&#x8FC7;&#x7A0B;&#xFF1A;</p>
<ul>
<li>&#x53EF;&#x4F7F;&#x7528; load-shared-object &#x4ECE;&#x5171;&#x4EAB;&#x5BF9;&#x8C61;&quot;shared objects&quot;&#x52A0;&#x8F7D;&#x5916;&#x90E8;&#x8FC7;&#x7A0B;&#x3002;</li>
<li>&#x4E00;&#x4E2A;&#x65B0;&#x7684; Chez Scheme &#x6620;&#x50CF;&#x7F16;&#x8BD1;&#x65F6;&#x53EF;&#x94FE;&#x63A5;&#x989D;&#x5916;&#x7684;&#x5916;&#x90E8;&#x4EE3;&#x7801;&#x3002;(&#x5411;&#x5B89;&#x88C5;Chez Scheme&#x7684;&#x4EBA;&#x54A8;&#x8BE2;&#x8BE6;&#x7EC6;&#x4FE1;&#x606F;)&#x901A;&#x5E38;&#x8FD9;&#x4E9B;&#x5165;&#x53E3;&#x901A;&#x8FC7;Sforeign_symbol&#x6216;Sregister_symbol&#x6CE8;&#x518C;&#xFF0C;&#x53C2;&#x89C1;4.8&#x8282;&#x3002;</li>
<li>&#x5176;&#x4ED6;&#x5165;&#x53E3;&#x53EF;&#x52A8;&#x6001;&#x52A0;&#x8F7D;&#x6216;&#x4EE5;&#x5176;&#x4ED6;&#x65B9;&#x5F0F;&#x7531;&#x5916;&#x90E8;&#x4EE3;&#x7801;&#x83B7;&#x5F97;&#x3002;&#x901A;&#x5E38;&#x4E5F;&#x4F7F;&#x7528;Sforeign_symbol Sregister_symbol&#x8FDB;&#x884C;&#x6CE8;&#x518C;&#x3002;</li>
<li>&#x5165;&#x53E3;&#x5730;&#x5740;&#xFF0C;&#x6BD4;&#x5982;&#x51FD;&#x6570;&#x6307;&#x9488;&#xFF0C;&#x53EF;&#x88AB;&#x4F20;&#x9012;&#x7ED9;Scheme&#xFF0C;&#x5E76;&#x7528;&#x4F5C;foreign-procedure&#x8868;&#x8FBE;&#x5F0F;&#x4E2D;&#x7684;entry&#x8868;&#x8FBE;&#x5F0F;&#x7684;&#x503C;&#x3002;&#x901A;&#x8FC7;&#x8FD9;&#x79CD;&#x65B9;&#x5F0F;&#xFF0C;&#x5373;&#x4F7F;&#x5916;&#x90E8;&#x5165;&#x53E3;&#x70B9;&#x6CA1;&#x6709;&#x6309;&#x540D;&#x79F0;&#x6CE8;&#x518C;&#xFF0C;&#x4E5F;&#x53EF;&#x4EE5;&#x4F7F;&#x7528;&#x5B83;&#x4EEC;&#x3002;</li>
</ul>
<p>&#x8FC7;&#x7A0B;&#xFF1A;(foreign-entry? entry-name&#xFF09;
&#x8FD4;&#x56DE;&#xFF1A;&#x5982;&#x679C;entry-name&#x662F;&#x4E00;&#x4E2A;&#x5B58;&#x5728;&#x7684;&#x5916;&#x90E8;&#x8FC7;&#x7A0B;&#x5165;&#x53E3;&#x70B9;&#x8FD4;&#x56DE;#t&#xFF0C;&#x5426;&#x5219;#f
&#x5E93;&#xFF1A;(chezscheme)</p>
<p>entry-name &#x5FC5;&#x987B;&#x662F; string&#x3002;foreign-entry? &#x53EF;&#x7528;&#x4E8E;&#x5224;&#x65AD;&#x5916;&#x90E8;&#x8FC7;&#x7A0B;&#x7684;&#x5165;&#x53E3;&#x662F;&#x5426;&#x5B58;&#x5728;&#x3002;</p>
<p>&#x4EE5;&#x4E0B;&#x793A;&#x4F8B;&#x5047;&#x5B9A;&#x5305;&#x542B;strlen&#x5B9A;&#x4E49;&#x7684;&#x5E93;&#x5DF2;&#x901A;&#x8FC7;load-shared-object&#x52A0;&#x8F7D;&#xFF0C;&#x6216;&#x8005;strlen&#x5DF2;&#x7ECF;&#x901A;&#x8FC7;&#x672C;&#x8282;&#x4E2D;&#x4ECB;&#x7ECD;&#x7684;&#x5176;&#x4ED6;&#x65B9;&#x6CD5;&#x6CE8;&#x518C;&#x3002;</p>
<pre><code>(foreign-entry? &quot;strlen&quot;) =&gt; #t
((foreign-procedure &quot;strlen&quot;
    (string) size_t)
 &quot;hey!&quot;) =&gt; 4
</code></pre><p>&#x8FC7;&#x7A0B;&#xFF1A;(foreign-entry entry-name)
&#x8FD4;&#x56DE;&#xFF1A;entry-name&#x7684;&#x5730;&#x5740;&#xFF0C;exact integer&#x7C7B;&#x578B;
&#x5E93;&#xFF1A;(chezscheme)</p>
<p>entry-name&#x5FC5;&#x987B;&#x662F;&#x4E00;&#x4E2A;&#x547D;&#x540D;&#x73B0;&#x6709;&#x5916;&#x90E8;&#x5165;&#x53E3;&#x70B9;&#x7684;&#x5B57;&#x7B26;&#x4E32;&#x3002;</p>
<p>&#x4EE5;&#x4E0B;&#x793A;&#x4F8B;&#x5047;&#x5B9A;&#x5305;&#x542B;strlen&#x5B9A;&#x4E49;&#x7684;&#x5E93;&#x5DF2;&#x901A;&#x8FC7;load-shared-object&#x52A0;&#x8F7D;&#xFF0C;&#x6216;&#x8005;strlen&#x5DF2;&#x7ECF;&#x901A;&#x8FC7;&#x672C;&#x8282;&#x4E2D;&#x4ECB;&#x7ECD;&#x7684;&#x5176;&#x4ED6;&#x65B9;&#x6CD5;&#x6CE8;&#x518C;&#x3002;</p>
<pre><code>(let ([addr (foreign-entry &quot;strlen&quot;)])
  (and (integer? addr) (exact? addr))) =&gt; #t

(define-ftype strlen-type (function (string) size_t))
(define strlen
  (ftype-ref strlen-type ()
    (make-ftype-pointer strlen-type &quot;strlen&quot;)))
(strlen &quot;hey!&quot;) =&gt; 4
</code></pre><p>&#x8FC7;&#x7A0B;&#xFF1A;(foreign-address-name address)
&#x8FD4;&#x56DE;&#xFF1A;address&#x5BF9;&#x5E94;&#x7684;entry-name&#x3002;&#x82E5;&#x4E0D;&#x5B58;&#x5728;&#xFF0C;&#x8FD4;&#x56DE;#f
&#x5E93;&#xFF1A;(chezscheme)</p>
<p>&#x4EE5;&#x4E0B;&#x793A;&#x4F8B;&#x5047;&#x5B9A;&#x5305;&#x542B;strlen&#x5B9A;&#x4E49;&#x7684;&#x5E93;&#x5DF2;&#x901A;&#x8FC7;load-shared-object&#x52A0;&#x8F7D;&#xFF0C;&#x6216;&#x8005;strlen&#x5DF2;&#x7ECF;&#x901A;&#x8FC7;&#x672C;&#x8282;&#x4E2D;&#x4ECB;&#x7ECD;&#x7684;&#x5176;&#x4ED6;&#x65B9;&#x6CD5;&#x6CE8;&#x518C;&#x3002;</p>
<p><code>(foreign-address-name (foreign-entry &quot;strlen&quot;)) =&gt; &quot;strlen&quot;</code></p>
<p>&#x8FC7;&#x7A0B;&#xFF1A;(load-shared-object path)
&#x8FD4;&#x56DE;&#xFF1A;&#x672A;&#x6307;&#x5B9A;
&#x5E93;&#xFF1A;(chezscheme)</p>
<p>path&#x5FC5;&#x987B;&#x662F;&#x4E00;&#x4E2A;string&#x3002;load-shared-object &#x52A0;&#x8F7D;&#x7531; path &#x6307;&#x5B9A;&#x7684;&#x5171;&#x4EAB;&#x5BF9;&#x8C61;&#x3002;&#x5171;&#x4EAB;&#x5BF9;&#x8C61;&#x53EF;&#x80FD;&#x662F;&#x7CFB;&#x7EDF;&#x5E93;&#x6216;&#x4ECE;&#x666E;&#x901A;C&#x7A0B;&#x5E8F;&#x521B;&#x5EFA;&#x7684;&#x6587;&#x4EF6;&#x3002;&#x5171;&#x4EAB;&#x5BF9;&#x8C61;&#x4E2D;&#x7684;&#x6240;&#x6709;&#x5916;&#x90E8;&#x7B26;&#x53F7;&#x4EE5;&#x53CA;&#x4E0E;shared objects&#x94FE;&#x63A5;&#x7684;&#x5176;&#x4ED6;&#x5171;&#x4EAB;&#x5BF9;&#x8C61;&#x4E2D;&#x53EF;&#x7528;&#x7684;&#x5916;&#x90E8;&#x7B26;&#x53F7;&#x90FD;&#x53D8;&#x6210;&#x53EF;&#x7528;&#x7684;&#x5916;&#x90E8;&#x5165;&#x53E3;&#x3002;</p>
<p>&#x5728;Chez Scheme&#x8FD0;&#x884C;&#x7684;&#x5927;&#x591A;&#x6570;&#x5E73;&#x53F0;&#x4E0A;&#x90FD;&#x652F;&#x6301;&#x8BE5;&#x8FC7;&#x7A0B;&#x3002;</p>
<p>&#x5982;&#x679C;path&#x4E0D;&#x4EE5;&quot;.&quot;&#x6216;&#x8005;&quot;/&quot;&#x5F00;&#x59CB;&#xFF0C;Chez Scheme &#x5C06;&#x5728;&#x7CFB;&#x7EDF;&#x9ED8;&#x8BA4;&#x7684;&#x4E00;&#x7EC4;&#x641C;&#x7D22;&#x8DEF;&#x5F84;&#x4E2D;&#x67E5;&#x627E;&#x5171;&#x4EAB;&#x5BF9;&#x8C61;&#x3002;</p>
<p>&#x5728;&#x5927;&#x591A;&#x6570;Unix&#x7CFB;&#x7EDF;&#x4E0A;&#xFF0C;load-shared-object&#x57FA;&#x4E8E;&#x7CFB;&#x7EDF;&#x51FD;&#x6570;dlopen&#x3002;&#x5728;Windows&#x4E0B;&#xFF0C;load-shared-object&#x57FA;&#x4E8E;LoadLibrary&#x3002;&#x8BF7;&#x53C2;&#x9605;&#x8FD9;&#x4E9B;&#x4F8B;&#x7A0B;&#xFF0C;C&#x7F16;&#x8BD1;&#x5668;&#x548C;&#x52A0;&#x8F7D;&#x5668;&#x7684;&#x6587;&#x6863;&#xFF0C;&#x83B7;&#x53D6;&#x6709;&#x5173;&#x5B9A;&#x4F4D;&#x548C;&#x6784;&#x5EFA;&#x5171;&#x4EAB;&#x5BF9;&#x8C61;&#x7684;&#x51C6;&#x786E;&#x89C4;&#x5219;&#x3002;</p>
<p>load-shared-object&#x53EF;&#x4EE5;&#x7528;&#x6765;&#x8BBF;&#x95EE;&#x5185;&#x7F6E;&#x7684;C&#x5E93;&#x51FD;&#x6570;&#xFF0C;&#x6BD4;&#x5982;getenv&#x3002;&#x5171;&#x4EAB;&#x5BF9;&#x8C61;&#x7684;&#x540D;&#x79F0;&#x56E0;&#x7CFB;&#x7EDF;&#x800C;&#x5F02;&#x3002;</p>
<p>&#x5728;Linux&#x7CFB;&#x7EDF;&#x4E0A;&#xFF1A;
<code>&#xFF08;load-shared-object &quot;libc.so.6&quot;&#xFF09;</code></p>
<p>&#x5728;Solaris&#xFF0C;OpenSolaris&#xFF0C;FreeBSD&#xFF0C;NetBSD&#x548C;OpenBSD&#x7CFB;&#x7EDF;&#x4E0A;&#xFF1A;</p>
<p><code>&#xFF08;load-shared-object &quot;libc.so&quot;&#xFF09;</code></p>
<p>&#x5728;MacOS X&#x7CFB;&#x7EDF;&#x4E0A;&#xFF1A;</p>
<p><code>(load-shared-object &quot;libc.dylib&quot;)</code></p>
<p>&#x5728;Windows&#x4E0A;&#xFF1A;</p>
<p><code>(load-shared-object &quot;crtdll.dll&quot;)</code></p>
<p>&#x4E00;&#x65E6;C&#x5E93;&#x88AB;&#x52A0;&#x8F7D;&#xFF0C;getenv&#x5E94;&#x8BE5;&#x662F;&#x53EF;&#x7528;&#x7684;&#x5916;&#x90E8;&#x5165;&#x53E3;&#x3002;</p>
<p><code>(foreign-entry? &quot;getenv&quot;) =&gt; #t</code></p>
<p>&#x7B49;&#x6548;&#x7684;Scheme&#x8FC7;&#x7A0B;&#x53EF;&#x4EE5;&#x7528;&#x5982;&#x4E0B;&#x65B9;&#x5F0F;&#x5B9A;&#x4E49;&#x548C;&#x8C03;&#x7528;&#xFF1A;</p>
<pre><code>(define getenv
    (foreign-procedure &quot;getenv&quot;
        (string)
        string))
(getenv &quot;HOME&quot;) =&gt; &quot;/home/elmer/fudd&quot;
(getenv &quot;home&quot;) =&gt; #f
</code></pre><p>load-shared-object&#x4E5F;&#x53EF;&#x4EE5;&#x7528;&#x6765;&#x8BBF;&#x95EE;&#x7528;&#x6237;&#x521B;&#x5EFA;&#x7684;&#x5E93;&#x3002;&#x5047;&#x8BBE;C&#x6587;&#x4EF6;&quot;env.c&quot;&#x4E2D;&#x5305;&#x542B;</p>
<p><code>int even(n) int n; { return n == 0 || odd(n - 1); }</code></p>
<p>C&#x6587;&#x4EF6;&quot;odd.c&quot;&#x4E2D;&#x5305;&#x542B;</p>
<p><code>int odd(n) int n; { return n != 0 &amp;&amp; even(n - 1); }</code></p>
<p>&#x8FD9;&#x4E9B;&#x6587;&#x4EF6;&#x5FC5;&#x987B;&#x88AB;&#x7F16;&#x8BD1;&#x5E76;&#x94FE;&#x63A5;&#x5230;&#x5171;&#x4EAB;&#x5BF9;&#x8C61;&#x624D;&#x80FD;&#x88AB;&#x52A0;&#x8F7D;&#x3002;&#x5176;&#x8FC7;&#x7A0B;&#x53D6;&#x51B3;&#x4E8E;&#x5BBF;&#x4E3B;&#x7CFB;&#x7EDF;&#xFF1A;</p>
<p>&#x5728;Linux&#xFF0C;FreeBSD&#xFF0C;OpenBSD&#x548C;OpenSolaris&#x4E0A;&#xFF1A;</p>
<p><code>(system &quot;cc -fPIC -shared -o evenodd.so even.c odd.c&quot;)</code></p>
<p>&#x6839;&#x636E;&#x4E3B;&#x673A;&#x914D;&#x7F6E;&#x7684;&#x4E0D;&#x540C;&#xFF0C;&#x53EF;&#x80FD;&#x9700;&#x8981; -m32 &#x6216; -m64 &#x9009;&#x9879;&#x6765;&#x6307;&#x5B9A;32&#x4F4D;&#x6216;64&#x4F4D;&#x7F16;&#x8BD1;&#x3002;</p>
<p>&#x5728;MacOS X&#xFF08;Intel&#x6216;PowerPC&#xFF09;&#x7CFB;&#x7EDF;&#x4E0A;&#xFF1A;</p>
<p><code>(system &quot;cc -dynamiclib -o evenodd.so even.c odd.c&quot;)</code>
&#x6839;&#x636E;&#x4E3B;&#x673A;&#x914D;&#x7F6E;&#x7684;&#x4E0D;&#x540C;&#xFF0C;&#x53EF;&#x80FD;&#x9700;&#x8981; -m32 &#x6216; -m64 &#x9009;&#x9879;&#x6765;&#x6307;&#x5B9A;32&#x4F4D;&#x6216;64&#x4F4D;&#x7F16;&#x8BD1;&#x3002;</p>
<p>&#x5728;32&#x4F4D;Sparc Solaris&#x4E0A;&#xFF1A;</p>
<p><code>(system &quot;cc -KPIC -G -o evenodd.so even.c odd.c&quot;)</code></p>
<p>&#x5728;64&#x4F4D;Sparc Solaris&#x4E0A;&#xFF1A;</p>
<p><code>(system &quot;cc -xarch=v9 -KPIC -G -o evenodd.so even.c odd.c&quot;)</code></p>
<p>&#x5728;Windows&#x4E0A;&#xFF0C;&#x6211;&#x4EEC;&#x6784;&#x5EFA;&#x4E00;&#x4E2A;DLL&#xFF08;&#x52A8;&#x6001;&#x94FE;&#x63A5;&#x5E93;&#xFF09;&#x6587;&#x4EF6;&#x3002;&#x4E3A;&#x4E86;&#x4F7F;&#x7F16;&#x8BD1;&#x5668;&#x751F;&#x6210;&#x9002;&#x5F53;&#x7684;&#x5165;&#x53E3;&#x70B9;&#xFF0C;&#x6211;&#x4EEC;&#x6539;&#x53D8;even.c&#x4E3A;</p>
<pre><code>#ifdef WIN32
#define EXPORT extern __declspec (dllexport)
#else
#define EXPORT extern
#endif

EXPORT int even(n) int n; { return n == 0 || odd(n - 1); }
</code></pre><p>odd.c&#x4E3A;</p>
<pre><code>#ifdef WIN32
#define EXPORT extern __declspec (dllexport)
#else
#define EXPORT extern
#endif

EXPORT int odd(n) int n; { return n != 0 &amp;&amp; even(n - 1); }
</code></pre><p>&#x7136;&#x540E;&#xFF0C;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x6309;&#x5982;&#x4E0B;&#x6240;&#x793A;&#x6784;&#x5EFA;DLL&#xFF0C;&#x5E76;&#x4E3A;&#x5176;&#x63D0;&#x4F9B;&#x6269;&#x5C55;&#x540D;&#x201C;.so&#x201D;&#x800C;&#x4E0D;&#x662F;&#x201C;.dll&#x201D;&#xFF0C;&#x4EE5;&#x4FBF;&#x4E0E;&#x5176;&#x4ED6;&#x7CFB;&#x7EDF;&#x4FDD;&#x6301;&#x4E00;&#x81F4;&#x3002;</p>
<pre><code>(system &quot;cl -c -DWIN32 even.c&quot;)
(system &quot;cl -c -DWIN32 odd.c&quot;)
(system &quot;link -dll -out:evenodd.so even.obj odd.obj&quot;)
</code></pre><p>&#x751F;&#x6210;&#x7684;&#x201C;.so&#x201D;&#x6587;&#x4EF6;&#x53EF;&#x4EE5;&#x52A0;&#x8F7D;&#x5230;Scheme&#x4E2D;&#xFF0C;even&#x548C;odd&#x53EF;&#x4EE5;&#x4F5C;&#x4E3A;&#x5916;&#x90E8;&#x8FC7;&#x7A0B;&#x4F7F;&#x7528;&#xFF1A;</p>
<pre><code>(load-shared-object &quot;./evenodd.so&quot;)
(let ([odd (foreign-procedure &quot;odd&quot;
             (integer-32) boolean)]
      [even (foreign-procedure &quot;even&quot;
              (integer-32) boolean)])
  (list (even 100) (odd 100))) =&gt; (#t #f)
</code></pre><p>&#x6587;&#x4EF6;&#x540D;&#x4EE5;&#x201C;./evenodd.so&#x201D;&#x5B9A;&#x4E49;&#xFF0C;&#x800C;&#x4E0D;&#x662F;&#x7B80;&#x5355;&#x7684;&#x201C;evenodd.so&#x201D;&#xFF0C;&#x56E0;&#x4E3A;&#x6709;&#x4E9B;&#x7CFB;&#x7EDF;&#x5728;&#x6807;&#x51C6;&#x7CFB;&#x7EDF;&#x76EE;&#x5F55;&#x96C6;&#x4E2D;&#x67E5;&#x627E;&#x5171;&#x4EAB;&#x5E93;&#xFF0C;&#x800C;&#x4E0D;&#x5305;&#x542B;&#x5F53;&#x524D;&#x76EE;&#x5F55;&#x7684;&#x3002;</p>
<p>&#x8FC7;&#x7A0B;&#xFF1A;(remove-foreign-entry entry-name)
&#x8FD4;&#x56DE;&#xFF1A;&#x672A;&#x6307;&#x5B9A;
&#x5E93;&#xFF1A; (chezscheme)</p>
<p>remove-foreign-entry&#x5C06;&#x963B;&#x6B62;&#x5728;&#x5176;&#x4E4B;&#x540E;&#x5BF9;entry-name&#x6307;&#x5B9A;&#x7684;&#x5165;&#x53E3;&#x8FDB;&#x884C;&#x8BBF;&#x95EE;&#x3002;&#x5982;&#x679C;&#x76EE;&#x6807;&#x4E0D;&#x5B58;&#x5728;&#xFF0C;&#x5C06;&amp;assertion&#x6761;&#x4EF6;&#x7C7B;&#x578B;&#x629B;&#x51FA;&#x5F02;&#x5E38;&#x3002;&#x56E0;&#x4E3A;&#x7531;foreign-procedure&#x5EFA;&#x7ACB;&#x7684;&#x8BBF;&#x95EE;&#x4E0D;&#x53D7;&#x5F71;&#x54CD;&#xFF0C;remove-foreign-entry&#x53EF;&#x7528;&#x4E8E;&#x5728;&#x4E00;&#x7EC4;&#x9700;&#x8981;&#x7684;&#x5916;&#x90E8;&#x8FC7;&#x7A0B;&#x63A5;&#x53E3;&#x5EFA;&#x7ACB;&#x4E4B;&#x540E;&#x8FDB;&#x884C;&#x6E05;&#x7406;&#x5DE5;&#x4F5C;&#x3002;</p>
<p>remove-foreign-entry&#x53EF;&#x7528;&#x4E8E;&#x5220;&#x9664;&#x7531;Sforeign_symbol&#x548C;Sregister_symbol&#x6CE8;&#x518C;&#x7684;&#x5165;&#x53E3;&#xFF0C;&#x4F46;&#x4E0D;&#x80FD;&#x5220;&#x9664;&#x901A;&#x8FC7;&#x8C03;&#x7528;load-shared-object&#x800C;&#x521B;&#x5EFA;&#x7684;&#x5165;&#x53E3;&#x3002;</p>
<h2 id="47-&#x4F7F;&#x7528;&#x5176;&#x4ED6;&#x7684;&#x5916;&#x90E8;&#x8BED;&#x8A00;-using-other-foreign-languages">4.7 &#x4F7F;&#x7528;&#x5176;&#x4ED6;&#x7684;&#x5916;&#x90E8;&#x8BED;&#x8A00; (Using Other Foreign Languages)</h2>
<p>&#x5C3D;&#x7BA1;Chez Scheme&#x5916;&#x90E8;&#x8FC7;&#x7A0B;&#x63A5;&#x53E3;&#x4E3B;&#x8981;&#x9762;&#x5411;C&#x4E2D;&#x5B9A;&#x4E49;&#x7684;&#x8FC7;&#x7A0B;&#x6216;C&#x5E93;&#x4E2D;&#x53EF;&#x7528;&#x7684;&#x8FC7;&#x7A0B;&#xFF0C;&#x4F46;&#x4E5F;&#x53EF;&#x4EE5;&#x8C03;&#x7528;&#x5176;&#x4ED6;&#x8BED;&#x8A00;&#x4E2D;&#x9075;&#x5FAA;C&#x8C03;&#x7528;&#x7EA6;&#x5B9A;&#x7684;&#x8FC7;&#x7A0B;&#x3002;&#x4E00;&#x4E2A;&#x96BE;&#x70B9;&#x53EF;&#x80FD;&#x6765;&#x81EA;&#x540D;&#x5B57;&#x89E3;&#x6790;&#x3002;&#x57FA;&#x4E8E;Unix&#x7684;C&#x7F16;&#x8BD1;&#x5668;&#x901A;&#x5E38;&#x4F1A;&#x5728;&#x5916;&#x90E8;&#x540D;&#x524D;&#x52A0;&#x4E00;&#x4E2A;&#x4E0B;&#x5212;&#x7EBF;&#xFF0C;&#x5916;&#x90E8;&#x63A5;&#x53E3;&#x5C1D;&#x8BD5;&#x4EE5;&#x4E0E;&#x4E3B;&#x673A;C&#x7F16;&#x8BD1;&#x5668;&#x4E00;&#x81F4;&#x7684;&#x65B9;&#x5F0F;&#x89E3;&#x91CA;&#x5165;&#x53E3;&#x540D;&#x3002;&#x5076;&#x5C14;&#xFF0C;&#x5982;&#x6C47;&#x7F16;&#x4EE3;&#x7801;&#x6587;&#x4EF6;&#xFF0C;&#x8FD9;&#x4E2A;&#x6761;&#x76EE;&#x7684;&#x540D;&#x79F0;&#x53EF;&#x80FD;&#x4E0D;&#x4EE5;&#x88AB;&#x671F;&#x671B;&#x7684;&#x65B9;&#x5F0F;&#x89E3;&#x6790;&#x3002;&#x901A;&#x8FC7;&#x5728;&#x5165;&#x53E3;&#x540D;&#x524D;&#x6DFB;&#x52A0;&#x4E00;&#x4E2A;&#x201C;=&#x201D;&#x5B57;&#x7B26;&#x53EF;&#x9632;&#x6B62;&#x3002; &#x4F8B;&#x5982;&#xFF0C;&#x52A0;&#x8F7D;&#x5305;&#x542B;&#x8FC7;&#x7A0B;&#x201C;foo&#x201D;&#x7684;&#x6C47;&#x7F16;&#x6587;&#x4EF6;&#x540E;&#xFF0C;&#x53EF;&#x80FD;&#x4F1A;&#x6709;</p>
<pre><code>&#xFF08;foreign-entry&#xFF1F;&#x201C;foo&#x201D;&#xFF09; =&gt; #f
&#xFF08;foreign-entry&#xFF1F;&#x201C;=foo&#x201D;&#xFF09;=&gt; #t
</code></pre><h2 id="48-c&#x5E93;&#x8FC7;&#x7A0B;-c-library-routines">4.8 C&#x5E93;&#x8FC7;&#x7A0B; (C Library Routines)</h2>
<p>&#x901A;&#x8FC7;&#x4E00;&#x7EC4;C&#x9884;&#x5904;&#x7406;&#x5B8F;&#x548C;C&#x53EF;&#x8C03;&#x7528;&#x5E93;&#x51FD;&#x6570;&#x63D0;&#x4F9B;&#x989D;&#x5916;&#x7684;&#x5916;&#x90E8;&#x63A5;&#x53E3;&#x652F;&#x6301;&#x3002;&#x5176;&#x4E2D;&#x4E00;&#x4E9B;&#x51FD;&#x6570;&#x5141;&#x8BB8;C&#x7A0B;&#x5E8F;&#x68C0;&#x67E5;&#xFF0C;&#x5206;&#x914D;&#x548C;&#x6539;&#x53D8;Scheme&#x5BF9;&#x8C61;&#x3002;&#x53E6;&#x5916;&#x4E00;&#x4E9B;&#x5141;&#x8BB8;C&#x51FD;&#x6570;&#x901A;&#x8FC7;&#x4E00;&#x4E9B;&#x6BD4;4.3&#x8282;&#x4E2D;&#x66F4;&#x57FA;&#x672C;&#x7684;&#x63A5;&#x53E3;&#x8C03;&#x7528;Scheme&#x8FC7;&#x7A0B;&#x3002;&#x5176;&#x4ED6;&#x4E00;&#x4E9B;&#x5141;&#x8BB8;&#x5F00;&#x53D1;&#x5B9A;&#x5236;&#x7684;&#x53EF;&#x6267;&#x884C;&#x955C;&#x50CF;&#xFF0C;&#x5E76;&#x4F7F;&#x7528;Scheme&#x7CFB;&#x7EDF;&#x4F5C;&#x4E3A;&#x4E00;&#x4E2A;&#x7A0B;&#x5E8F;&#x4E2D;&#x7684;&#x4E0B;&#x5C5E;&#x7A0B;&#x5E8F;&#xFF0C;&#x4F8B;&#x5982;&#xFF0C;&#x4F5C;&#x4E3A;&#x53EF;&#x6269;&#x5C55;&#x8BED;&#x8A00;&#x3002;</p>
<p>&#x4F7F;&#x7528;&#x8FD9;&#x4E9B;&#x51FD;&#x6570;&#x7684;C&#x4EE3;&#x7801;&#x5FC5;&#x987B;&#x5305;&#x542B;&#x4E0E;Chez Scheme&#x4E00;&#x8D77;&#x53D1;&#x5E03;&#x7684;&#x201C;scheme.h&#x201D;&#x5934;&#x6587;&#x4EF6;&#xFF0C;&#x5E76;&#x4E14;&#x5FC5;&#x987B;&#x94FE;&#x63A5;Chez Scheme&#x5185;&#x6838;&#xFF08;&#x65E0;&#x8BBA;&#x662F;&#x9759;&#x6001;&#x8FD8;&#x662F;&#x52A8;&#x6001;&#xFF09;&#x3002;&#x5934;&#x6587;&#x4EF6;&#x5305;&#x542B;&#x9884;&#x5904;&#x7406;&#x5B8F;&#x5B9A;&#x4E49;&#x548C;&#x5E93;&#x51FD;&#x6570;&#x7684;&#x5916;&#x90E8;&#x58F0;&#x660E;&#x3002;&#x6587;&#x4EF6;&#x53EF;&#x9488;&#x5BF9;&#x4E0D;&#x540C;&#x7684;Chez Scheme&#x7248;&#x672C;&#x548C;&#x9488;&#x5BF9;&#x7684;&#x673A;&#x5668;&#x7C7B;&#x578B;&#x8FDB;&#x884C;&#x5B9A;&#x5236;&#xFF1B;&#x4E0D;&#x540C;Chez Scheme&#x53D1;&#x5E03;&#x7248;&#x672C;&#x4E4B;&#x95F4;&#x5207;&#x6362;&#x65F6;&#xFF0C;&#x5176;&#x5E94;&#x8BE5;&#x4FDD;&#x6301;&#x4E0D;&#x88AB;&#x4FEE;&#x6539;&#xFF0C;&#x5E76;&#x4E14;&#x5408;&#x9002;&#x7248;&#x672C;&#x7684;&#x5934;&#x6587;&#x4EF6;&#x5FC5;&#x987B;&#x603B;&#x662F;&#x4E0E;&#x7279;&#x5B9A;&#x7248;&#x672C;&#x7684;Chez Scheme&#x5BF9;&#x5E94;&#x4F7F;&#x7528;&#x6765;&#x7F16;&#x8BD1;C&#x4EE3;&#x7801;&#x3002;&#x7248;&#x672C;&#x548C;&#x673A;&#x5668;&#x7C7B;&#x578B;&#x5728;&#x201C;scheme.h&#x201D;&#x4E2D;&#x5B9A;&#x4E49;&#x4E3A; VERSION &#x548C; MACHINE_TYPE&#x3002;</p>
<p>&#x6BCF;&#x4E2A;&#x51FD;&#x6570;&#x7684;&#x540D;&#x5B57;&#x90FD;&#x4EE5;&#x5927;&#x5199;&#x7684;S&#x5F00;&#x5934;&#xFF0C;&#x4F8B;&#x5982;&#xFF0C;Sfixnump&#x3002;&#x8BB8;&#x591A;&#x540D;&#x5B57;&#x662F;&#x5BF9;&#x5E94;&#x7684;Scheme&#x8FC7;&#x7A0B;&#x7684;&#x7B80;&#x5355;&#x53D8;&#x5316;&#xFF0C;&#x5982;&#xFF0C;Sstring<em>to_symbol&#x662F;string-&gt;symbol&#x7684;&#x7B49;&#x6548;C&#x63A5;&#x53E3;&#x3002;&#x5927;&#x591A;&#x6570;Chez Scheme&#x53EF;&#x6267;&#x884C;&#x7A0B;&#x5E8F;&#x4E2D;&#x7684;&#x4EE5;&#x5927;&#x5C0F;S&#x5F00;&#x5934;&#x7684;&#x540E;&#x8DDF;&#x4E0B;&#x5212;&#x7EBF;(S</em>)&#x7684;&#x5916;&#x90E8;&#x53EF;&#x89C1;&#x5165;&#x53E3;&#x5E76;&#x6CA1;&#x6709;&#x5728;&#x8FD9;&#x91CC;&#x4ECB;&#x7ECD;&#xFF1B;&#x5E94;&#x8BE5;&#x907F;&#x514D;&#x4F7F;&#x7528;&#x5B83;&#x4EEC;&#x3002;</p>
<p>&#x9664;&#x4E86;scheme.h&#x4E2D;&#x4E0D;&#x540C;&#x7684;&#x5B8F;&#x548C;&#x5916;&#x90E8;&#x58F0;&#x660E;&#x5916;&#xFF0C;&#x5934;&#x6587;&#x4EF6;&#x8FD8;&#x5B9A;&#x4E49;(typedefs)&#x4E86;&#x4E00;&#x4E9B;&#x5728;&#x5934;&#x6587;&#x4EF6;&#x4E2D;&#x4F7F;&#x7528;&#x7684;&#x7C7B;&#x578B;</p>
<ul>
<li>ptr: Scheme &#x503C;&#x7C7B;&#x578B;</li>
<li>iptr: signed integer&#xFF0C;&#x4E0E;Scheme&#x503C;&#x7C7B;&#x578B;&#x76F8;&#x540C;&#x5927;&#x5C0F;</li>
<li>uptr: unsigned integer&#xFF0C;&#x4E0E;Scheme&#x503C;&#x7C7B;&#x578B;&#x76F8;&#x540C;&#x5927;&#x5C0F;</li>
<li>string_char: &#x5355;&#x4E2A;Scheme string&#x5143;&#x7D20;&#x7C7B;&#x578B;</li>
<li>octet: &#x5355;&#x4E2A;Scheme bytevector&#x5143;&#x7D20;&#x7C7B;&#x578B;(unsigned char)</li>
</ul>
<p>&#x4E0D;&#x540C;&#x5E73;&#x53F0;&#x4E0A;&#xFF0C;&#x8FD9;&#x4E9B;&#x7C7B;&#x578B;&#x4F1A;&#x6709;&#x6240;&#x4E0D;&#x540C;&#xFF0C;&#x5C3D;&#x7BA1;ptr&#x901A;&#x5E38;&#x662F;void *&#xFF0C;iptr&#x901A;&#x5E38;&#x662F;long int&#xFF0C;uptr&#x901A;&#x5E38;&#x662F;usigned long int&#x3002;</p>
<p>&#x5728;Windows&#x4E0A;&#xFF0C;&#x5305;&#x542B;scheme.h&#x524D;&#x5B9A;&#x4E49;SCHEME_IMPORT&#xFF0C;&#x4F1A;&#x4F7F;&#x5F97;scheme.h&#x4F7F;&#x7528;extern declspec (dllimport)&#x6765;&#x58F0;&#x660E;&#x5176;&#x5165;&#x53E3;&#x70B9;&#xFF0C;&#x800C;&#x4E0D;&#x662F;&#x9ED8;&#x8BA4;&#x7684;extern declspec (dllexport)&#x65B9;&#x5F0F;&#x3002;&#x4E0D;&#x5B9A;&#x4E49;SCHEME_IMPORT&#x800C;&#x662F;&#x5B9A;&#x4E49;SCHEME_STATIC&#x4F1A;&#x4F7F;&#x5F97;scheme.h&#x53EA;&#x4F7F;&#x7528;extern&#x6765;&#x58F0;&#x660E;&#x3002;Chez Scheme&#x7684;&#x9759;&#x6001;&#x5E93;&#x4F7F;&#x7528;SCHEME_STATIC&#x3002;</p>
<p>&#x672C;&#x7AE0;&#x540E;&#x7EED;&#x5185;&#x5BB9;&#x4F9D;&#x6B21;&#x4ECB;&#x7ECD;&#x6BCF;&#x4E2A;C&#x63A5;&#x53E3;&#x51FD;&#x6570;&#x3002;&#x6BCF;&#x4E2A;&#x8FC7;&#x7A0B;&#x7684;&#x58F0;&#x660E;&#x6309;&#x7167;ANSI C &#x51FD;&#x6570;&#x539F;&#x578B;&#x89C4;&#x5219;&#x51C6;&#x786E;&#x6307;&#x5B9A;&#x53C2;&#x6570;&#x548C;&#x8FD4;&#x56DE;&#x503C;&#x7C7B;&#x578B;&#x3002;Scheme&#x5BF9;&#x8C61;&#x5177;&#x6709;ptr C&#x7C7B;&#x578B;&#xFF0C;&#x5728;&#x201C;scheme.h&#x201D;&#x4E2D;&#x5B9A;&#x4E49;&#x3002;&#x5728;&#x5408;&#x9002;&#x7684;&#x5730;&#x65B9;&#xFF0C;&#x4F7F;&#x7528;C&#x503C;&#x4F5C;&#x4E3A;&#x53C2;&#x6570;&#x548C;&#x8FD4;&#x56DE;&#x503C;&#x6765;&#x66FF;&#x4EE3;Scheme&#x5BF9;&#x8C61;&#x3002;</p>
<p>&#x9884;&#x5904;&#x7406;&#x5B8F;&#x53EF;&#x80FD;&#x4F1A;&#x591A;&#x6B21;&#x6C42;&#x503C;&#x5176;&#x53C2;&#x6570;&#xFF08;&#x6216;&#x8005;&#x4E0D;&#x6C42;&#x503C;&#xFF09;&#xFF0C;&#x6240;&#x4EE5;&#x8981;&#x5C0F;&#x5FC3;&#x786E;&#x4FDD;&#x8FD9;&#x4F1A;&#x4E0D;&#x4EA7;&#x751F;&#x95EE;&#x9898;&#x3002;</p>
<p><strong>&#x5B9A;&#x5236;</strong>&#x3002;&#x8FD9;&#x91CC;&#x4ECB;&#x7ECD;&#x7684;&#x51FD;&#x6570;&#x88AB;&#x7528;&#x4E8E;&#x521D;&#x59CB;&#x5316;Scheme&#x7CFB;&#x7EDF;&#xFF0C;&#x5EFA;&#x7ACB;Scheme heap&#xFF0C;&#x4ECE;&#x4E00;&#x4E2A;&#x72EC;&#x7ACB;&#x7684;&#x7A0B;&#x5E8F;&#x8FD0;&#x884C;Scheme&#x7CFB;&#x7EDF;&#x3002;</p>
<pre><code>[func] char * Skernel_version(void)
[func] void Sscheme_init(void (*abnormal_exit)(void))
[func] void Sset_verbose(int v)
[func] void Sregister_boot_file(const char *name)
[func] void Sregister_boot_file_fd(const char *name, int fd)
[func] void Sbuild_heap(const char *exec, void (*custom_init)(void))
[func] void Senable_expeditor(const char *history_file)
[func] void Sretain_static_relocation(void)
[func] int Sscheme_start(int argc, char *argv[])
[func] int Sscheme_script(char *scriptfile, int argc, char *argv[])
[func] int Sscheme_program(char *programfile, int argc, char *argv[])
[func] void Scompact_heap(void)
[func] void Sscheme_deinit(void)
</code></pre><p>Skernel_version&#x8FD4;&#x56DE;&#x4EE3;&#x8868;Scheme&#x7248;&#x672C;&#x7684;&#x5B57;&#x7B26;&#x4E32;&#x3002;&#x5728;&#x4F7F;&#x7528;&#x4EE5;&#x4E0A;&#x6240;&#x5217;&#x7684;&#x4EFB;&#x4F55;&#x521D;&#x59CB;&#x5316;&#x51FD;&#x6570;&#x524D;&#xFF0C;&#x5176;&#x5E94;&#x8BE5;&#x88AB;&#x7528;&#x4E8E;&#x4E0E;VERSION&#x9884;&#x5904;&#x7406;&#x5B8F;&#x8FDB;&#x884C;&#x6BD4;&#x8F83;&#xFF0C;&#x786E;&#x4FDD;&#x4F7F;&#x7528;&#x4E86;&#x6B63;&#x786E;&#x7684;&quot;scheme.h&quot;&#x5934;&#x6587;&#x4EF6;&#x3002;</p>
<p>Sscheme_init&#x4F7F;&#x5F97;Scheme&#x7CFB;&#x7EDF;&#x521D;&#x59CB;&#x5316;&#x9759;&#x6001;&#x5185;&#x5B58;&#xFF0C;&#x4E3A;boot&#x6587;&#x4EF6;&#x6CE8;&#x518C;&#x505A;&#x51C6;&#x5907;&#x3002;abnormal_exit&#x53C2;&#x6570;&#xFF08;&#x53EF;&#x80FD;&#x4E3A;null&#xFF09;&#x5E94;&#x8BE5;&#x662F;&#x4E00;&#x4E2A;&#x6CA1;&#x6709;&#x53C2;&#x6570;&#x7684;C&#x51FD;&#x6570;&#x6307;&#x9488;&#xFF0C;&#x5176;&#x5728;&#x521D;&#x59CB;&#x5316;&#x6216;&#x540E;&#x7EED;&#x7684;&#x5806;&#x5EFA;&#x7ACB;&#x8FC7;&#x7A0B;&#x4E2D;&#x5931;&#x8D25;&#x65F6;&#x91C7;&#x53D6;&#x5408;&#x9002;&#x7684;&#x63AA;&#x65BD;&#x3002;&#x5982;&#x679C;&#x4E3A;null&#xFF0C;&#x9ED8;&#x8BA4;&#x7684;&#x884C;&#x4E3A;&#x662F;&#x8C03;&#x7528;exit(1)&#x3002;</p>
<p>Sset_verbose&#x6307;&#x5B9A;verbose&#x6A21;&#x5F0F;&#xFF0C;v&#x662F;&#x975E;&#x96F6;&#x503C;&#x4E3A;&#x6253;&#x5F00;&#xFF0C;v&#x4E3A;&#x96F6;&#x65F6;&#x5173;&#x95ED;&#x3002;&#x5728;verbose&#x6A21;&#x5F0F;&#xFF0C;&#x7CFB;&#x7EDF;&#x4F1A;&#x663E;&#x793A;&#x67E5;&#x627E;&#x540E;&#x7EED;&#x6CE8;&#x518C;boot&#x6587;&#x4EF6;&#x7684;&#x8FC7;&#x7A0B;&#x3002;</p>
<p>Sregister_boot_file &#x641C;&#x7D22;&#x53C2;&#x6570;name&#x4E2D;&#x7684;boot&#x6587;&#x4EF6;&#xFF0C;&#x5E76;&#x6CE8;&#x518C;&#x5728;&#x4E4B;&#x540E;&#x52A0;&#x8F7D;&#xFF0C;&#x800C;Sregister_boot_file_fd&#x63D0;&#x4F9B;&#x6307;&#x5B9A;&#x7684;boot file&#x548C;&#x4E00;&#x4E2A;&#x6587;&#x4EF6;&#x63CF;&#x8FF0;&#x7B26;&#x3002;&#x5F53;&#x53EA;&#x6709;&#x4E00;&#x4E2A;boot&#x6587;&#x4EF6;&#x540D;&#x5B57;&#x63D0;&#x4F9B;&#x65F6;&#xFF0C;&#x6587;&#x4EF6;&#x88AB;&#x6253;&#x5F00;&#xFF0C;&#x4F46;&#x662F;&#x4E0D;&#x88AB;&#x52A0;&#x8F7D;&#xFF0C;&#x76F4;&#x5230;&#x901A;&#x8FC7;Sbuild_heap&#x5EFA;&#x7ACB;&#x5806;&#x540E;&#x624D;&#x88AB;&#x52A0;&#x8F7D;&#x3002;&#x5F53;&#x4E00;&#x4E2A;&#x6587;&#x4EF6;&#x63CF;&#x8FF0;&#x7B26;&#x88AB;&#x63D0;&#x4F9B;&#x65F6;&#xFF0C;&#x6587;&#x4EF6;&#x540D;name&#x53EA;&#x88AB;&#x7528;&#x6765;&#x62A5;&#x544A;&#x9519;&#x8BEF;&#x3002;&#x53EA;&#x5BF9;&#x7B2C;&#x4E00;&#x4E2A;&#x6CE8;&#x518C;&#x7684;boot&#x6587;&#x4EF6;&#xFF0C;&#x7CFB;&#x7EDF;&#x4E5F;&#x4F1A;&#x67E5;&#x627E;name&#x6587;&#x4EF6;&#x4F9D;&#x8D56;&#x7684;boot&#x6587;&#x4EF6;&#xFF0C;&#x65E0;&#x8BBA;&#x662F;&#x76F4;&#x63A5;&#x8FD8;&#x662F;&#x95F4;&#x63A5;&#x65B9;&#x5F0F;&#x3002;</p>
<p>Sbuild_heap&#x4ECE;&#x6CE8;&#x518C;&#x7684;boot&#x6587;&#x4EF6;&#x521B;&#x5EFA;Scheme heap&#x3002;exec&#x88AB;&#x5047;&#x5B9A;&#x4E3A;&#x53EF;&#x6267;&#x884C;&#x955C;&#x50CF;&#x7684;&#x540D;&#x5B57;&#x6216;&#x8005;&#x8DEF;&#x5F84;&#xFF0C;&#x5F53;&#x6CA1;&#x6709;boot&#x6587;&#x4EF6;&#x88AB;&#x6CE8;&#x518C;&#x65F6;&#xFF0C;&#x4F5C;&#x4E3A;boot&#x6587;&#x4EF6;&#x641C;&#x7D22;&#x7684;&#x540D;&#x5B57;&#x3002;&#x53EA;&#x6709;&#x5F53;&#x4E00;&#x4E2A;&#x6216;&#x591A;&#x4E2A;boot&#x6587;&#x4EF6;&#x88AB;&#x6CE8;&#x518C;&#x65F6;&#xFF0C;exec&#x53EF;&#x4EE5;&#x4E3A;null&#x3002;custom_init&#x5FC5;&#x987B;&#x662F;&#x6CA1;&#x6709;&#x53C2;&#x6570;&#x7684;C&#x51FD;&#x6570;&#x7684;&#x6307;&#x9488;&#xFF08;&#x53EF;&#x4EE5;&#x4E3A;null&#xFF09;&#xFF1B;&#x5982;&#x679C;&#x4E0D;&#x662F;null&#xFF0C;&#x5728;boot&#x6587;&#x4EF6;&#x52A0;&#x8F7D;&#x4E4B;&#x524D;&#x88AB;&#x8C03;&#x7528;&#x3002;</p>
<p>Sscheme_start &#x8C03;&#x7528;&#x4EA4;&#x4E92;&#x542F;&#x52A8;&#x8FC7;&#x7A0B;&#xFF0C;&#x4F8B;&#x5982;&#xFF0C;scheme-start&#x53C2;&#x6570;&#x7684;&#x503C;&#xFF0C;&#x4E00;&#x4E2A;Scheme string&#x53C2;&#x6570;&#x5305;&#x542B;argv&#x53C2;&#x6570;&#x7684;&#x524D;argc&#x4E2A;&#x5143;&#x7D20;&#xFF0C;&#x4E0D;&#x5305;&#x542B;argv[0]&#x3002;Sscheme_script&#x7C7B;&#x4F3C;&#x5730;&#x8C03;&#x7528;&#x811A;&#x6B65;&#x542F;&#x52A8;&#x8FC7;&#x7A0B;&#xFF0C;&#x4F8B;&#x5982;&#xFF0C;scheme-script&#x53C2;&#x6570;&#x503C;&#xFF0C;&#x4E00;&#x4E2A;Scheme string&#x53C2;&#x6570;&#x5305;&#x542B;scriptfile&#x548C;argv&#x53C2;&#x6570;&#x7684;&#x524D;argc&#x4E2A;&#x5143;&#x7D20;&#xFF0C;&#x4E0D;&#x5305;&#x542B;argv[0]&#x3002;Sscheme_program&#x7C7B;&#x4F3C;&#x5730;&#x8C03;&#x7528;&#x7A0B;&#x5E8F;&#x542F;&#x52A8;&#x8FC7;&#x7A0B;&#xFF0C;&#x4F8B;&#x5982;&#xFF0C;scheme-program&#x53C2;&#x6570;&#x503C;&#xFF0C;&#x4E00;&#x4E2A;Scheme string&#x53C2;&#x6570;&#x5305;&#x542B;programfile&#x548C;argv&#x53C2;&#x6570;&#x7684;&#x524D;argc&#x4E2A;&#x5143;&#x7D20;&#xFF0C;&#x4E0D;&#x5305;&#x542B;argv[0]&#x3002;</p>
<p>Senable_expeditor&#x542F;&#x7528;&#x8868;&#x8FBE;&#x5F0F;&#x7F16;&#x8F91;&#x5668;&#xFF08;&#x89C1;2.2&#x8282;&#xFF0C;14&#x7AE0;&#xFF09;&#xFF0C;&#x9ED8;&#x8BA4;&#x662F;&#x4E0D;&#x542F;&#x7528;&#x7684;&#xFF0C;&#x6307;&#x5B9A;&#x5386;&#x53F2;&#x6587;&#x4EF6;&#x540D;history_file&#xFF0C;&#x4ECE;&#x8BE5;&#x6587;&#x4EF6;&#x6062;&#x590D;&#x5386;&#x53F2;&#x8BB0;&#x5F55;&#x548C;&#x4FDD;&#x5B58;&#x5386;&#x53F2;&#x8BB0;&#x5F55;&#x3002;&#x8BE5;&#x8FC7;&#x7A0B;&#x5FC5;&#x987B;&#x5728;&#x5806;&#x5EFA;&#x7ACB;&#x540E;&#x8C03;&#x7528;&#xFF0C;&#x5426;&#x5219;&#x4F1A;&#x4EA7;&#x751F;&#x9519;&#x8BEF;&#x3002;&#x5B83;&#x4E5F;&#x5FC5;&#x987B;&#x5728;Sscheme_start&#x4E4B;&#x524D;&#x8C03;&#x7528;&#xFF0C;&#x8FD9;&#x6837;&#x624D;&#x80FD;&#x8D77;&#x6548;&#x3002;&#x5982;&#x679C;histroy_file&#x53C2;&#x6570;&#x662F;null&#x6307;&#x9488;&#xFF0C;&#x5386;&#x53F2;&#x8BB0;&#x5F55;&#x4E0D;&#x80FD;&#x6062;&#x590D;&#x6216;&#x8005;&#x4FDD;&#x5B58;&#x3002;&#x5728;scheme.h&#x4E2D;&#x5982;&#x679C;&#x9884;&#x5904;&#x7406;&#x53D8;&#x91CF;FEATURE_EXPEDITOR
&#x88AB;&#x5B9A;&#x4E49;&#xFF0C;&#x90A3;&#x4E48;&#x5BF9;&#x8868;&#x8FBE;&#x5F0F;&#x7F16;&#x8F91;&#x5668;&#x7684;&#x652F;&#x6301;&#x5DF2;&#x7ECF;&#x88AB;&#x7F16;&#x8BD1;&#x8FDB;&#x7CFB;&#x7EDF;&#x3002;</p>
<p>Sretain_static_relocation &#x4F1A;&#x4FDD;&#x7559;&#x9759;&#x6001;&#x7C7B;&#x578B;&#x7684;&#x4EE3;&#x7801;&#x5BF9;&#x8C61;&#x91CD;&#x5B9A;&#x4F4D;&#x4FE1;&#x606F;&#xFF0C;&#x4E3A;&#x83B7;&#x5F97;compute-size&#x53CA;&#x76F8;&#x5173;&#x8FC7;&#x7A0B;&#x7684;&#x4F18;&#x52BF;&#xFF0C;&#x8FD9;&#x4E9B;&#x4EE3;&#x7801;&#x5BF9;&#x8C61;&#x7531;heap compaction&#x521B;&#x5EFA;&#x3002;</p>
<p>Scompact_heap&#x538B;&#x7F29;Scheme&#x7684;&#x5806;&#xFF0C;&#x5C06;&#x5F53;&#x524D;&#x6240;&#x6709;&#x5806;&#x4E2D;&#x7684;&#x5BF9;&#x8C61;&#x653E;&#x5165;&#x9759;&#x6001;&#x7C7B;&#x578B;(static generation)&#x3002;&#x5728;&#x9759;&#x6001;&#x7C7B;&#x578B;&#x4E2D;&#x7684;&#x5BF9;&#x8C61;&#x4E0D;&#x4F1A;&#x88AB;&#x56DE;&#x6536;&#x3002;&#x4E5F;&#x5C31;&#x662F;&#x8BF4;&#xFF0C;&#x5B83;&#x4EEC;&#x6C38;&#x8FDC;&#x4E0D;&#x4F1A;&#x5728;&#x56DE;&#x6536;&#x8FC7;&#x7A0B;&#x4E2D;&#x88AB;&#x79FB;&#x52A8;&#x5E76;&#x4E14;&#x5B83;&#x4EEC;&#x7684;&#x5B58;&#x50A8;&#x7A7A;&#x95F4;&#x6C38;&#x8FDC;&#x4E0D;&#x4F1A;&#x88AB;&#x6536;&#x56DE;&#xFF0C;&#x751A;&#x81F3;&#x5B83;&#x4EEC;&#x53D8;&#x5F97;&#x4E0D;&#x53EF;&#x8BBF;&#x95EE;&#x3002;Scompact_heap&#x5728;&#x4EFB;&#x4F55;boot&#x6587;&#x4EF6;&#x52A0;&#x8F7D;&#x540E;&#x4F1A;&#x88AB;&#x9690;&#x5F0F;&#x8C03;&#x7528;&#x3002;</p>
<p>Sscheme_deinit &#x5173;&#x95ED;&#x4EFB;&#x4F55;&#x6253;&#x5F00;&#x7684;&#x6587;&#x4EF6;&#xFF0C;&#x64A4;&#x56DE;Scheme heap&#xFF0C;&#x5C06;Scheme&#x7CFB;&#x7EDF;&#x53D8;&#x6210;&#x672A;&#x521D;&#x59CB;&#x5316;&#x72B6;&#x6001;&#x3002;</p>
<p><strong>&#x5224;&#x65AD;</strong>&#x3002;&#x8FD9;&#x91CC;&#x8868;&#x8FF0;&#x7684;&#x5224;&#x65AD;&#x51FD;&#x6570;&#x4E0E;Scheme&#x4E2D;&#x7684;&#x5224;&#x65AD;&#x51FD;&#x6570;&#x540D;&#x5B57;&#x76F8;&#x7C7B;&#x4F3C;&#x3002;&#x5224;&#x65AD;&#x51FD;&#x6570;&#x4EE5;&#x5B57;&#x6BCD;p&#x7ED3;&#x5C3E;&#xFF0C;&#x7528;&#x4E8E;&#x66FF;&#x6362;&#x5728;Scheme&#x5224;&#x65AD;&#x51FD;&#x6570;&#x540D;&#x5B57;&#x540E;&#x9762;&#x5E38;&#x89C1;&#x7684;&#x95EE;&#x53F7;&#x3002;&#x6BCF;&#x4E2A;&#x5224;&#x65AD;&#x63A5;&#x6536;&#x5355;&#x4E2A;Scheme&#x5BF9;&#x8C61;&#xFF0C;&#x8FD4;&#x56DE;&#x4E00;&#x4E2A;&#x5E03;&#x5C14;&#x503C;(C integer)&#x3002;</p>
<pre><code>[macro] int Sfixnump(ptr obj)
[macro] int Scharp(ptr obj)
[macro] int Snullp(ptr obj)
[macro] int Seof_objectp(ptr obj)
[macro] int Sbwp_objectp(ptr obj)
[macro] int Sbooleanp(ptr obj)
[macro] int Spairp(ptr obj)
[macro] int Ssymbolp(ptr obj)
[macro] int Sprocedurep(ptr obj)
[macro] int Sflonump(ptr obj)
[macro] int Svectorp(ptr obj)
[macro] int Sbytevectorp(ptr obj)
[macro] int Sfxvectorp(ptr obj)
[macro] int Sstringp(ptr obj)
[macro] int Sbignump(ptr obj)
[macro] int Sboxp(ptr obj)
[macro] int Sinexactnump(ptr obj)
[macro] int Sexactnump(ptr obj)
[macro] int Sratnump(ptr obj)
[macro] int Sinputportp(ptr obj)
[macro] int Soutputportp(ptr obj)
[macro] int Srecordp(ptr obj)
</code></pre><p><strong>&#x8BBF;&#x95EE;&#x5668;</strong>&#x3002;&#x90E8;&#x5206;&#x5728;&#x8FD9;&#x91CC;&#x4ECB;&#x7ECD;&#x7684;&#x8BBF;&#x95EE;&#x5668;&#x5BF9;&#x5E94;Scheme&#x8FC7;&#x7A0B;&#x4E2D;&#x7C7B;&#x4F3C;&#x7684;&#x540D;&#x5B57;&#xFF0C;&#x4F46;&#x662F;&#x6709;&#x4E9B;&#x53EA;&#x5728;&#x8BE5;&#x63A5;&#x53E3;&#x4E2D;&#x3002;Sfixnum_value&#xFF0C; Schar_value&#xFF0C; Sboolean_value&#xFF0C;&#x548C;Sflonum_value&#x8FD4;&#x56DE;C&#x7B49;&#x6548;&#x7684;Scheme&#x503C;&#x3002;</p>
<pre><code>[macro] iptr Sfixnum_value(ptr fixnum)
[macro] uptr Schar_value(ptr character)
[macro] int Sboolean_value(ptr obj)
[macro] double Sflonum_value(ptr flonum)
</code></pre><p>Sinteger_value &#x548C; Sunsigned_value &#x4E0E; Sfixnum_value &#x7C7B;&#x4F3C;&#xFF0C;&#x9664;&#x4E86;&#x4ED6;&#x4EEC;&#x4E0D;&#x53EA;&#x63A5;&#x53D7; fixnum &#x53C2;&#x6570;&#xFF0C;&#x4E5F;&#x63A5;&#x53D7;&#x5728;C integer&#x6216;unsinged&#x503C;&#x8303;&#x56F4;&#x5185;&#x7684; bignum &#x53C2;&#x6570;&#x3002;Sinteger_value &#x548C;Sunsigned_value &#x63A5;&#x53D7;&#x4E0E;Scheme integer&#x76F8;&#x540C;&#x7684;&#x8303;&#x56F4;&#x3002;&#x4ED6;&#x4EEC;&#x7684;&#x533A;&#x522B;&#x53EA;&#x5728;&#x8FD4;&#x56DE;&#x7C7B;&#x578B;&#xFF0C;&#x6240;&#x4EE5;&#x5141;&#x8BB8;&#x5BF9;&#x8D1F;&#x503C;&#x6216;unsigned&#x5927;&#x6570;&#x503C;&#x7684;&#x4E0D;&#x540C;&#x89E3;&#x91CA;&#x3002;</p>
<pre><code>[func] iptr Sinteger_value(ptr integer)
[macro] uptr Sunsigned_value(ptr integer)
</code></pre><p>Sinteger32_value, Sunsigned32_value, Sinteger64_value, &#x548C;Sunsigned64_value &#x63A5;&#x53D7;32&#x4F4D;&#x6216;64&#x4F4D;&#x8303;&#x56F4;&#x7684;signed &#x6216; unsigned Scheme integers&#xFF0C;&#x5E76;&#x4E14;&#x6839;&#x636E;&#x673A;&#x5668;&#x7C7B;&#x578B;&#x8FD4;&#x56DE;&#x5408;&#x9002;&#x7684;integers&#x3002;</p>
<pre><code>[func] &lt;32-bit int type&gt; Sinteger32_value(ptr integer)
[macro] &lt;32-bit unsigned type&gt; Sunsigned32_value(ptr integer)
[func] &lt;64-bit int type&gt; Sinteger64_value(ptr integer)
[macro] &lt;64-bit unsigned type&gt; Sunsigned64_value(ptr integer)
</code></pre><p>Scar, Scdr, Ssymbol_to_string (&#x5BF9;&#x5E94;symbol-&gt;string), and Sunbox&#x4E0E;&#x4ED6;&#x4EEC;&#x5728;Scheme&#x4E2D;&#x7684;&#x5BF9;&#x5E94;&#x51FD;&#x6570;&#x76F8;&#x540C;&#x3002;</p>
<pre><code>[macro] ptr Scar(ptr pair)
[macro] ptr Scdr(ptr pair)
[macro] ptr Ssymbol_to_string(ptr sym)
[macro] ptr Sunbox(ptr box)
</code></pre><p>Sstring_length, Svector_length, Sbytevector_length, &#x548C; Sfxvector_length &#x90FD;&#x8FD4;&#x56DE;&#x4E00;&#x4E2A;&#x4EE3;&#x8868;&#x5BF9;&#x8C61;&#x4E2D;&#x5143;&#x7D20;&#x4E2A;&#x6570;&#x7684; C integer&#x503C;&#x3002;</p>
<pre><code>[macro] iptr Sstring_length(ptr str)
[macro] iptr Svector_length(ptr vec)
[macro] iptr Sbytevector_length(ptr bytevec)
[macro] iptr Sfxvector_length(ptr fxvec)
</code></pre><p>Sstring_ref, Svector_ref, Sbytevector_u8_ref, &#x548C; Sfxvector_ref &#x5BF9;&#x5E94;&#x5B83;&#x4EEC;&#x5728;Scheme&#x4E2D;&#x7684;&#x76F8;&#x5E94;&#x51FD;&#x6570;&#xFF0C;&#x9664;&#x4E86;index&#x53C2;&#x6570;&#x662F;C integers&#xFF0C;Sstring_ref&#x7684;&#x8FD4;&#x56DE;&#x503C;&#x662F;&#x4E00;&#x4E2A;C char&#x7C7B;&#x578B;&#x503C;&#xFF0C;Sbytevector_u8_ref&#x7684;&#x8FD4;&#x56DE;&#x503C;&#x662F;&#x4E00;&#x4E2A;octet (unsigned char)&#x3002;</p>
<pre><code>[macro] char Sstring_ref(ptr str, iptr i)
[macro] ptr Svector_ref(ptr vec, iptr i)
[macro] octet Sbytevector_u8_ref(ptr fxvec, iptr i)
[macro] ptr Sfxvector_ref(ptr fxvec, iptr i)
</code></pre><p>Scheme bytevector &#x8868;&#x793A;&#x4E00;&#x4E2A;&#x957F;&#x5EA6;&#x57DF;&#x7D27;&#x8DDF;&#x4E00;&#x4E2A;octet&#xFF08;unsigned chars&#xFF09;&#x5E8F;&#x5217;&#x3002;Sbytevector_data &#x8FD4;&#x56DE;&#x4E00;&#x4E2A;&#x6307;&#x5411;octets&#x5E8F;&#x5217;&#x5F00;&#x59CB;&#x7684;&#x6307;&#x9488;&#x3002;&#x5728;&#x4EFB;&#x4F55;Scheme&#x4EE3;&#x7801;&#x6267;&#x884C;&#x524D;&#xFF0C;&#x505C;&#x6B62;&#x89E3;&#x5F15;&#x7528;&#x7531;Sbytevector_data&#x8FD4;&#x56DE;&#x7684;&#x6307;&#x9488;&#x6216;&#x8005;&#x9501;&#x5B9A;bytevector&#xFF08;&#x89C1;&#x4E0B;&#x9762;&#x7684;Slock_object&#xFF09;&#x5230;&#x5185;&#x5B58;&#x90FD;&#x9700;&#x8981;&#x6781;&#x5176;&#x5C0F;&#x5FC3;&#xFF0C;&#x65E0;&#x8BBA;&#x662F;&#x901A;&#x8FC7;&#x8C03;&#x7528;&#x8FDB;&#x5165;Scheme&#x6216;&#x8005;&#x4ECE;Scheme&#x8C03;&#x7528;&#x4E2D;&#x8FD4;&#x56DE;&#x3002;&#x5B58;&#x50A8;&#x7BA1;&#x7406;&#x5668;&#x4F1A;&#x91CD;&#x5B9A;&#x4F4D;&#x6216;&#x8005;&#x56DE;&#x6536;&#x6307;&#x9488;&#x6240;&#x6307;&#x7684;&#x5BF9;&#x8C61;&#xFF0C;&#x5E76;&#x4E14;&#x4F1A;&#x5C06;&#x5176;&#x4ED6;&#x6570;&#x636E;&#x62F7;&#x8D1D;&#x5230;&#x8BE5;&#x5BF9;&#x8C61;&#x3002;
&#xFF08;&#x8BD1;&#x8005;&#x6CE8;&#xFF1A;&#x8FD9;&#x91CC;&#x539F;&#x6587;&#x6709;&#x62FC;&#x5199;&#x9519;&#x8BEF;&#xFF0C;unsignec chars -&gt; unsigned chars&#xFF09;</p>
<p><code>[macro] octet * Sbytevector_data(ptr bytevec)</code></p>
<p><strong>&#x5B58;&#x53D6;&#x5668;</strong>&#x3002;&#x6539;&#x53D8;&#x5305;&#x542B;&#x6307;&#x9488;&#x7684;&#x5B58;&#x53D6;&#x5BF9;&#x8C61;&#xFF0C;&#x5982;pairs&#x4F55;vectors&#xFF0C;&#x5FC5;&#x987B;&#x4EE3;&#x8868;&#x5B58;&#x50A8;&#x7BA1;&#x7406;&#x5668;&#x8FDB;&#x884C;&#x8DDF;&#x8E2A;&#xFF0C;&#x53C2;&#x8003;&#x6587;&#x732E;[13]&#x3002;&#x8FD9;&#x91CC;&#x4ECB;&#x7ECD;&#x7684;&#x64CD;&#x4F5C;&#x5728;&#x9700;&#x8981;&#x65F6;&#x81EA;&#x52A8;&#x6267;&#x884C;&#x8FD9;&#x79CD;&#x8DDF;&#x8E2A;&#x3002;</p>
<pre><code>[func] void Sset_box(ptr box, ptr obj)
[func] void Sset_car(ptr pair, ptr obj)
[func] void Sset_cdr(ptr pair, ptr obj)
[macro] void Sstring_set(ptr str, iptr i, char c)
[func] void Svector_set(ptr vec, iptr i, ptr obj)
[macro] void Sbytevector_u8_set(ptr bytevec, iptr i, octet n)
[macro] void Sfxvector_set(ptr fxvec, iptr i, ptr fixnum)
</code></pre><p>&#x4E00;&#x4E9B;Scheme&#x5BF9;&#x8C61;&#xFF0C;&#x4F8B;&#x5982;procedures&#x548C;numbers&#x662F;&#x4E0D;&#x53EF;&#x53D8;&#x7684;&#xFF0C;&#x6240;&#x4EE5;&#x6CA1;&#x6709;&#x63D0;&#x4F9B;&#x53EF;&#x4EE5;&#x6539;&#x53D8;&#x8FD9;&#x4E9B;&#x5185;&#x5BB9;&#x7684;&#x64CD;&#x4F5C;&#x3002;</p>
<p><strong>&#x6784;&#x9020;&#x5668;</strong>&#x3002;&#x8FD9;&#x91CC;&#x4ECB;&#x7ECD;&#x7684;&#x6784;&#x9020;&#x5668;&#x7528;&#x4E8E;&#x521B;&#x5EFA;Scheme&#x5BF9;&#x8C61;&#x3002;&#x4E00;&#x4E9B;&#x5BF9;&#x8C61;&#xFF0C;&#x5982;fixnums&#x548C;empty list&#xFF0C;&#x7528;&#x77AC;&#x65F6;&#x503C;&#x8868;&#x793A;&#xFF0C;&#x5B83;&#x4EEC;&#x4E0D;&#x9700;&#x8981;&#x4EFB;&#x4F55;&#x5806;&#x5206;&#x914D;&#xFF0C;&#x4F8B;&#x5982;pairs&#x548C;vectors&#x8868;&#x793A;&#x4E3A;&#x6307;&#x5411;&#x5806;&#x5206;&#x914D;&#x5BF9;&#x8C61;&#x7684;&#x6307;&#x9488;&#x3002;</p>
<p>Snil, Strue, Sfalse, Sbwp_object, Seof_object, &#x548C;Svoid &#x521B;&#x5EFA;&#x5E38;&#x91CF;&#x77AC;&#x65F6;&#x503C;&#xFF0C;&#x8868;&#x793A;&#x7A7A;list&#xFF08;()&#xFF09;&#xFF0C;&#x5E03;&#x5C14;&#x503C;(#t&#x548C;#f)&#xFF0C;broken-weak-pointer&#x5BF9;&#x8C61;(#!bwp)&#xFF0C;eof&#x5BF9;&#x8C61;(#!eof)&#xFF0C;&#x548C;void&#x5BF9;&#x8C61;&#x3002;</p>
<pre><code>[macro] ptr Snil
[macro] ptr Strue
[macro] ptr Sfalse
[macro] ptr Sbwp_object
[macro] ptr Seof_object
[macro] ptr Svoid
</code></pre><p>Fixnums, characters, booleans, flonums, &#x548C; strings &#x53EF;&#x4EE5;&#x7528;&#x5B83;&#x4EEC;&#x5728;C&#x4E2D;&#x7B49;&#x4EF7;&#x65B9;&#x5F0F;&#x521B;&#x5EFA;&#x3002;</p>
<pre><code>[macro] ptr Sfixnum(iptr n)
[macro] ptr Schar(char c)
[macro] ptr Sboolean(int b)
[func] ptr Sflonum(double x)
[func] ptr Sstring(const char *s)
[func] ptr Sstring_of_length(const char *s, iptr n)
[func] ptr Sstring_utf8(const char *s, iptr n)
</code></pre><p>Sstring &#x521B;&#x5EFA;&#x4E00;&#x4E2A;C&#x5B57;&#x7B26;&#x4E32;s &#x7684;Scheme&#x62F7;&#x8D1D;&#xFF0C;&#x800C;Sstring_of_length&#x521B;&#x5EFA;&#x4E00;&#x4E2A;&#x957F;&#x5EA6;&#x4E3A;n&#xFF0C;&#x4ECE;s&#x4E2D;&#x62F7;&#x8D1D;&#x524D;n&#x5B57;&#x8282;&#x7684;&#x65B0;Scheme string&#x3002;</p>
<p>&#x5982;&#x679C;C&#x5B57;&#x7B26;&#x4E32;&#x4EE5;UTF-8&#x7F16;&#x7801;&#xFF0C;&#x4F7F;&#x7528;Sstring_utf8&#x3002;&#x6307;&#x5B9A;n&#x4E2A;&#x5B57;&#x8282;&#x957F;&#x5EA6;&#xFF0C;&#x6216;&#x8005;&#x4F7F;&#x7528;-1&#x6307;&#x5B9A;&#x76F4;&#x5230;&apos;\0&apos;&#x7ED3;&#x675F;&#x3002;</p>
<p>&#x53EF;&#x4EE5;&#x5224;&#x65AD;&#x4E00;&#x4E2A;C integer&#x662F;&#x5426;&#x5728;fixnum&#x7684;&#x8303;&#x56F4;&#x5185;&#xFF0C;&#x901A;&#x8FC7;&#x6BD4;&#x8F83;fixnum&#x7684;&#x503C;&#x4E0E;&#x901A;&#x8FC7;fixnum &#x4ECE;C integer&#x521B;&#x5EFA;&#x7684;&#x503C;&#x3002;</p>
<p><code>#define fixnum_rangep(x) (Sfixnum_value(Sfixnum(x)) == x)</code></p>
<p>Sinteger &#x548C; Sunsigned &#x53EF;&#x7528;&#x4E8E;&#x521B;&#x5EFA;Scheme integers&#xFF0C;&#x65E0;&#x8BBA;&#x5B83;&#x4EEC;&#x662F;&#x5426;&#x5728;fixnum&#x8303;&#x56F4;&#x5185;&#x3002;</p>
<pre><code>[func] ptr Sinteger(iptr n)
[func] ptr Sunsigned(uptr n)
</code></pre><p>Sinteger &#x548C; Sunsigned &#x5728;&#x5BF9;&#x5F85;C integer&#x8D1F;&#x503C;&#x548C;C unsigned integer&#x503C;&#x65F6;&#x6709;&#x6240;&#x4E0D;&#x540C;&#xFF0C;&#x5982;&#x679C;&#x5B83;&#x4EEC;&#x8F6C;&#x6362;&#x4E3A;integers&#x4F1A;&#x51FA;&#x73B0;&#x8D1F;&#x503C;&#x3002;Sinteger &#x628A;&#x8FD9;&#x4E9B;&#x503C;&#x8F6C;&#x6362;&#x6210;&#x8D1F;&#x7684;Scheme&#x503C;&#xFF0C;&#x4F46;&#x662F;Sunsigned &#x628A;&#x8FD9;&#x4E9B;&#x503C;&#x8F6C;&#x6362;&#x6210;Scheme&#x6B63;&#x503C;&#x3002;&#x4F8B;&#x5982;&#xFF0C;&#x5047;&#x8BBE;32&#x4F4D;&#x4E24;&#x79CD;&#x5BF9;&#x4E8E;iptrs&#x4E92;&#x8865;&#x7684;&#x8868;&#x793A;&#xFF0C;Sinteger(-1)&#x548C;Sunsigned((iptr)0xffffffff) &#x90FD;&#x8F6C;&#x6362;&#x4E3A;Scheme integer -1&#xFF0C;Sunsigned(0xffffffff) &#x548C; Sunsigned((uptr)-1) &#x90FD;&#x88AB;&#x8F6C;&#x6362;&#x4E3A;Scheme integer #xffffffff(4294967295)&#x3002;</p>
<p>&#x65E0;&#x8BBA;&#x4F7F;&#x7528;&#x54EA;&#x4E2A;&#x51FD;&#x6570;&#xFF0C;Sinteger_value &#x548C; Sunsigned_value &#x603B;&#x4F1A;&#x91CD;&#x65B0;&#x4EA7;&#x751F;&#x5BF9;&#x5E94;&#x7684;C &#x8F93;&#x5165;&#x503C;&#xFF0C;&#x56E0;&#x6B64;&#x4E0B;&#x9762;&#x7684;&#x8BED;&#x53E5;&#x90FD;&#x7B49;&#x6548;&#x4E8E;x&#xFF0C;&#x5982;&#x679C;x&#x662F;iptr&#x3002;</p>
<pre><code>Sinteger_value(Sinteger(x))
(iptr)Sunsigned_value(Sinteger(x))
Sinteger_value(Sunsigned((uptr)x))
(iptr)Sunsigned_value(Sunsigned((uptr)x))
</code></pre><p>&#x7C7B;&#x4F3C;&#x5730;&#xFF0C;&#x4E0B;&#x9762;&#x7684;&#x8BED;&#x53E5;&#x90FD;&#x7B49;&#x6548;&#x4E8E;&#xFF0C;&#x5982;&#x679C;x&#x662F;uptr&#x3002;</p>
<pre><code>(uptr)Sinteger_value(Sinteger((iptr)x))
Sunsigned_value(Sinteger((iptr)x))
(uptr)Sinteger_value(Sunsigned(x))
Sunsigned_value(Sunsigned(x))
</code></pre><p>Sinteger32, Sunsigned32, Sinteger64, &#x548C; Sunsigned64 &#x4E0E;&#x4E0A;&#x9762;&#x7684;&#x7C7B;&#x4F3C;&#xFF0C;&#x4F46;&#x662F;&#x5C06;&#x5B83;&#x4EEC;&#x7684;&#x53C2;&#x6570;&#x9650;&#x5236;&#x5728;32&#x4F4D;&#x6216;64&#x4F4D;&#x8303;&#x56F4;&#x3002;</p>
<pre><code>[func] ptr Sinteger32(&lt;32-bit int type&gt; n)
[func] ptr Sunsigned32(&lt;32-bit unsigned type&gt; n)
[func] ptr Sinteger64(&lt;64-bit int type&gt; n)
[func] ptr Sunsigned64(&lt;64-bit unsigned type&gt; n)
</code></pre><p>Scons &#x548C; Sbox &#x4E0E;&#x5B83;&#x4EEC;&#x5728;Scheme&#x4E2D;&#x7684;&#x5BF9;&#x5E94;&#x51FD;&#x6570;&#x76F8;&#x540C;&#x3002;</p>
<pre><code>[func] ptr Scons(ptr obj1, ptr obj2)
[func] ptr Sbox(ptr obj)
</code></pre><p>Sstring_to_symbol &#x4E0E;&#x5176;&#x5728;Scheme&#x4E2D;&#x7684;&#x5BF9;&#x5E94;&#x51FD;&#x6570;&#x7C7B;&#x4F3C;, string-&gt;symbol, &#x9664;&#x4E86;&#x5B83;&#x63A5;&#x53D7;C&#x5B57;&#x7B26;&#x4E32;&#x4F5C;&#x4E3A;&#x8F93;&#x5165;&#x3002;</p>
<pre><code>[func] ptr Sstring_to_symbol(const char *s)
</code></pre><p>Smake_string, Smake_vector, Smake_bytevector, &#x548C; Smake_fxvector &#x4E0E;&#x5B83;&#x4EEC;&#x5728;Scheme&#x4E2D;&#x7684;&#x5BF9;&#x5E94;&#x51FD;&#x6570;&#x76F8;&#x540C;&#x3002;</p>
<pre><code>[func] ptr Smake_string(iptr n, int c)
[func] ptr Smake_vector(iptr n, ptr obj)
[func] ptr Smake_bytevector(iptr n, int fill)
[func] ptr Smake_fxvector(iptr n, ptr fixnum)
</code></pre><p>Smake_uninitialized_string &#x4E0E;&#x4E00;&#x4E2A;&#x53C2;&#x6570;&#x7684;make-string&#x51FD;&#x6570;&#x7C7B;&#x4F3C;&#x3002;</p>
<p><code>[func] ptr Smake_uninitialized_string(iptr n)</code></p>
<p><strong>Windows&#x9650;&#x5B9A;&#x5E2E;&#x52A9;&#x51FD;&#x6570;</strong>&#x3002;&#x4E0B;&#x9762;&#x7684;&#x5E2E;&#x52A9;&#x51FD;&#x6570;&#x53EA;&#x5728;Windows&#x4E2D;&#x63D0;&#x4F9B;&#x3002;</p>
<p><code>[func] char * Sgetenv(const char * name)</code></p>
<p>Sgetenv &#x8FD4;&#x56DE; UTF-8-encoded &#x73AF;&#x5883;&#x53D8;&#x91CF;&#x540D;&#x7684; UTF-8-encoded &#x503C;&#xFF0C;&#x5982;&#x679C;&#x8BE5;&#x503C;&#x5B58;&#x5728;&#xFF0C;&#x5426;&#x5219;&#x4E3A;NULL&#x3002;&#x5F53;&#x8FD4;&#x56DE;&#x503C;&#x4E0D;&#x518D;&#x9700;&#x8981;&#x65F6;&#xFF0C;&#x8981;&#x7528;free&#x91CA;&#x653E;&#x6389;&#x8FD4;&#x56DE;&#x503C;&#x3002;</p>
<pre><code>[func] wchar_t * Sutf8_to_wide(const char *s)
[func] char * Swide_to_utf8(const wchar_t *s)
</code></pre><p>&#xFF08;&#x8BD1;&#x8005;&#x6CE8;&#xFF1A;&#x539F;&#x6587;&#x4E2D;s&#x524D;&#x9762;&#x6709;\&#xFF09;</p>
<p>Sutf8_to_wide &#x548C; Swide_to_utf8 &#x80FD;&#x5C06;&apos;\0&apos;&#x7ED3;&#x5C3E;&#x7684;&#x5B57;&#x7B26;&#x4E32;&#x5728;UTF-8-encoded &#x4E0E; UTF-16LE-encoded&#x4E24;&#x8005;&#x95F4;&#x8F6C;&#x6362;&#x3002;&#x5F53;&#x8FD4;&#x56DE;&#x503C;&#x4E0D;&#x518D;&#x9700;&#x8981;&#x65F6;&#xFF0C;&#x8981;&#x7528;free&#x91CA;&#x653E;&#x6389;&#x8FD4;&#x56DE;&#x503C;&#x3002;</p>
<p><strong>&#x8BBF;&#x95EE;top-level&#x503C;</strong>&#x3002;&#x9876;&#x5C42;&#x53D8;&#x91CF;&#x7ED1;&#x5B9A;&#x80FD;&#x901A;&#x8FC7;Stop_level_value&#x8BBF;&#x95EE;&#xFF0C;&#x6216;&#x8005;&#x901A;&#x8FC7;Sset_top_level_value&#x8D4B;&#x503C;&#x3002;</p>
<pre><code>[func] ptr Stop_level_value(ptr sym)
[func] void Sset_top_level_value(ptr sym, ptr obj)
</code></pre><p>&#x8FD9;&#x4E9B;&#x8FC7;&#x7A0B;&#x7ED9;&#x51FA;&#x5728;&#x539F;&#x59CB;&#x4EA4;&#x4E92;&#x73AF;&#x5883;&#x4E2D;&#x7ED1;&#x5B9A;&#x7684;&#x5FEB;&#x901F;&#x8BBF;&#x95EE;&#xFF0C;&#x5E76;&#x4E14;&#x4E0D;&#x53CD;&#x5E94;&#x5BF9;&#x4EA4;&#x4E92;&#x73AF;&#x5883;&#x53C2;&#x6570;&#x6216;&#x9876;&#x5C42;&#x5BFC;&#x5165;&#x6A21;&#x5757;&#x7684;&#x4FEE;&#x6539;&#x3002;&#x8BBF;&#x95EE;&#x5F53;&#x524D;&#x4EA4;&#x4E92;&#x73AF;&#x5883;&#x7ED1;&#x5B9A;&#x7684;symbol&#xFF0C;&#x5FC5;&#x987B;&#x8C03;&#x7528;Scheme&#x7684;top-level-value&#x548C;set-top-level-value!&#x51FD;&#x6570;&#x3002;</p>
<p><strong>&#x9501;&#x5B9A;Scheme&#x5BF9;&#x8C61;</strong>&#x3002;&#x50A8;&#x5B58;&#x7BA1;&#x7406;&#x5668;&#x4E3A;&#x4E86;&#x56DE;&#x6536;&#x7A7A;&#x95F4;&#x548C;&#x538B;&#x7F29;&#x5806;&#x4F1A;&#x5468;&#x671F;&#x6027;&#x91CD;&#x65B0;&#x5B9A;&#x4F4D;&#x5BF9;&#x8C61;&#x3002;&#x8BE5;&#x91CD;&#x5B9A;&#x4F4D;&#x8FC7;&#x7A0B;&#x5BF9;&#x4E8E;Scheme&#x7A0B;&#x5E8F;&#x5B8C;&#x5168;&#x900F;&#x660E;&#xFF0C;&#x56E0;&#x4E3A;&#x6240;&#x6709;&#x91CD;&#x65B0;&#x5B9A;&#x4F4D;&#x7684;&#x5BF9;&#x8C61;&#x7684;&#x6307;&#x9488;&#x4F1A;&#x88AB;&#x66F4;&#x65B0;&#x4E3A;&#x6307;&#x5411;&#x5BF9;&#x8C61;&#x7684;&#x65B0;&#x5730;&#x5740;&#x3002;&#x4F46;&#x662F;&#xFF0C;&#x50A8;&#x5B58;&#x7BA1;&#x7406;&#x5668;&#x4E0D;&#x80FD;&#x66F4;&#x65B0;&#x5728;Scheme&#x5806;&#x5916;&#x7684;Scheme&#x6307;&#x9488;&#x3002;</p>
<p>&#x901A;&#x5E38;&#x89C4;&#x5219;&#x4E0B;&#xFF0C;&#x6240;&#x6709;&#x6765;&#x81EA;C&#x53D8;&#x91CF;&#x7684;&#x6307;&#x9488;&#x6216;Scheme&#x5BF9;&#x8C61;&#x7684;&#x6570;&#x636E;&#x7ED3;&#x6784;&#x5728;&#x8FDB;&#x5165;&#xFF08;&#x6216;&#x91CD;&#x65B0;&#x8FDB;&#x5165;&#xFF09;Scheme&#x4E4B;&#x524D;&#x5E94;&#x8BE5;&#x88AB;&#x4E22;&#x5F03;&#x3002;&#x5373;&#x5982;&#x679C;C&#x8FC7;&#x7A0B;&#x6536;&#x5230;&#x6765;&#x81EA;Scheme&#x6216;&#x901A;&#x8FC7;&#x672C;&#x8282;&#x4E2D;&#x7684;&#x673A;&#x5236;&#x83B7;&#x53D6;&#x7684;&#x5BF9;&#x8C61;&#xFF0C;&#x6240;&#x6709;&#x7684;&#x5BF9;&#x8C61;&#x6307;&#x9488;&#x5E94;&#x8BE5;&#x88AB;&#x8BA4;&#x4E3A;&#x662F;&#x65E0;&#x6548;&#x7684;&#xFF0C;&#x4E00;&#x65E6;C&#x8FC7;&#x7A0B;&#x8C03;&#x7528;&#x8FDB;&#x5165;Scheme&#x4E2D;&#xFF0C;&#x6216;&#x8005;&#x8FD4;&#x56DE;&#x5230;Scheme&#x3002;&#x5BF9;&#x65E0;&#x6548;&#x6307;&#x9488;&#x89E3;&#x5F15;&#x7528;&#x6216;&#x4F20;&#x9012;&#x56DE;Scheme&#x4F1A;&#x5BFC;&#x81F4;&#x707E;&#x96BE;&#x6027;&#x540E;&#x679C;&#xFF0C;&#x5305;&#x62EC;&#x4E0D;&#x53EF;&#x6062;&#x590D;&#x7684;&#x5185;&#x5B58;&#x6BB5;&#x9519;&#x8BEF;&#x3002;&#x524D;&#x8FF0;&#x5185;&#x5BB9;&#x4E0D;&#x9002;&#x7528;&#x77AC;&#x65F6;&#x5BF9;&#x8C61;&#xFF0C;&#x5982;fixnums, characters, booleans, &#x6216;&#x8005;&#x7A7A;list&#x3002;&#x9002;&#x7528;&#x4E8E;&#x6240;&#x6709;&#x5728;&#x5806;&#x4E0A;&#x5206;&#x914D;&#x7684;&#x5BF9;&#x8C61;&#xFF0C;&#x5305;&#x542B;pairs, vectors, strings, &#x6240;&#x6709;&#x7684;numbers&#x9664;&#x4E86;fixnums&#xFF0C;ports&#xFF0C;procedures&#xFF0C;&#x548C;records&#x3002;</p>
<p>&#x5B9E;&#x8DF5;&#x4E2D;&#xFF0C;&#x4FDD;&#x8BC1;C&#x4EE3;&#x7801;&#x4E0D;&#x4FDD;&#x5B58;Scheme&#x5BF9;&#x8C61;&#x7684;&#x6307;&#x9488;&#x7684;&#x6700;&#x597D;&#x65B9;&#x6CD5;&#x662F;&#xFF1A;&#x5982;&#x679C;&#x53EF;&#x80FD;&#x7684;&#x8BDD;&#xFF0C;&#x7ACB;&#x5373;&#x628A;Scheme&#x5BF9;&#x8C61;&#x8F6C;&#x5316;&#x6210;C&#x7684;&#x7B49;&#x6548;&#x3002;&#x5728;&#x7279;&#x5B9A;&#x7684;&#x60C5;&#x51B5;&#x4E0B;&#xFF0C;&#x4E0D;&#x53EF;&#x80FD;&#x8FD9;&#x4E48;&#x505A;&#xFF0C;&#x90A3;&#x4E48;Scheme&#x5BF9;&#x8C61;&#x7684;&#x4FDD;&#x7559;&#x662F;&#x7A0B;&#x5E8F;&#x7684;C&#x90E8;&#x5206;&#x8BBE;&#x8BA1;&#x7684;&#x5FC5;&#x987B;&#x5185;&#x5BB9;&#x3002;&#x5728;&#x8FD9;&#x4E9B;&#x60C5;&#x51B5;&#x4E0B;&#xFF0C;&#x5BF9;&#x8C61;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;&#x5E93;&#x51FD;&#x6570;Slock_object&#x9501;&#x5B9A;&#xFF08;&#x6216;&#x8005;&#xFF0C;&#x5728;Scheme&#x4E2D;&#x7528;&#x7B49;&#x6548;&#x7684;lock-object&#x8FC7;&#x7A0B;&#xFF09;</p>
<p><code>[func] void Slock_object(ptr obj)</code></p>
<p>&#x9501;&#x5B9A;&#x4E00;&#x4E2A;&#x5BF9;&#x8C61;&#x9632;&#x6B62;&#x50A8;&#x5B58;&#x7BA1;&#x7406;&#x5668;&#x56DE;&#x6536;&#x6216;&#x91CD;&#x5B9A;&#x4F4D;&#x5BF9;&#x8C61;&#x3002;&#x9501;&#x5B9A;&#x8981;&#x5C3D;&#x91CF;&#x5C11;&#x7528;&#xFF0C;&#x56E0;&#x4E3A;&#x5176;&#x4F1A;&#x5F15;&#x5165;&#x5185;&#x5B58;&#x788E;&#x7247;&#xFF0C;&#x589E;&#x52A0;&#x50A8;&#x5B58;&#x7BA1;&#x7406;&#x8D1F;&#x62C5;&#x3002;&#x5982;&#x679C;&#x5BF9;&#x8C61;&#x6CA1;&#x6709;&#x88AB;&#x89E3;&#x9501;&#x7684;&#x8BDD;&#xFF0C;&#x9501;&#x5B9A;&#x4E5F;&#x4F1A;&#x5BFC;&#x81F4;&#x50A8;&#x5B58;&#x7A7A;&#x95F4;&#x7684;&#x610F;&#x5916;&#x4FDD;&#x7559;&#x3002;&#x9501;&#x5B9A;&#x90A3;&#x4E9B;&#x5DF2;&#x7ECF;&#x901A;&#x8FC7;&#x5806;&#x538B;&#x7F29;(&#x89C1;&#x4E0A;&#x9762;&#x7684;Scompact_heap)&#x53D8;&#x6210;&#x9759;&#x6001;&#x7684;&#x5BF9;&#x8C61;&#x4E0D;&#x4F46;&#x662F;&#x4E0D;&#x5FC5;&#x8981;&#x7684;&#xFF0C;&#x800C;&#x4E14;&#x662F;&#x6709;&#x5BB3;&#x7684;&#x3002;</p>
<p>&#x5BF9;&#x8C61;&#x53EF;&#x901A;&#x8FC7;Sunlock_object&#x89E3;&#x9501;&#xFF08;unlock-object&#xFF09;&#x3002;</p>
<p><code>[func] void Sunlock_object(ptr obj)</code></p>
<p>&#x901A;&#x8FC7;&#x8FDE;&#x7EED;&#x8C03;&#x7528;Slock_object&#x6216;lock-object&#xFF0C;&#x5BF9;&#x8C61;&#x53EF;&#x4EE5;&#x88AB;&#x591A;&#x6B21;&#x9501;&#x5B9A;&#xFF0C;&#x5728;&#x8BE5;&#x60C5;&#x51B5;&#x4E0B;&#xFF0C;&#x5728;&#x5176;&#x6B63;&#x5728;&#x89E3;&#x9501;&#x524D;&#xFF0C;&#x5FC5;&#x987B;&#x901A;&#x8FC7;&#x8C03;&#x7528;&#x76F8;&#x540C;&#x6B21;&#x6570;&#x7684;Sunlock_object&#x6216;unlock-object&#x6765;&#x89E3;&#x9501;&#x8BE5;&#x5BF9;&#x8C61;&#x3002;</p>
<p>&#x51FD;&#x6570;Sunlocked_objectp&#x7528;&#x4E8E;&#x5224;&#x65AD;&#x5BF9;&#x8C61;&#x662F;&#x5426;&#x9501;&#x5B9A;&#x3002;</p>
<p><code>[func] int Sunlocked_objectp(ptr obj)</code></p>
<p>&#x5F53;&#x5916;&#x90E8;&#x8FC7;&#x7A0B;&#x8C03;&#x7528;&#x8FDB;&#x5165;Scheme&#x65F6;&#xFF0C;&#x6307;&#x5411;Scheme&#x4EE3;&#x7801;&#x5BF9;&#x8C61;&#x7684;&#x8FD4;&#x56DE;&#x5730;&#x5740;&#x4E0E;&#x5916;&#x90E8;&#x8FC7;&#x7A0B;&#x88AB;&#x9690;&#x5F0F;&#x4F20;&#x9012;&#x7ED9;C&#x51FD;&#x6570;&#x3002;&#x56E0;&#x6B64;&#x7CFB;&#x7EDF;&#x4F1A;&#x5728;&#x4ECE;C&#x8C03;&#x7528;&#x8FD4;&#x56DE;Scheme&#x524D;&#x9501;&#x5B9A;&#x4EE3;&#x7801;&#x5BF9;&#x8C61;&#xFF0C;&#x4ECE;Scheme&#x8FD4;&#x56DE;&#x540E;&#x518D;&#x89E3;&#x9501;&#x3002;&#x9501;&#x5B9A;&#x88AB;&#x81EA;&#x52A8;&#x6267;&#x884C;&#xFF1B;&#x7528;&#x6237;&#x4EE3;&#x7801;&#x4E0D;&#x9700;&#x8981;&#x9501;&#x5B9A;&#x8FD9;&#x4E9B;&#x4EE3;&#x7801;&#x5BF9;&#x8C61;&#x3002;</p>
<p>&#x5728;&#x9501;&#x5B9A;&#x5BF9;&#x8C61;&#x4E2D;&#x7684;&#x5BF9;&#x8C61;&#xFF0C;&#x4F8B;&#x5982;&#x5728;&#x9501;&#x5B9A;&#x7684;pair&#x7684;car&#x4E2D;&#x7684;&#x5BF9;&#x8C61;&#xFF0C;&#x4E00;&#x822C;&#x4E0D;&#x9700;&#x8981;&#x9501;&#x5B9A;&#xFF0C;&#x9664;&#x975E;&#x53E6;&#x5916;&#x6709;&#x4E2A;C&#x6307;&#x9488;&#x6307;&#x5411;&#x8BE5;&#x5BF9;&#x8C61;&#x3002;</p>
<p>&#x6CE8;&#x518C;&#x5916;&#x90E8;&#x5165;&#x53E3;&#x70B9;&#x3002;&#x901A;&#x8FC7;Sforeign_symbol&#x6216;Sregister_symbol&#x53EF;&#x4F7F;&#x5916;&#x90E8;&#x5165;&#x53E3;&#x70B9;&#x5BF9;Scheme&#x53EF;&#x89C1;&#x3002;</p>
<pre><code>[func] void Sforeign_symbol(const char *name, void *addr)
[func] void Sregister_symbol(const char *name, void *addr)
</code></pre><p>objects&#x6587;&#x4EF6;&#x6216;&#x901A;&#x8FC7;load-shared-object&#x52A0;&#x8F7D;&#x7684;&#x5171;&#x4EAB;&#x5BF9;&#x8C61;&#x4E2D;&#x7684;&#x5916;&#x90E8;&#x5165;&#x53E3;&#x70B9;&#x81EA;&#x52A8;&#x5BF9;&#x7CFB;&#x7EDF;&#x53EF;&#x89C1;&#x3002;&#x4E00;&#x65E6;&#x5916;&#x90E8;&#x5165;&#x53E3;&#x70B9;&#x53EF;&#x89C1;&#xFF0C;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;foreign-procedure&#x8868;&#x8FBE;&#x5F0F;&#x521B;&#x5EFA;&#x5165;&#x53E3;&#x70B9;&#x7684;Scheme&#x53EF;&#x8C03;&#x7528;&#x7248;&#x672C;&#x3002;Sforeign_symbol&#x548C;Sregister_symbol&#x5141;&#x8BB8;&#x7A0B;&#x5E8F;&#x6CE8;&#x518C;&#x975E;&#x5916;&#x90E8;&#x5165;&#x53E3;&#x70B9;&#xFF0C;&#x4E0E;Chez Scheme&#x9759;&#x6001;&#x94FE;&#x63A5;&#x7684;&#x4EE3;&#x7801;&#x4E2D;&#x7684;&#x5165;&#x53E3;&#x70B9;&#xFF0C;&#x548C;&#x76F4;&#x63A5;&#x4ECE;C&#x52A0;&#x8F7D;&#x7684;&#x4EE3;&#x7801;&#x7684;&#x5165;&#x53E3;&#x70B9;&#xFF0C;&#x4F8B;&#x5982;&#x4E0D;&#x9002;&#x7528;load-shared-object&#x3002;Sforeign_symbol&#x548C;Sregister_symbol&#x552F;&#x4E00;&#x7684;&#x533A;&#x522B;&#x662F;&#x5F53;&#x5C1D;&#x8BD5;&#x6CE8;&#x518C;&#x5DF2;&#x7ECF;&#x5B58;&#x5728;&#x7684;&#x540D;&#x5B57;&#x65F6;Sforeign_symbol&#x4F1A;&#x629B;&#x51FA;&#x5F02;&#x5E38;&#xFF0C;&#x800C;Sregister_symbol&#x5141;&#x8BB8;&#x91CD;&#x65B0;&#x5B9A;&#x4E49;&#x5DF2;&#x5B58;&#x5728;&#x7684;&#x540D;&#x5B57;&#x3002;</p>
<p><strong>&#x83B7;&#x53D6;Scheme&#x5165;&#x53E3;&#x70B9;</strong>&#x3002;Sforeign_callable_entry_point &#x4ECE;&#x7531;foreign-callable&#x4EA7;&#x751F;&#x7684;&#x4EE3;&#x7801;&#x5BF9;&#x8C61;&#x4E2D;&#x83B7;&#x53D6;&#x5165;&#x53E3;&#x70B9;&#xFF0C;&#x6267;&#x884C;&#x4E0E;&#x5176;&#x5728;Scheme&#x4E2D;&#x5BF9;&#x5E94;&#x51FD;&#x6570;&#x7684;&#x76F8;&#x540C;&#x64CD;&#x4F5C;&#xFF0C;&#x5373;Scheme&#x8FC7;&#x7A0B;foreign-callable-entry-point&#x3002;</p>
<p><code>[func] (void (*) (void)) Sforeign_callable_entry_point(ptr code)</code></p>
<p>&#x8FD9;&#x53EF;&#x88AB;&#x7528;&#x4E8E;&#x9632;&#x6B62;&#x4ECE;&#x4EE3;&#x7801;&#x5BF9;&#x8C61;&#x5230;&#x5730;&#x5740;&#x7684;&#x8F6C;&#x6362;&#xFF0C;&#x76F4;&#x5230;&#x771F;&#x6B63;&#x9700;&#x8981;&#x8FD9;&#x4E48;&#x505A;&#x65F6;&#x624D;&#x8FDB;&#x884C;&#xFF0C;&#x8FD9;&#x53EF;&#x4EE5;&#x5728;&#x6709;&#x4E9B;&#x60C5;&#x51B5;&#x4E0B;&#x6D88;&#x9664;&#x9501;&#x5B9A;&#x4EE3;&#x7801;&#x5BF9;&#x8C61;&#x7684;&#x9700;&#x8981;&#xFF0C;&#x5982;&#x679C;&#x518D;&#x6B21;&#x8C03;&#x7528;&#x8FD4;&#x56DE;Scheme&#xFF0C;&#x4EE3;&#x7801;&#x5BF9;&#x8C61;&#x6CA1;&#x6709;&#x88AB;&#x4FDD;&#x5B58;&#x3002;</p>
<p>Sforeign_callable_code_object&#x6267;&#x884C;&#x76F8;&#x53CD;&#x7684;&#x8F6C;&#x6362;&#x3002;</p>
<p><code>[func] ptr Sforeign_callable_code_object((void (*addr)(void)))</code></p>
<p><strong>Scheme&#x8C03;&#x7528;&#x7684;&#x5E95;&#x5C42;&#x652F;&#x6301;</strong>&#x3002;&#x4E0B;&#x9762;&#x7684;&#x51FD;&#x6570;&#x63D0;&#x4F9B;&#x4ECE;C&#x8C03;&#x7528;Scheme&#x8FC7;&#x7A0B;&#x7684;&#x652F;&#x6301;&#x3002;&#x4E0B;&#x9762;&#x7684;&#x51FD;&#x6570;&#x80FD;&#x591F;&#x8C03;&#x7528;&#x63A5;&#x6536;&#x5C0F;&#x6570;&#x76EE;&#x53C2;&#x6570;&#xFF08;0-3&#xFF09;&#x7684;Scheme&#x8FC7;&#x7A0B;&#x3002;</p>
<pre><code>[func] ptr Scall0(ptr procedure)
[func] ptr Scall1(ptr procedure, ptr obj1)
[func] ptr Scall2(ptr procedure, ptr obj1, ptr obj2)
[func] ptr Scall3(ptr procedure, ptr obj1, ptr obj2, ptr obj3)
</code></pre><p>&#x5728;&#x6BCF;&#x79CD;&#x60C5;&#x51B5;&#x4E0B;&#xFF0C;&#x7B2C;&#x4E00;&#x4E2A;&#x53C2;&#x6570;procedure&#x5FC5;&#x987B;&#x662F;Scheme&#x8FC7;&#x7A0B;&#x3002;&#x5269;&#x4E0B;&#x7684;&#x53C2;&#x6570;&#xFF0C;&#x5FC5;&#x987B;&#x662F;&#x4F20;&#x9012;&#x7ED9;&#x8FC7;&#x7A0B;&#x7684;Scheme&#x5BF9;&#x8C61;&#x3002;&#x672C;&#x8282;&#x524D;&#x9762;&#x4ECB;&#x7ECD;&#x7684;&#x5DE5;&#x5177;&#x53EF;&#x7528;&#x4E8E;&#x5C06;C&#x6570;&#x636E;&#x7C7B;&#x578B;&#x8F6C;&#x6362;&#x4E3A;Scheme&#x7684;&#x7B49;&#x4EF7;&#x7C7B;&#x578B;&#x3002;&#x4ECE;&#x7C7B;&#x4F3C;foreign-callable&#x8868;&#x8FBE;&#x5F0F;&#x7684;&#x58F0;&#x660E;&#x81EA;&#x52A8;&#x4EA7;&#x751F;&#x8F6C;&#x6362;&#x4EE3;&#x7801;&#x7684;&#x7A0B;&#x5E8F;&#x4E0E;Chez Scheme&#x4E00;&#x8D77;&#x53D1;&#x5E03;&#x3002;&#x5728;&#x5927;&#x591A;&#x6570;&#x7CFB;&#x7EDF;&#x4E0A;&#xFF0C;&#x53EF;&#x4EE5;&#x5728;Scheme&#x5E93;&#x76EE;&#x5F55;&#x4E2D;&#x88AB;&#x627E;&#x5230;&#xFF0C;&#x5728;&#x201C;foreign.ss&#x201D;&#x6587;&#x4EF6;&#x4E2D;&#x3002;</p>
<p>Scheme&#x8FC7;&#x7A0B;&#x53EF;&#x901A;&#x8FC7;&#x591A;&#x79CD;&#x65B9;&#x6CD5;&#x83B7;&#x5F97;&#x3002;&#x4F8B;&#x5982;&#xFF0C;&#x4ECE;Scheme&#x5230;C&#x7684;&#x8C03;&#x7528;&#x65F6;&#x4F5C;&#x4E3A;&#x53C2;&#x6570;&#x63A5;&#x6536;&#x5230;&#x7684;&#xFF0C;&#x901A;&#x8FC7;&#x53E6;&#x5916;&#x4E00;&#x4E2A;&#x4ECE;C&#x5230;Scheme&#x7684;&#x8C03;&#x7528;&#x4E2D;&#x83B7;&#x5F97;&#x7684;&#xFF0C;&#x4ECE;Scheme&#x6570;&#x636E;&#x7ED3;&#x6784;&#x4E2D;&#x83B7;&#x5F97;&#x7684;&#xFF0C;&#x6216;&#x8005;&#x901A;&#x8FC7;Stop_level_value&#x4ECE;&#x9876;&#x5C42;&#x73AF;&#x5883;&#x4E2D;&#x83B7;&#x5F97;&#x7684;&#x3002;</p>
<p>&#x4E0B;&#x9762;&#x51FD;&#x6570;&#x6D89;&#x53CA;&#x957F;&#x53C2;&#x6570;&#x8868;&#x7684;&#x66F4;&#x901A;&#x7528;&#x7684;&#x63A5;&#x53E3;&#x3002;</p>
<pre><code>[func] void Sinitframe(iptr n)
[func] void Sput_arg(iptr i, ptr obj)
[func] ptr Scall(ptr procedure, iptr n)
</code></pre><p>C&#x8FC7;&#x7A0B;&#x9996;&#x5148;&#x4EE5;&#x4E00;&#x4E2A;&#x53C2;&#x6570;&#x8C03;&#x7528;Sinitframe&#xFF0C;&#x5373;&#x4F20;&#x9012;&#x7ED9;Scheme&#x7684;&#x53C2;&#x6570;&#x4E2A;&#x6570;&#x3002;&#x7136;&#x540E;&#x5BF9;&#x6BCF;&#x4E2A;&#x53C2;&#x6570;&#x8C03;&#x7528;Sput_arg&#xFF08;&#x4EE5;&#x4EFB;&#x610F;&#x987A;&#x5E8F;&#xFF09;&#xFF0C;&#x6307;&#x5B9A;Sput_arg&#x7684;&#x53C2;&#x6570;&#x6570;&#x5B57;&#xFF08;&#x4EE5;1&#x5F00;&#x59CB;&#xFF09;&#x548C;&#x53C2;&#x6570;&#x3002;&#x6700;&#x540E;&#xFF0C;&#x8C03;&#x7528;Scall&#x6267;&#x884C;&#x8C03;&#x7528;&#xFF0C;&#x6307;&#x5B9A;Scheme&#x8FC7;&#x7A0B;&#x548C;&#x53C2;&#x6570;&#x4E2A;&#x6570;&#xFF08;&#x4E0E;Sinitframe&#x8C03;&#x7528;&#x4E2D;&#x76F8;&#x540C;&#x7684;&#x6570;&#x5B57;&#xFF09;&#x3002;&#x7A0B;&#x5E8F;&#x5458;&#x5FC5;&#x987B;&#x786E;&#x4FDD;&#x5728;&#x5C1D;&#x8BD5;&#x4EFB;&#x4F55;&#x5176;&#x4ED6;Scheme&#x8C03;&#x7528;&#x548C;&#x4ECE;Scheme&#x8FD4;&#x56DE;&#x524D;&#xFF0C;Scheme&#x8C03;&#x7528;&#x901A;&#x8FC7;Sinitframe&#x521D;&#x59CB;&#x5316;&#xFF0C;&#x4EE5;Scall&#x7ED3;&#x675F;&#x3002;&#x5982;&#x679C;&#x7531;&#x4E8E;&#x4EFB;&#x4F55;&#x539F;&#x56E0;&#x8C03;&#x7528;&#x5728;Sinitframe&#x5DF2;&#x7ECF;&#x88AB;&#x8C03;&#x7528;&#x540E;&#x6CA1;&#x6709;&#x5B8C;&#x6210;&#xFF0C;&#x90A3;&#x5C31;&#x4E0D;&#x80FD;&#x591F;&#x518D;&#x8FD4;&#x56DE;Scheme&#x4E86;&#x3002;</p>
<p>&#x4E0B;&#x4F8B;&#x7528;&#x4E8E;&#x5C55;&#x793A;&#x4E0A;&#x8FF0;&#x7B80;&#x5355;&#x63A5;&#x53E3;&#x548C;&#x901A;&#x7528;&#x63A5;&#x53E3;&#x3002;</p>
<pre><code>/* &#x7279;&#x522B;&#x50BB;&#x7684;&#x4E24;&#x4E2A;&#x6D6E;&#x70B9;&#x6570;&#x76F8;&#x4E58;&#x7684;&#x65B9;&#x6CD5; */
double mul(double x, double y) {
    ptr times = Stop_level_value(Sstring_to_symbol(&quot;*&quot;));

    return Sflonum_value(Scall2(times, Sflonum(x), Sflonum(y)));
}

/* &#x4E00;&#x6837;&#x50BB;&#x7684;&#x4F7F;&#x7528;&#x4E94;&#x4E2A;&#x53C2;&#x6570;&#x8C03;&#x7528;printf&#x7684;&#x65B9;&#x6CD5;*/

/* &#x6700;&#x597D;&#x5B9A;&#x4E49;&#x5982;&#x4E0B;&#x6240;&#x793A;&#x7684;&#x63A5;&#x53E3;&#x7528;&#x4E8E;&#x8C03;&#x7528;&#x8FDB;&#x5165;Scheme,&#x8FD9;&#x6837;&#x53EF;&#x4EE5;&#x9632;&#x6B62;&#x610F;&#x5916;&#x521B;&#x5EFA;&#x5D4C;&#x5957;&#x5E27;&#xFF0C;
 * &#x5E2E;&#x52A9;&#x786E;&#x4FDD;&#x521D;&#x59CB;&#x5316;&#x8C03;&#x7528;&#x5982;&#x4E0A;&#x6240;&#x8FF0;&#x5B8C;&#x6210;&#x3002;&#x7279;&#x5B9A;&#x7684;&#x7248;&#x672C;&#x4E3A;&#x7279;&#x5B9A;&#x7684;C&#x53C2;&#x6570;&#x7C7B;&#x578B;&#x91CF;&#x8EAB;&#x5B9A;&#x5236;&#xFF0C;
 * &#x5185;&#x90E8;&#x53EF;&#x5D4C;&#x5165;Scheme&#x5BF9;&#x8C61;&#x8F6C;&#x6362;&#x64CD;&#x4F5C;&#x3002;
 */
ptr Scall5(ptr p, ptr x1, ptr x2, ptr x3, ptr x4, ptr x5) {
    Sinitframe(5);
    Sput_arg(1, x1);
    Sput_arg(2, x2);
    Sput_arg(3, x3);
    Sput_arg(4, x4);
    Sput_arg(5, x5);
    Scall(p, 5);
}

static void dumpem(char *s, int a, double b, ptr c, char *d) {
    printf(s, a, b, c, d);
}

static void foo(int x, double y, ptr z, char *s) {
    ptr ois, sip, read, expr, eval, c_dumpem;
    char *sexpr = &quot;(foreign-procedure \&quot;dumpem\&quot; (string integer-32\
 double-float scheme-object string) void)&quot;;

  /* &#x8FD9;&#x4E00;&#x7CFB;&#x5217;&#x8BED;&#x53E5;&#x662F;&#x7ECF;&#x8FC7;&#x5C0F;&#x5FC3;&#x659F;&#x914C;&#x7684;&#xFF0C;&#x4E3A;&#x4E86;&#x907F;&#x514D;&#x5728;&#x8FDB;&#x5165;Scheme&#x540E;&#x5F15;&#x7528;&#x5305;&#x542B;Scheme&#x5BF9;&#x8C61;&#x7684;&#x53D8;&#x91CF; */
    ois = Stop_level_value(Sstring_to_symbol(&quot;open-input-string&quot;));
    sip = Scall1(ois, Sstring(sexpr));
    read = Stop_level_value(Sstring_to_symbol(&quot;read&quot;));
    expr = Scall1(read, sip);
    eval = Stop_level_value(Sstring_to_symbol(&quot;eval&quot;));
    Sforeign_symbol(&quot;dumpem&quot;, (void *)dumpem);
    c_dumpem = Scall1(eval, expr);
    Scall5(c_dumpem,
           Sstring(&quot;x = %d, y = %g, z = %x, s = %s\n&quot;),
           Sinteger(x),
           Sflonum(y),
           z,
           Sstring(s));
}
</code></pre><p>&#x4ECE; C &#x5230; Scheme &#x7684;&#x8C03;&#x7528;&#x4E0D;&#x5E94;&#x8BE5;&#x53D1;&#x751F;&#x5728;C&#x4E2D;&#x65AD;&#x5904;&#x7406;&#x51FD;&#x6570;&#x4E2D;&#x3002;&#x5F53;Scheme&#x8C03;&#x7528;C&#x65F6;&#xFF0C;&#x7CFB;&#x7EDF;&#x4FDD;&#x5B58;&#x7279;&#x5B9A;&#x7684;&#x5BC4;&#x5B58;&#x5668;&#x5185;&#x5BB9;&#x5230;&#x4E00;&#x4E2A;&#x5BC4;&#x5B58;&#x5668;&#x4FDD;&#x5B58;&#x533A;&#x57DF;&#x3002;&#x5F53;C&#x8C03;&#x7528;Scheme&#x65F6;&#xFF0C;&#x5BC4;&#x5B58;&#x5668;&#x4ECE;&#x5BC4;&#x5B58;&#x5668;&#x4FDD;&#x5B58;&#x533A;&#x57DF;&#x6062;&#x590D;&#x3002;&#x56E0;&#x4E3A;&#x4E2D;&#x65AD;&#x53EF;&#x53D1;&#x751F;&#x5728;&#x8BA1;&#x7B97;&#x7684;&#x4EFB;&#x4F55;&#x70B9;&#x5904;&#xFF0C;&#x5BC4;&#x5B58;&#x5668;&#x5185;&#x5BB9;&#x4FDD;&#x5B58;&#x4F4D;&#x7F6E;&#x53EF;&#x80FD;&#x5305;&#x542B;&#x65E0;&#x6548;&#x4FE1;&#x606F;&#xFF0C;&#x4F1A;&#x5BFC;&#x81F4;Scheme&#x7CFB;&#x7EDF;&#x5931;&#x8D25;&#xFF0C;&#x53D1;&#x751F;&#x4E0D;&#x6B63;&#x5E38;&#x64CD;&#x4F5C;&#x3002;</p>
<p><strong>&#x6FC0;&#x6D3B;&#xFF0C;&#x6291;&#x5236;&#xFF0C;&#x9500;&#x6BC1;&#x7EBF;&#x7A0B;</strong>&#x3002;&#x591A;&#x7EBF;&#x7A0B;&#x7248;&#x672C;&#x7684;Scheme&#x63D0;&#x4F9B;&#x4E0B;&#x9762;&#x4E09;&#x4E2A;&#x51FD;&#x6570;&#xFF0C;&#x5F53;&#x4E00;&#x4E2A;&#x7EBF;&#x7A0B;&#x9700;&#x8981;&#x6FC0;&#x6D3B;&#xFF0C;&#x6291;&#x5236;&#xFF0C;&#x9500;&#x6BC1;&#x65F6;&#xFF0C;&#x5141;&#x8BB8;C&#x4EE3;&#x7801;&#x901A;&#x77E5;Scheme&#x3002;</p>
<pre><code>[func] int Sactivate_thread(void)
[func] void Sdeactivate_thread(void)
[func] int Sdestroy_thread(void)
</code></pre><p>&#x901A;&#x8FC7;Scheme&#x8FC7;&#x7A0B;fork-thread&#x53EF;&#x4EE5;&#x521B;&#x5EFA;&#x4E00;&#x4E2A;&#x6FC0;&#x6D3B;&#x72B6;&#x6001;&#x7684;&#x7EBF;&#x7A0B;&#xFF0C;&#x4E0D;&#x9700;&#x8981;&#x518D;&#x6FC0;&#x6D3B;&#x3002;&#x4EFB;&#x4F55;&#x6CA1;&#x88AB;&#x6FC0;&#x6D3B;&#x7684;&#x7EBF;&#x7A0B;&#xFF0C;&#x6216;&#x8005;&#x7531;&#x9664;fork-thread&#x5916;&#x7684;&#x5176;&#x4ED6;&#x673A;&#x5236;&#x521B;&#x5EFA;&#x7684;&#x7EBF;&#x7A0B;&#xFF0C;&#x5728;&#x8BBF;&#x95EE;Scheme&#x6570;&#x636E;&#x6216;Scheme&#x6267;&#x884C;&#x4EE3;&#x7801;&#x4E4B;&#x524D;&#x5FC5;&#x987B;&#x88AB;&#x6FC0;&#x6D3B;&#x3002;&#x7531;__collect_safe&#x58F0;&#x660E;&#x7684;&#x5916;&#x90E8;&#x53EF;&#x8C03;&#x7528;&#x51FD;&#x6570;&#x80FD;&#x591F;&#x6FC0;&#x6D3B;&#x8C03;&#x7528;&#x7684;&#x7EBF;&#x7A0B;&#x3002;&#x5426;&#x5219;&#xFF0C;&#x5FC5;&#x987B;&#x7528;Sactivate_thread&#x6765;&#x6FC0;&#x6D3B;&#x7EBF;&#x7A0B;&#x3002;&#x7EBF;&#x7A0B;&#x7B2C;&#x4E00;&#x6B21;&#x6FC0;&#x6D3B;&#x540E;&#x51FD;&#x6570;&#x8FD4;&#x56DE;1&#xFF0C;&#x76F4;&#x5230;&#x6FC0;&#x6D3B;&#x7684;&#x7EBF;&#x7A0B;&#x88AB;Sdestroy_thread&#x9500;&#x6BC1;&#x524D;&#xFF0C;&#x540E;&#x7EED;&#x6BCF;&#x4E2A;&#x8C03;&#x7528;&#x90FD;&#x8FD4;&#x56DE;0&#x3002;</p>
<p>&#x5F53;&#x6FC0;&#x6D3B;&#x72B6;&#x6001;&#x7684;&#x7EBF;&#x7A0B;&#x5728;C&#x4EE3;&#x7801;&#x4E2D;&#x65F6;&#x4F1A;&#x963B;&#x6B62;&#x5B58;&#x50A8;&#x7BA1;&#x7406;&#x7CFB;&#x7EDF;&#x7684;&#x5783;&#x573E;&#x56DE;&#x6536;&#x8FC7;&#x7A0B;&#xFF0C;&#x5F53;&#x53EF;&#x80FD;&#x4F1A;&#x82B1;&#x5927;&#x91CF;&#x7684;&#x65F6;&#x95F4;&#x5728;C&#x4EE3;&#x7801;&#x4E2D;&#x65F6;&#xFF0C;&#x7EBF;&#x7A0B;&#x5FC5;&#x987B;&#x901A;&#x8FC7;Sdeactivate_thread&#x6291;&#x5236;&#xFF0C;&#x6216;&#x8005;&#x901A;&#x8FC7;__collect_safe&#x58F0;&#x660E;&#x7684;foreign-procedure&#x3002;&#x5F53;&#x7EBF;&#x7A0B;&#x8C03;&#x7528;C&#x5E93;&#x51FD;&#x6570;&#x65F6;&#x8FD9;&#x5C24;&#x5176;&#x91CD;&#x8981;&#xFF0C;&#x4F8B;&#x5982;read&#xFF0C;&#x8BE5;&#x51FD;&#x6570;&#x53EF;&#x80FD;&#x4F1A;&#x4E0D;&#x5B9A;&#x671F;&#x7684;&#x963B;&#x585E;&#x3002;&#x7EBF;&#x7A0B;&#x4E00;&#x65E6;&#x88AB;&#x6291;&#x5236;&#xFF0C;&#x7EBF;&#x7A0B;&#x5FC5;&#x987B;&#x4E0D;&#x80FD;&#x63A5;&#x89E6;&#x4EFB;&#x4F55;Scheme&#x6570;&#x636E;&#x6216;&#x6267;&#x884C;&#x4EFB;&#x4F55;Scheme&#x4EE3;&#x7801;&#x76F4;&#x5230;&#x88AB;&#x91CD;&#x65B0;&#x6FC0;&#x6D3B;&#xFF0C;&#x4F46;&#x6709;&#x4E00;&#x4E2A;&#x4F8B;&#x5916;&#x3002;&#x4F8B;&#x5916;&#x5C31;&#x662F;&#x7EBF;&#x7A0B;&#x53EF;&#x4EE5;&#x8BBF;&#x95EE;&#x6216;&#x8005;&#x751A;&#x81F3;&#x4FEE;&#x6539;&#x9501;&#x5B9A;&#x7684;Scheme&#x5BF9;&#x8C61;&#xFF0C;&#x4F8B;&#x5982;&#x9501;&#x5B9A;&#x7684;&#x5B57;&#x7B26;&#x4E32;&#xFF0C;&#x5176;&#x4E0D;&#x5305;&#x542B;&#x4EFB;&#x4F55;&#x6307;&#x5411;&#x672A;&#x9501;&#x5B9A;&#x7684;Scheme&#x5BF9;&#x8C61;&#x3002;&#xFF08;&#x5F53;&#x7EBF;&#x7A0B;&#x5728;&#x6CA1;&#x6709;&#x6FC0;&#x6D3B;&#x65F6;&#xFF0C;&#x6CA1;&#x88AB;&#x9501;&#x5B9A;&#x7684;&#x5BF9;&#x8C61;&#x53EF;&#x80FD;&#x4F1A;&#x88AB;&#x5783;&#x573E;&#x56DE;&#x6536;&#x5668;&#x91CD;&#x65B0;&#x5B9A;&#x4F4D;&#x3002;&#xFF09;</p>
<p>Sdestroy_thread &#x7528;&#x4E8E;&#x901A;&#x77E5;Scheme&#x7CFB;&#x7EDF;&#x7EBF;&#x7A0B;&#x88AB;&#x5173;&#x95ED;&#xFF0C;&#x5E76;&#x4E14;&#x4EFB;&#x4F55;&#x4E0E;&#x7EBF;&#x7A0B;&#x76F8;&#x5173;&#x7684;&#x6570;&#x636E;&#x53EF;&#x4EE5;&#x88AB;&#x91CA;&#x653E;&#x3002;</p>
<p><strong>&#x5E95;&#x5C42;&#x540C;&#x6B65;&#x57FA;&#x672C;&#x51FD;&#x6570;</strong>&#x3002;&#x5934;&#x6587;&#x4EF6;&#x5B9A;&#x4E49;&#x51E0;&#x4E2A;&#x9884;&#x5904;&#x7406;&#x5B8F;&#xFF0C;&#x53EF;&#x7528;&#x4E8E;&#x4E0E;&#x5BF9;&#x5E94;ftype&#x9501;&#x64CD;&#x4F5C;&#x65B9;&#x5F0F;&#x76F8;&#x540C;&#x7684;&#x9501;&#x5B9A;&#x5185;&#x5B58;&#x5730;&#x5740;&#x64CD;&#x4F5C;&#xFF08;&#x89C1;15.4&#x548C;15.5&#xFF09;&#x3002;</p>
<pre><code>[macro] void INITLOCK(void *addr)
[macro] void SPINLOCK(void *addr)
[macro] void UNLOCK(void *addr)
[macro] void LOCKED_INCR(void *addr, int *ret)
[macro] void LOCKED_DECR(void *addr, int *ret)
</code></pre><p>LOCKED_INCR &#x548C; LOCKED_DECR &#x8BBE;&#x7F6E;ret&#x4E3A;&#x4E00;&#x4E2A;&#x975E;&#x96F6;(true)&#x503C;&#xFF0C;&#x5982;&#x679C;&#x589E;&#x52A0;&#x6216;&#x51CF;&#x5C11;&#x7684;&#x503C;&#x4E3A;0&#x3002;&#x5426;&#x8005;&#x5B83;&#x4EEC;&#x4F1A;&#x628A;ret&#x7F6E;0&#x3002;</p>
<h2 id="49-&#x793A;&#x4F8B;&#xFF1A;&#x5957;&#x63A5;&#x5B57;&#x64CD;&#x4F5C;-example-socket-operations">4.9 &#x793A;&#x4F8B;&#xFF1A;&#x5957;&#x63A5;&#x5B57;&#x64CD;&#x4F5C; (Example: Socket Operations)</h2>
<p>&#x8BE5;&#x8282;&#x5C55;&#x793A;&#x4E86;&#x4F7F;&#x7528;Scheme&#x548C;C&#x4EE3;&#x7801;&#x7ED3;&#x5408;&#x7684;&#x4E00;&#x4E2A;&#x7B80;&#x5355;&#x7684;socket&#x63A5;&#x53E3;&#x3002;C&#x4EE3;&#x7801;&#x5B9A;&#x4E49;&#x4E86;&#x4E00;&#x7EC4;&#x65B9;&#x4FBF;&#x7684;&#x5E95;&#x5C42;&#x64CD;&#x4F5C;&#x7CFB;&#x7EDF;&#x63A5;&#x53E3;&#xFF0C;&#x7528;&#x4E8E;&#x5728;&#x66F4;&#x9AD8;&#x5C42;&#x7EA7;&#x7684;Scheme&#x4EE3;&#x7801;&#x4E2D;&#x5B9E;&#x73B0;&#x6253;&#x5F00;&#xFF0C;&#x5173;&#x95ED;&#xFF0C;&#x8BFB;&#x53D6;&#xFF0C;&#x5199;&#x5165;sockets&#x3002;</p>
<p>C&#x4EE3;&#x7801;&#xFF08;csocket.c&#xFF09;&#x5728;&#x4E0B;&#x9762;&#x7ED9;&#x51FA;&#xFF0C;&#x7D27;&#x63A5;&#x7740;&#x662F;Scheme&#x4EE3;&#x7801;&#xFF08;socket.ss&#xFF09;&#x3002;&#x4EE3;&#x7801;&#x9700;&#x8981;&#x5F88;&#x5C11;&#x6216;&#x8005;&#x65E0;&#x9700;&#x4FEE;&#x6539;&#x5C31;&#x80FD;&#x5728;&#x5927;&#x591A;&#x6570;Unix&#x7CFB;&#x7EDF;&#x4E2D;&#x8FD0;&#x884C;&#xFF0C;&#x4E14;&#x53EF;&#x4EE5;&#x88AB;&#x4FEE;&#x6539;&#x5728;windows&#x4E0B;&#x8FD0;&#x884C;&#xFF08;&#x4F7F;&#x7528;Windows&#x7684;WinSock&#x63A5;&#x53E3;&#xFF09;&#x3002;</p>
<p>&#x4EE3;&#x7801;&#x540E;&#x9762;&#x6709;&#x4E00;&#x4E2A;&#x4F1A;&#x8BDD;&#x4F8B;&#x5B50;&#xFF0C;&#x5C55;&#x793A;&#x4E86;socket&#x63A5;&#x53E3;&#x3002;&#x5728;9.7&#x4E2D;&#x6709;&#x4E00;&#x4E2A;&#x4F8B;&#x5B50;&#xFF0C;&#x5C55;&#x793A;&#x4E86;&#x5982;&#x4F55;&#x4F7F;&#x7528;&#x8BE5;socket&#x63A5;&#x53E3;&#x5EFA;&#x7ACB;&#x4E00;&#x4E2A;&#x8FDB;&#x7A0B;&#x7AEF;&#x53E3;&#xFF0C;&#x5141;&#x8BB8;&#x901A;&#x8FC7;Scheme&#x7AEF;&#x53E3;&#x900F;&#x660E;&#x7684;&#x8BFB;&#x53D6;&#x548C;&#x5199;&#x5165;&#x5B50;&#x8FDB;&#x7A0B;&#x3002;</p>
<p><strong>C code.</strong></p>
<pre><code>/* csocket.c */

#include &lt;sys/types.h&gt;
#include &lt;sys/socket.h&gt;
#include &lt;sys/un.h&gt;
#include &lt;string.h&gt;
#include &lt;errno.h&gt;
#include &lt;signal.h&gt;
#include &lt;sys/ioctl.h&gt;
#include &lt;stdio.h&gt;
#include &lt;unistd.h&gt;

/* c_write &#x5C1D;&#x8BD5;&#x5199;&#x5165;&#x6574;&#x4E2A;&#x7F13;&#x51B2;&#xFF0C;&#x901A;&#x8FC7;&#x4E2D;&#x65AD;&#xFF0C;socket&#x5EF6;&#x65F6;&#x548C;&#x90E8;&#x5206;&#x7F13;&#x51B2;&#x5199;&#x5165;&#x3002;*/
int c_write(int fd, char *buf, ssize_t start, ssize_t n) {
    ssize_t i, m;

    buf += start;
    m = n;
    while (m &gt; 0) {
        if ((i = write(fd, buf, m)) &lt; 0) {
            if (errno != EAGAIN &amp;&amp; errno != EINTR)
                return i;
        } else {
            m -= i;
            buf += i;
        }
    }
    return n;
}

/* c_read &#x901A;&#x8FC7;&#x4E2D;&#x65AD;&#x548C;socket&#x5EF6;&#x65F6;*/
int c_read(int fd, char *buf, size_t start, size_t n) {
    int i;

    buf += start;
    for (;;) {
        i = read(fd, buf, n);
        if (i &gt;= 0) return i;
        if (errno != EAGAIN &amp;&amp; errno != EINTR) return -1;
    }
}

/* bytes_ready(fd) &#x8FD4;&#x56DE;true&#xFF0C;&#x5982;&#x679C;&#x5728;id&#x4E3A;fd&#x7684;socket&#x4E2D;&#x6709;&#x53EF;&#x8BFB;&#x7684;&#x5B57;&#x8282;*/
int bytes_ready(int fd) {
    int n;

    (void) ioctl(fd, FIONREAD, &amp;n);
    return n;
}

/* socket &#x652F;&#x6301;*/

/* do_socket() &#x521B;&#x5EFA;&#x4E00;&#x4E2A;&#x65B0;&#x7684; AF_UNIX socket */
int do_socket(void) {
    return socket(AF_UNIX, SOCK_STREAM, 0);
}

/* do_bind(s, name) &#x7ED1;&#x5B9A;name &#x5230;socket s */
int do_bind(int s, char *name) {
    struct sockaddr_un sun;
    int length;

    sun.sun_family = AF_UNIX;
    (void) strcpy(sun.sun_path, name);
    length = sizeof(sun.sun_family) + sizeof(sun.sun_path);

    return bind(s, (struct sockaddr*)(&amp;sun), length);
}

/* do_accept &#x63A5;&#x6536;&#x5728;socket s&#x4E0A;&#x7684;&#x8FDE;&#x63A5; */
int do_accept(int s) {
    struct sockaddr_un sun;
    socklen_t length;

    length = sizeof(sun.sun_family) + sizeof(sun.sun_path);

    return accept(s, (struct sockaddr*)(&amp;sun), &amp;length);
}

/* do_connect &#x521D;&#x59CB;&#x5316;&#x4E00;&#x4E2A;socket&#x8FDE;&#x63A5; */
int do_connect(int s, char *name) {
    struct sockaddr_un sun;
    int length;

    sun.sun_family = AF_UNIX;
    (void) strcpy(sun.sun_path, name);
    length = sizeof(sun.sun_family) + sizeof(sun.sun_path);

    return connect(s, (struct sockaddr*)(&amp;sun), length);
}

/* get_error &#x8FD4;&#x56DE;&#x64CD;&#x4F5C;&#x7CFB;&#x7EDF;&#x7684;&#x9519;&#x8BEF;&#x72B6;&#x6001;*/
char* get_error(void) {
    extern int errno;
    return strerror(errno);
}
</code></pre><p>Scheme code.</p>
<pre><code>;;; socket.ss

;;; Requires csocket.so, built from csocket.c.
(load-shared-object &quot;./csocket.so&quot;)

;;; Requires from C library:
;;;   close, dup, execl, fork, kill, listen, tmpnam, unlink
(case (machine-type)
  [(i3le ti3le a6le ta6le) (load-shared-object &quot;libc.so.6&quot;)]
  [(i3osx ti3osx a6osx ta6osx) (load-shared-object &quot;libc.dylib&quot;)]
  [else (load-shared-object &quot;libc.so&quot;)])

;;; basic C-library stuff

(define close
  (foreign-procedure &quot;close&quot; (int)
    int))

(define dup
  (foreign-procedure &quot;dup&quot; (int)
    int))

(define execl4
  (let ((execl-help
         (foreign-procedure &quot;execl&quot;
           (string string string string void*)
           int)))
    (lambda (s1 s2 s3 s4)
      (execl-help s1 s2 s3 s4 0))))

(define fork
  (foreign-procedure &quot;fork&quot; ()
    int))

(define kill
  (foreign-procedure &quot;kill&quot; (int int)
    int))

(define listen
  (foreign-procedure &quot;listen&quot; (int int)
    int))

(define tmpnam
  (foreign-procedure &quot;tmpnam&quot; (void*)
    string))

(define unlink
  (foreign-procedure &quot;unlink&quot; (string)
    int))

;;; routines defined in csocket.c

(define accept
  (foreign-procedure &quot;do_accept&quot; (int)
    int))

(define bytes-ready?
  (foreign-procedure &quot;bytes_ready&quot; (int)
    boolean))

(define bind
  (foreign-procedure &quot;do_bind&quot; (int string)
    int))

(define c-error
  (foreign-procedure &quot;get_error&quot; ()
    string))

(define c-read
  (foreign-procedure &quot;c_read&quot; (int u8* size_t size_t)
    ssize_t))

(define c-write
  (foreign-procedure &quot;c_write&quot; (int u8* size_t ssize_t)
    ssize_t))

(define connect
  (foreign-procedure &quot;do_connect&quot; (int string)
    int))

(define socket
  (foreign-procedure &quot;do_socket&quot; ()
    int))

;;; higher-level routines

(define dodup
 ; (dodup old new) closes old and dups new, then checks to
 ; make sure that resulting fd is the same as old
  (lambda (old new)
    (check &apos;close (close old))
    (unless (= (dup new) old)
      (error &apos;dodup
        &quot;couldn&apos;t set up child process io for fd ~s&quot; old))))

(define dofork
 ; (dofork child parent) forks a child process and invokes child
 ; without arguments and parent with the child&apos;s pid
  (lambda (child parent)
    (let ([pid (fork)])
      (cond
        [(= pid 0) (child)]
        [(&gt; pid 0) (parent pid)]
        [else (error &apos;fork (c-error))]))))

(define setup-server-socket
 ; create a socket, bind it to name, and listen for connections
  (lambda (name)
    (let ([sock (check &apos;socket (socket))])
      (unlink name)
      (check &apos;bind (bind sock name))
      (check &apos;listen (listen sock 1))
      sock)))

(define setup-client-socket
 ; create a socket and attempt to connect to server
  (lambda (name)
    (let ([sock (check &apos;socket (socket))])
      (check &apos;connect (connect sock name))
      sock)))

(define accept-socket
 ; accept a connection
  (lambda (sock)
    (check &apos;accept (accept sock))))

(define check
 ; signal an error if status x is negative, using c-error to
 ; obtain the operating-system&apos;s error message
  (lambda (who x)
    (if (&lt; x 0)
        (error who (c-error))
        x)))

(define terminate-process
 ; kill the process identified by pid
  (lambda (pid)
    (define sigterm 15)
    (kill pid sigterm)
    (void)))
</code></pre><p><strong>Sample session. </strong></p>
<pre><code>&gt; (define client-pid)
&gt; (define client-socket)
&gt; (let* ([server-socket-name (tmpnam 0)]
         [server-socket (setup-server-socket server-socket-name)])
   ; fork a child, use it to exec a client Scheme process, and set
   ; up server-side client-pid and client-socket variables.
    (dofork   ; child
      (lambda ()
       ; the child establishes the socket input/output fds as
       ; stdin and stdout, then starts a new Scheme session
        (check &apos;close (close server-socket))
        (let ([sock (setup-client-socket server-socket-name)])
          (dodup 0 sock)
          (dodup 1 sock))
        (check &apos;execl (execl4 &quot;/bin/sh&quot; &quot;/bin/sh&quot; &quot;-c&quot; &quot;exec scheme -q&quot;))
        (errorf &apos;client &quot;returned!&quot;))
      (lambda (pid) ; parent
       ; the parent waits for a connection from the client
        (set! client-pid pid)
        (set! client-socket (accept-socket server-socket))
        (check &apos;close (close server-socket)))))
&gt; (define put ; procedure to send data to client
    (lambda (x)
      (let ([s (format &quot;~s~%&quot; x)])
        (c-write client-socket s (string-length s)))
      (void)))
&gt; (define get ; procedure to read data from client
    (let ([buff (make-string 1024)])
      (lambda ()
        (let ([n (c-read client-socket buff (string-length buff))])
          (printf &quot;client:~%~a~%server:~%&quot; (substring buff 0 n))))))
&gt; (get)
server:
&gt; (put &apos;(let ([x 3]) x))
&gt; (get)
client:
3
server:
&gt; (terminate-process client-pid)
&gt; (exit)
</code></pre><hr>
<p>Chez Scheme Version 9 User&apos;s Guide
Copyright &#xA9; 2018 Cisco Systems, Inc.
Licensed under the <a href="http://www.apache.org/licenses/LICENSE-2.0" target="_blank">Apache License Version 2.0</a> (<a href="https://cisco.github.io/ChezScheme/csug9.5/canned/copyright.html" target="_blank">full copyright notice.</a>).
Revised October 2018 for Chez Scheme Version 9.5.1
<a href="https://cisco.github.io/ChezScheme/csug9.5/canned/about.html" target="_blank">about this book</a></p>

                                
                                </section>
                            
    </div>
    <div class="search-results">
        <div class="has-results">
            
            <h1 class="search-results-title"><span class='search-results-count'></span> results matching "<span class='search-query'></span>"</h1>
            <ul class="search-results-list"></ul>
            
        </div>
        <div class="no-results">
            
            <h1 class="search-results-title">No results matching "<span class='search-query'></span>"</h1>
            
        </div>
    </div>
</div>

                        </div>
                    </div>
                
            </div>

            
                
                <a href="03.Debugging.html" class="navigation navigation-prev " aria-label="Previous page: 03. Debugging">
                    <i class="fa fa-angle-left"></i>
                </a>
                
                
                <a href="05.BindingForms.html" class="navigation navigation-next " aria-label="Next page: 05. 绑定">
                    <i class="fa fa-angle-right"></i>
                </a>
                
            
        
    </div>

    <script>
        var gitbook = gitbook || [];
        gitbook.push(function() {
            gitbook.page.hasChanged({"page":{"title":"04. 外部接口","level":"1.6","depth":1,"next":{"title":"05. 绑定","level":"1.7","depth":1,"path":"05.BindingForms.md","ref":"05.BindingForms.md","articles":[]},"previous":{"title":"03. Debugging","level":"1.5","depth":1,"path":"03.Debugging.md","ref":"03.Debugging.md","articles":[]},"dir":"ltr"},"config":{"gitbook":"*","theme":"default","variables":{},"plugins":[],"pluginsConfig":{"highlight":{},"search":{},"lunr":{"maxIndexSize":1000000,"ignoreSpecialCharacters":false},"sharing":{"facebook":true,"twitter":true,"google":false,"weibo":false,"instapaper":false,"vk":false,"all":["facebook","google","twitter","weibo","instapaper"]},"fontsettings":{"theme":"white","family":"sans","size":2},"theme-default":{"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"},"showLevel":false}},"structure":{"langs":"LANGS.md","readme":"README.md","glossary":"GLOSSARY.md","summary":"SUMMARY.md"},"pdf":{"pageNumbers":true,"fontSize":12,"fontFamily":"Arial","paperSize":"a4","chapterMark":"pagebreak","pageBreaksBefore":"/","margin":{"right":62,"left":62,"top":56,"bottom":56}},"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"}},"file":{"path":"04.ForeignInterface.md","mtime":"2020-04-26T23:58:21.747Z","type":"markdown"},"gitbook":{"version":"3.2.3","time":"2020-04-26T23:58:44.087Z"},"basePath":".","book":{"language":""}});
        });
    </script>
</div>

        
    <script src="gitbook/gitbook.js"></script>
    <script src="gitbook/theme.js"></script>
    
        
        <script src="gitbook/gitbook-plugin-search/search-engine.js"></script>
        
    
        
        <script src="gitbook/gitbook-plugin-search/search.js"></script>
        
    
        
        <script src="gitbook/gitbook-plugin-lunr/lunr.min.js"></script>
        
    
        
        <script src="gitbook/gitbook-plugin-lunr/search-lunr.js"></script>
        
    
        
        <script src="gitbook/gitbook-plugin-sharing/buttons.js"></script>
        
    
        
        <script src="gitbook/gitbook-plugin-fontsettings/fontsettings.js"></script>
        
    

    </body>
</html>

